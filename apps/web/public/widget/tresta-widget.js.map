{"version":3,"file":"tresta-widget.js","sources":["../../../node_modules/.pnpm/preact@10.27.2/node_modules/preact/dist/preact.module.js","../src/types/index.ts","../src/styles/theme-manager.ts","../src/styles/style-manager.ts","../src/api/network.ts","../src/api/retry.ts","../src/api/rate-limiter.ts","../src/config/env.ts","../src/api/client.ts","../src/storage/indexeddb.ts","../src/storage/localstorage.ts","../src/storage/cache-manager.ts","../src/telemetry/sampler.ts","../src/telemetry/tracker.ts","../src/utils/testimonial-limiter.ts","../src/utils/logger.ts","../src/security/csp-validator.ts","../../../node_modules/.pnpm/preact@10.27.2/node_modules/preact/jsx-runtime/dist/jsxRuntime.module.js","../../../node_modules/.pnpm/clsx@2.1.1/node_modules/clsx/dist/clsx.mjs","../src/lib/utils.ts","../src/components/TestimonialCard.tsx","../src/components/layouts/GridLayout.tsx","../src/components/layouts/ListLayout.tsx","../src/components/layouts/MasonryLayout.tsx","../../../node_modules/.pnpm/preact@10.27.2/node_modules/preact/hooks/dist/hooks.module.js","../src/components/layouts/CarouselLayout.tsx","../src/components/layouts/WallOfLoveLayout.tsx","../src/components/layouts/MarqueeLayout.tsx","../src/components/WidgetRoot.tsx","../src/core/widget.ts","../src/core/loader.ts","../src/core/config.ts","../src/index.ts"],"sourcesContent":["var n,l,u,t,i,r,o,e,f,c,s,a,h,p={},v=[],y=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,w=Array.isArray;function d(n,l){for(var u in l)n[u]=l[u];return n}function g(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function _(l,u,t){var i,r,o,e={};for(o in u)\"key\"==o?i=u[o]:\"ref\"==o?r=u[o]:e[o]=u[o];if(arguments.length>2&&(e.children=arguments.length>3?n.call(arguments,2):t),\"function\"==typeof l&&null!=l.defaultProps)for(o in l.defaultProps)void 0===e[o]&&(e[o]=l.defaultProps[o]);return m(l,e,i,r,null)}function m(n,t,i,r,o){var e={type:n,props:t,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==o?++u:o,__i:-1,__u:0};return null==o&&null!=l.vnode&&l.vnode(e),e}function b(){return{current:null}}function k(n){return n.children}function x(n,l){this.props=n,this.context=l}function S(n,l){if(null==l)return n.__?S(n.__,n.__i+1):null;for(var u;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e)return u.__e;return\"function\"==typeof n.type?S(n):null}function C(n){var l,u;if(null!=(n=n.__)&&null!=n.__c){for(n.__e=n.__c.base=null,l=0;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e){n.__e=n.__c.base=u.__e;break}return C(n)}}function M(n){(!n.__d&&(n.__d=!0)&&i.push(n)&&!$.__r++||r!=l.debounceRendering)&&((r=l.debounceRendering)||o)($)}function $(){for(var n,u,t,r,o,f,c,s=1;i.length;)i.length>s&&i.sort(e),n=i.shift(),s=i.length,n.__d&&(t=void 0,r=void 0,o=(r=(u=n).__v).__e,f=[],c=[],u.__P&&((t=d({},r)).__v=r.__v+1,l.vnode&&l.vnode(t),O(u.__P,t,r,u.__n,u.__P.namespaceURI,32&r.__u?[o]:null,f,null==o?S(r):o,!!(32&r.__u),c),t.__v=r.__v,t.__.__k[t.__i]=t,N(f,t,c),r.__e=r.__=null,t.__e!=o&&C(t)));$.__r=0}function I(n,l,u,t,i,r,o,e,f,c,s){var a,h,y,w,d,g,_,m=t&&t.__k||v,b=l.length;for(f=P(u,l,m,f,b),a=0;a<b;a++)null!=(y=u.__k[a])&&(h=-1==y.__i?p:m[y.__i]||p,y.__i=a,g=O(n,y,h,i,r,o,e,f,c,s),w=y.__e,y.ref&&h.ref!=y.ref&&(h.ref&&B(h.ref,null,y),s.push(y.ref,y.__c||w,y)),null==d&&null!=w&&(d=w),(_=!!(4&y.__u))||h.__k===y.__k?f=A(y,f,n,_):\"function\"==typeof y.type&&void 0!==g?f=g:w&&(f=w.nextSibling),y.__u&=-7);return u.__e=d,f}function P(n,l,u,t,i){var r,o,e,f,c,s=u.length,a=s,h=0;for(n.__k=new Array(i),r=0;r<i;r++)null!=(o=l[r])&&\"boolean\"!=typeof o&&\"function\"!=typeof o?(f=r+h,(o=n.__k[r]=\"string\"==typeof o||\"number\"==typeof o||\"bigint\"==typeof o||o.constructor==String?m(null,o,null,null,null):w(o)?m(k,{children:o},null,null,null):null==o.constructor&&o.__b>0?m(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=n,o.__b=n.__b+1,e=null,-1!=(c=o.__i=L(o,u,f,a))&&(a--,(e=u[c])&&(e.__u|=2)),null==e||null==e.__v?(-1==c&&(i>s?h--:i<s&&h++),\"function\"!=typeof o.type&&(o.__u|=4)):c!=f&&(c==f-1?h--:c==f+1?h++:(c>f?h--:h++,o.__u|=4))):n.__k[r]=null;if(a)for(r=0;r<s;r++)null!=(e=u[r])&&0==(2&e.__u)&&(e.__e==t&&(t=S(e)),D(e,e));return t}function A(n,l,u,t){var i,r;if(\"function\"==typeof n.type){for(i=n.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=n,l=A(i[r],l,u,t));return l}n.__e!=l&&(t&&(l&&n.type&&!l.parentNode&&(l=S(n)),u.insertBefore(n.__e,l||null)),l=n.__e);do{l=l&&l.nextSibling}while(null!=l&&8==l.nodeType);return l}function H(n,l){return l=l||[],null==n||\"boolean\"==typeof n||(w(n)?n.some(function(n){H(n,l)}):l.push(n)),l}function L(n,l,u,t){var i,r,o,e=n.key,f=n.type,c=l[u],s=null!=c&&0==(2&c.__u);if(null===c&&null==n.key||s&&e==c.key&&f==c.type)return u;if(t>(s?1:0))for(i=u-1,r=u+1;i>=0||r<l.length;)if(null!=(c=l[o=i>=0?i--:r++])&&0==(2&c.__u)&&e==c.key&&f==c.type)return o;return-1}function T(n,l,u){\"-\"==l[0]?n.setProperty(l,null==u?\"\":u):n[l]=null==u?\"\":\"number\"!=typeof u||y.test(l)?u:u+\"px\"}function j(n,l,u,t,i){var r,o;n:if(\"style\"==l)if(\"string\"==typeof u)n.style.cssText=u;else{if(\"string\"==typeof t&&(n.style.cssText=t=\"\"),t)for(l in t)u&&l in u||T(n.style,l,\"\");if(u)for(l in u)t&&u[l]==t[l]||T(n.style,l,u[l])}else if(\"o\"==l[0]&&\"n\"==l[1])r=l!=(l=l.replace(f,\"$1\")),o=l.toLowerCase(),l=o in n||\"onFocusOut\"==l||\"onFocusIn\"==l?o.slice(2):l.slice(2),n.l||(n.l={}),n.l[l+r]=u,u?t?u.u=t.u:(u.u=c,n.addEventListener(l,r?a:s,r)):n.removeEventListener(l,r?a:s,r);else{if(\"http://www.w3.org/2000/svg\"==i)l=l.replace(/xlink(H|:h)/,\"h\").replace(/sName$/,\"s\");else if(\"width\"!=l&&\"height\"!=l&&\"href\"!=l&&\"list\"!=l&&\"form\"!=l&&\"tabIndex\"!=l&&\"download\"!=l&&\"rowSpan\"!=l&&\"colSpan\"!=l&&\"role\"!=l&&\"popover\"!=l&&l in n)try{n[l]=null==u?\"\":u;break n}catch(n){}\"function\"==typeof u||(null==u||!1===u&&\"-\"!=l[4]?n.removeAttribute(l):n.setAttribute(l,\"popover\"==l&&1==u?\"\":u))}}function F(n){return function(u){if(this.l){var t=this.l[u.type+n];if(null==u.t)u.t=c++;else if(u.t<t.u)return;return t(l.event?l.event(u):u)}}}function O(n,u,t,i,r,o,e,f,c,s){var a,h,p,v,y,_,m,b,S,C,M,$,P,A,H,L,T,j=u.type;if(null!=u.constructor)return null;128&t.__u&&(c=!!(32&t.__u),o=[f=u.__e=t.__e]),(a=l.__b)&&a(u);n:if(\"function\"==typeof j)try{if(b=u.props,S=\"prototype\"in j&&j.prototype.render,C=(a=j.contextType)&&i[a.__c],M=a?C?C.props.value:a.__:i,t.__c?m=(h=u.__c=t.__c).__=h.__E:(S?u.__c=h=new j(b,M):(u.__c=h=new x(b,M),h.constructor=j,h.render=E),C&&C.sub(h),h.props=b,h.state||(h.state={}),h.context=M,h.__n=i,p=h.__d=!0,h.__h=[],h._sb=[]),S&&null==h.__s&&(h.__s=h.state),S&&null!=j.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=d({},h.__s)),d(h.__s,j.getDerivedStateFromProps(b,h.__s))),v=h.props,y=h.state,h.__v=u,p)S&&null==j.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),S&&null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(S&&null==j.getDerivedStateFromProps&&b!==v&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(b,M),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(b,h.__s,M)||u.__v==t.__v){for(u.__v!=t.__v&&(h.props=b,h.state=h.__s,h.__d=!1),u.__e=t.__e,u.__k=t.__k,u.__k.some(function(n){n&&(n.__=u)}),$=0;$<h._sb.length;$++)h.__h.push(h._sb[$]);h._sb=[],h.__h.length&&e.push(h);break n}null!=h.componentWillUpdate&&h.componentWillUpdate(b,h.__s,M),S&&null!=h.componentDidUpdate&&h.__h.push(function(){h.componentDidUpdate(v,y,_)})}if(h.context=M,h.props=b,h.__P=n,h.__e=!1,P=l.__r,A=0,S){for(h.state=h.__s,h.__d=!1,P&&P(u),a=h.render(h.props,h.state,h.context),H=0;H<h._sb.length;H++)h.__h.push(h._sb[H]);h._sb=[]}else do{h.__d=!1,P&&P(u),a=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++A<25);h.state=h.__s,null!=h.getChildContext&&(i=d(d({},i),h.getChildContext())),S&&!p&&null!=h.getSnapshotBeforeUpdate&&(_=h.getSnapshotBeforeUpdate(v,y)),L=a,null!=a&&a.type===k&&null==a.key&&(L=V(a.props.children)),f=I(n,w(L)?L:[L],u,t,i,r,o,e,f,c,s),h.base=u.__e,u.__u&=-161,h.__h.length&&e.push(h),m&&(h.__E=h.__=null)}catch(n){if(u.__v=null,c||null!=o)if(n.then){for(u.__u|=c?160:128;f&&8==f.nodeType&&f.nextSibling;)f=f.nextSibling;o[o.indexOf(f)]=null,u.__e=f}else{for(T=o.length;T--;)g(o[T]);z(u)}else u.__e=t.__e,u.__k=t.__k,n.then||z(u);l.__e(n,u,t)}else null==o&&u.__v==t.__v?(u.__k=t.__k,u.__e=t.__e):f=u.__e=q(t.__e,u,t,i,r,o,e,c,s);return(a=l.diffed)&&a(u),128&u.__u?void 0:f}function z(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(z)}function N(n,u,t){for(var i=0;i<t.length;i++)B(t[i],t[++i],t[++i]);l.__c&&l.__c(u,n),n.some(function(u){try{n=u.__h,u.__h=[],n.some(function(n){n.call(u)})}catch(n){l.__e(n,u.__v)}})}function V(n){return\"object\"!=typeof n||null==n||n.__b&&n.__b>0?n:w(n)?n.map(V):d({},n)}function q(u,t,i,r,o,e,f,c,s){var a,h,v,y,d,_,m,b=i.props,k=t.props,x=t.type;if(\"svg\"==x?o=\"http://www.w3.org/2000/svg\":\"math\"==x?o=\"http://www.w3.org/1998/Math/MathML\":o||(o=\"http://www.w3.org/1999/xhtml\"),null!=e)for(a=0;a<e.length;a++)if((d=e[a])&&\"setAttribute\"in d==!!x&&(x?d.localName==x:3==d.nodeType)){u=d,e[a]=null;break}if(null==u){if(null==x)return document.createTextNode(k);u=document.createElementNS(o,x,k.is&&k),c&&(l.__m&&l.__m(t,e),c=!1),e=null}if(null==x)b===k||c&&u.data==k||(u.data=k);else{if(e=e&&n.call(u.childNodes),b=i.props||p,!c&&null!=e)for(b={},a=0;a<u.attributes.length;a++)b[(d=u.attributes[a]).name]=d.value;for(a in b)if(d=b[a],\"children\"==a);else if(\"dangerouslySetInnerHTML\"==a)v=d;else if(!(a in k)){if(\"value\"==a&&\"defaultValue\"in k||\"checked\"==a&&\"defaultChecked\"in k)continue;j(u,a,null,d,o)}for(a in k)d=k[a],\"children\"==a?y=d:\"dangerouslySetInnerHTML\"==a?h=d:\"value\"==a?_=d:\"checked\"==a?m=d:c&&\"function\"!=typeof d||b[a]===d||j(u,a,d,b[a],o);if(h)c||v&&(h.__html==v.__html||h.__html==u.innerHTML)||(u.innerHTML=h.__html),t.__k=[];else if(v&&(u.innerHTML=\"\"),I(\"template\"==t.type?u.content:u,w(y)?y:[y],t,i,r,\"foreignObject\"==x?\"http://www.w3.org/1999/xhtml\":o,e,f,e?e[0]:i.__k&&S(i,0),c,s),null!=e)for(a=e.length;a--;)g(e[a]);c||(a=\"value\",\"progress\"==x&&null==_?u.removeAttribute(\"value\"):null!=_&&(_!==u[a]||\"progress\"==x&&!_||\"option\"==x&&_!=b[a])&&j(u,a,_,b[a],o),a=\"checked\",null!=m&&m!=u[a]&&j(u,a,m,b[a],o))}return u}function B(n,u,t){try{if(\"function\"==typeof n){var i=\"function\"==typeof n.__u;i&&n.__u(),i&&null==u||(n.__u=n(u))}else n.current=u}catch(n){l.__e(n,t)}}function D(n,u,t){var i,r;if(l.unmount&&l.unmount(n),(i=n.ref)&&(i.current&&i.current!=n.__e||B(i,null,u)),null!=(i=n.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(n){l.__e(n,u)}i.base=i.__P=null}if(i=n.__k)for(r=0;r<i.length;r++)i[r]&&D(i[r],u,t||\"function\"!=typeof n.type);t||g(n.__e),n.__c=n.__=n.__e=void 0}function E(n,l,u){return this.constructor(n,u)}function G(u,t,i){var r,o,e,f;t==document&&(t=document.documentElement),l.__&&l.__(u,t),o=(r=\"function\"==typeof i)?null:i&&i.__k||t.__k,e=[],f=[],O(t,u=(!r&&i||t).__k=_(k,null,[u]),o||p,p,t.namespaceURI,!r&&i?[i]:o?null:t.firstChild?n.call(t.childNodes):null,e,!r&&i?i:o?o.__e:t.firstChild,r,f),N(e,u,f)}function J(n,l){G(n,l,J)}function K(l,u,t){var i,r,o,e,f=d({},l.props);for(o in l.type&&l.type.defaultProps&&(e=l.type.defaultProps),u)\"key\"==o?i=u[o]:\"ref\"==o?r=u[o]:f[o]=void 0===u[o]&&null!=e?e[o]:u[o];return arguments.length>2&&(f.children=arguments.length>3?n.call(arguments,2):t),m(l.type,f,i||l.key,r||l.ref,null)}function Q(n){function l(n){var u,t;return this.getChildContext||(u=new Set,(t={})[l.__c]=this,this.getChildContext=function(){return t},this.componentWillUnmount=function(){u=null},this.shouldComponentUpdate=function(n){this.props.value!=n.value&&u.forEach(function(n){n.__e=!0,M(n)})},this.sub=function(n){u.add(n);var l=n.componentWillUnmount;n.componentWillUnmount=function(){u&&u.delete(n),l&&l.call(n)}}),n.children}return l.__c=\"__cC\"+h++,l.__=n,l.Provider=l.__l=(l.Consumer=function(n,l){return n.children(l)}).contextType=l,l}n=v.slice,l={__e:function(n,l,u,t){for(var i,r,o;l=l.__;)if((i=l.__c)&&!i.__)try{if((r=i.constructor)&&null!=r.getDerivedStateFromError&&(i.setState(r.getDerivedStateFromError(n)),o=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(n,t||{}),o=i.__d),o)return i.__E=i}catch(l){n=l}throw n}},u=0,t=function(n){return null!=n&&null==n.constructor},x.prototype.setState=function(n,l){var u;u=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=d({},this.state),\"function\"==typeof n&&(n=n(d({},u),this.props)),n&&d(u,n),null!=n&&this.__v&&(l&&this._sb.push(l),M(this))},x.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),M(this))},x.prototype.render=k,i=[],o=\"function\"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e=function(n,l){return n.__v.__b-l.__v.__b},$.__r=0,f=/(PointerCapture)$|Capture$/i,c=0,s=F(!1),a=F(!0),h=0;export{x as Component,k as Fragment,K as cloneElement,Q as createContext,_ as createElement,b as createRef,_ as h,J as hydrate,t as isValidElement,l as options,G as render,H as toChildArray};\n//# sourceMappingURL=preact.module.js.map\n","/**\r\n * Core type definitions for the Tresta Widget System\r\n */\r\n\r\nexport interface WidgetConfig {\r\n  widgetId: string;\r\n  apiKey: string;\r\n  container?: string | HTMLElement;\r\n  debug?: boolean;\r\n  telemetry?: boolean;\r\n  version?: string;\r\n  theme?: ThemeConfig;\r\n  errorMessage?: string;\r\n  emptyMessage?: string;\r\n  apiUrl?: string;\r\n  lang?: string; // Language code for localization (e.g., 'en', 'es', 'fr')\r\n  useShadowDOM?: boolean; // Whether to use Shadow DOM for style isolation (default: true)\r\n  nonce?: string; // CSP nonce propagated from host environments\r\n}\r\n\r\nexport interface WidgetInstance {\r\n  mount(container: HTMLElement): Promise<void>;\r\n  unmount(): void;\r\n  refresh(): Promise<void>;\r\n  getState(): WidgetState;\r\n}\r\n\r\nexport interface WidgetState {\r\n  mounted: boolean;\r\n  loading: boolean;\r\n  error: Error | null;\r\n  data: WidgetData | null;\r\n}\r\n\r\nexport interface WidgetData {\r\n  widgetId: string;\r\n  config: WidgetDisplayConfig;\r\n  testimonials: Testimonial[];\r\n}\r\n\r\nexport interface WidgetDisplayConfig {\r\n  layout: LayoutConfig;\r\n  theme: ThemeConfig;\r\n  display: DisplayOptions;\r\n}\r\n\r\nexport interface LayoutConfig {\r\n  type: \"carousel\" | \"grid\" | \"masonry\" | \"wall\" | \"list\" | \"marquee\";\r\n  maxTestimonials?: number;\r\n  autoRotate?: boolean;\r\n  rotateInterval?: number;\r\n  showNavigation?: boolean;\r\n  columns?: number;\r\n}\r\n\r\nexport interface ThemeConfig {\r\n  mode: \"light\" | \"dark\" | \"auto\";\r\n  primaryColor: string;\r\n  secondaryColor: string;\r\n  fontFamily?: string;\r\n  cardStyle: \"default\" | \"minimal\" | \"bordered\" | \"glass\";\r\n}\r\n\r\nexport interface DisplayOptions {\r\n  showRating: boolean;\r\n  showDate: boolean;\r\n  showAvatar: boolean;\r\n  showAuthorRole: boolean;\r\n  showAuthorCompany: boolean;\r\n  maxTestimonials?: number;\r\n}\r\n\r\nexport interface Testimonial {\r\n  id: string;\r\n  content: string;\r\n  rating: number;\r\n  createdAt: string;\r\n  isPublished: boolean;\r\n  isApproved: boolean;\r\n  isOAuthVerified: boolean;\r\n  oauthProvider?: string;\r\n  author: {\r\n    name: string;\r\n    email?: string;\r\n    avatar?: string;\r\n    role?: string;\r\n    company?: string;\r\n  };\r\n  media?: {\r\n    type: \"image\" | \"video\";\r\n    url: string;\r\n    thumbnail?: string;\r\n  };\r\n}\r\n\r\nexport enum WidgetErrorCode {\r\n  INVALID_WIDGET_ID = \"INVALID_WIDGET_ID\",\r\n  API_TIMEOUT = \"API_TIMEOUT\",\r\n  API_ERROR = \"API_ERROR\",\r\n  NETWORK_ERROR = \"NETWORK_ERROR\",\r\n  RATE_LIMITED = \"RATE_LIMITED\",\r\n  UNAUTHORIZED = \"UNAUTHORIZED\",\r\n  PARSE_ERROR = \"PARSE_ERROR\",\r\n  RENDER_ERROR = \"RENDER_ERROR\",\r\n}\r\n\r\nexport class WidgetError extends Error {\r\n  constructor(\r\n    public code: WidgetErrorCode,\r\n    message: string,\r\n    public recoverable: boolean = true,\r\n  ) {\r\n    super(message);\r\n    this.name = \"WidgetError\";\r\n  }\r\n}\r\n","/**\r\n * Theme Manager - Handles theme configuration and CSS custom properties\r\n */\r\n\r\nimport type { ThemeConfig } from '../types/index.js';\r\n\r\nexport interface ThemeManagerConfig {\r\n  theme?: ThemeConfig;\r\n  debug?: boolean;\r\n}\r\n\r\nexport class ThemeManager {\r\n  private theme: ThemeConfig;\r\n  private debug: boolean;\r\n\r\n  constructor(config: ThemeManagerConfig = {}) {\r\n    this.theme = config.theme ?? this.getDefaultTheme();\r\n    this.debug = config.debug ?? false;\r\n\r\n    if (this.debug) {\r\n      console.log('[TrestaWidget] ThemeManager initialized with theme:', this.theme);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get default theme configuration\r\n   */\r\n  private getDefaultTheme(): ThemeConfig {\r\n    return {\r\n      mode: 'light',\r\n      primaryColor: '#3b82f6',\r\n      secondaryColor: '#64748b',\r\n      cardStyle: 'default',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Apply theme to a root element\r\n   */\r\n  applyTheme(root: HTMLElement): void {\r\n    // Apply theme mode\r\n    this.applyThemeMode(root);\r\n\r\n    // Apply colors\r\n    this.applyColors(root);\r\n\r\n    // Apply font family\r\n    this.applyFontFamily(root);\r\n\r\n    // Apply card style\r\n    this.applyCardStyle(root);\r\n\r\n    if (this.debug) {\r\n      console.log('[TrestaWidget] Theme applied to root element');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply theme mode (light/dark/auto)\r\n   */\r\n  private applyThemeMode(root: HTMLElement): void {\r\n    let effectiveMode = this.theme.mode;\r\n\r\n    // Handle auto mode\r\n    if (effectiveMode === 'auto') {\r\n      effectiveMode = this.detectPreferredColorScheme();\r\n    }\r\n\r\n    root.setAttribute('data-theme', effectiveMode);\r\n  }\r\n\r\n  /**\r\n   * Detect user's preferred color scheme\r\n   */\r\n  private detectPreferredColorScheme(): 'light' | 'dark' {\r\n    if (typeof window !== 'undefined' && window.matchMedia) {\r\n      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n      return prefersDark ? 'dark' : 'light';\r\n    }\r\n    return 'light';\r\n  }\r\n\r\n  /**\r\n   * Apply primary and secondary colors via CSS custom properties\r\n   */\r\n  private applyColors(root: HTMLElement): void {\r\n    root.style.setProperty('--tresta-primary-color', this.theme.primaryColor);\r\n    root.style.setProperty('--tresta-secondary-color', this.theme.secondaryColor);\r\n  }\r\n\r\n  /**\r\n   * Apply custom font family with fallback\r\n   */\r\n  private applyFontFamily(root: HTMLElement): void {\r\n    if (this.theme.fontFamily) {\r\n      // Add fallback fonts for better compatibility\r\n      const fontFamilyWithFallback = `${this.theme.fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif`;\r\n      root.style.setProperty('--tresta-font-family', fontFamilyWithFallback);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply card style\r\n   */\r\n  private applyCardStyle(root: HTMLElement): void {\r\n    root.setAttribute('data-card-style', this.theme.cardStyle);\r\n  }\r\n\r\n  /**\r\n   * Update theme configuration\r\n   */\r\n  updateTheme(theme: Partial<ThemeConfig>): void {\r\n    this.theme = {\r\n      ...this.theme,\r\n      ...theme,\r\n    };\r\n\r\n    if (this.debug) {\r\n      console.log('[TrestaWidget] Theme updated:', this.theme);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current theme configuration\r\n   */\r\n  getTheme(): ThemeConfig {\r\n    return { ...this.theme };\r\n  }\r\n\r\n  /**\r\n   * Parse theme configuration from data attributes\r\n   */\r\n  static parseThemeFromElement(element: HTMLElement): Partial<ThemeConfig> {\r\n    const theme: Partial<ThemeConfig> = {};\r\n\r\n    // Parse theme mode\r\n    const mode = element.getAttribute('data-theme-mode');\r\n    if (mode === 'light' || mode === 'dark' || mode === 'auto') {\r\n      theme.mode = mode;\r\n    }\r\n\r\n    // Parse primary color\r\n    const primaryColor = element.getAttribute('data-primary-color');\r\n    if (primaryColor) {\r\n      theme.primaryColor = primaryColor;\r\n    }\r\n\r\n    // Parse secondary color\r\n    const secondaryColor = element.getAttribute('data-secondary-color');\r\n    if (secondaryColor) {\r\n      theme.secondaryColor = secondaryColor;\r\n    }\r\n\r\n    // Parse font family\r\n    const fontFamily = element.getAttribute('data-font-family');\r\n    if (fontFamily) {\r\n      theme.fontFamily = fontFamily;\r\n    }\r\n\r\n    // Parse card style\r\n    const cardStyle = element.getAttribute('data-card-style');\r\n    if (cardStyle === 'default' || cardStyle === 'minimal' || cardStyle === 'bordered') {\r\n      theme.cardStyle = cardStyle;\r\n    }\r\n\r\n    return theme;\r\n  }\r\n}\r\n","/**\r\n * Style Manager - Handles Shadow DOM and CSS isolation\r\n */\r\n\r\nimport indexStyles from '../index.css?inline';\r\nimport { ThemeManager, type ThemeManagerConfig } from './theme-manager.js';\r\n\r\n// Combine all styles\r\nconst BASE_STYLES = indexStyles;\r\n\r\nexport interface StyleManagerConfig {\r\n  useShadowDOM?: boolean;\r\n  debug?: boolean;\r\n  theme?: ThemeManagerConfig['theme'];\r\n  nonceApplier?: ((element: HTMLElement) => void) | undefined;\r\n}\r\n\r\nexport class StyleManager {\r\n  private shadowRoot: ShadowRoot | null = null;\r\n  private useShadowDOM: boolean;\r\n  private debug: boolean;\r\n  private themeManager: ThemeManager;\r\n  private nonceApplier?: ((element: HTMLElement) => void) | undefined;\r\n\r\n  constructor(config: StyleManagerConfig = {}) {\r\n    this.useShadowDOM = config.useShadowDOM ?? this.detectShadowDOMSupport();\r\n    this.debug = config.debug ?? false;\r\n    this.nonceApplier = config.nonceApplier;\r\n\r\n    const themeConfig: ThemeManagerConfig = { debug: this.debug };\r\n    if (config.theme) {\r\n      themeConfig.theme = config.theme;\r\n    }\r\n    this.themeManager = new ThemeManager(themeConfig);\r\n\r\n    if (this.debug) {\r\n      console.log(`[TrestaWidget] StyleManager initialized with Shadow DOM: ${this.useShadowDOM}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Detect if Shadow DOM is supported\r\n   */\r\n  private detectShadowDOMSupport(): boolean {\r\n    return 'attachShadow' in Element.prototype;\r\n  }\r\n\r\n  /**\r\n   * Initialize styles for the widget\r\n   * Returns the root element where content should be rendered\r\n   */\r\n  initializeStyles(container: HTMLElement): HTMLElement {\r\n    if (this.useShadowDOM) {\r\n      return this.initializeShadowDOM(container);\r\n    } else {\r\n      return this.initializeNamespacedCSS(container);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize Shadow DOM with encapsulated styles\r\n   */\r\n  private initializeShadowDOM(container: HTMLElement): HTMLElement {\r\n    // Attach shadow root\r\n    this.shadowRoot = container.attachShadow({ mode: 'open' });\r\n\r\n    // Create style element\r\n    const styleElement = document.createElement('style');\r\n    this.applyNonce(styleElement);\r\n    styleElement.textContent = this.getShadowDOMStyles();\r\n    this.shadowRoot.appendChild(styleElement);\r\n\r\n    // Create content wrapper\r\n    const contentWrapper = document.createElement('div');\r\n    contentWrapper.setAttribute('data-tresta-widget-root', 'true');\r\n    contentWrapper.setAttribute('data-tresta-widget', 'true');\r\n    this.shadowRoot.appendChild(contentWrapper);\r\n\r\n    // Apply theme\r\n    this.themeManager.applyTheme(contentWrapper);\r\n\r\n    if (this.debug) {\r\n      console.log('[TrestaWidget] Shadow DOM initialized');\r\n    }\r\n\r\n    return contentWrapper;\r\n  }\r\n\r\n  /**\r\n   * Initialize namespaced CSS fallback for older browsers\r\n   */\r\n  private initializeNamespacedCSS(container: HTMLElement): HTMLElement {\r\n    // Add namespaced class to container\r\n    container.classList.add('tresta-widget');\r\n\r\n    // Inject namespaced styles if not already present\r\n    if (!document.getElementById('tresta-widget-styles')) {\r\n      const styleElement = document.createElement('style');\r\n      styleElement.id = 'tresta-widget-styles';\r\n      this.applyNonce(styleElement);\r\n      styleElement.textContent = this.getNamespacedStyles();\r\n      document.head.appendChild(styleElement);\r\n    }\r\n\r\n    // Create content wrapper\r\n    const contentWrapper = document.createElement('div');\r\n    contentWrapper.setAttribute('data-tresta-widget-root', 'true');\r\n    contentWrapper.setAttribute('data-tresta-widget', 'true');\r\n    contentWrapper.classList.add('tresta-widget-root');\r\n    container.appendChild(contentWrapper);\r\n\r\n    // Apply theme\r\n    this.themeManager.applyTheme(contentWrapper);\r\n\r\n    if (this.debug) {\r\n      console.log('[TrestaWidget] Namespaced CSS initialized');\r\n    }\r\n\r\n    return contentWrapper;\r\n  }\r\n\r\n  /**\r\n   * Get styles for Shadow DOM (no namespacing needed)\r\n   */\r\n  private getShadowDOMStyles(): string {\r\n    return BASE_STYLES;\r\n  }\r\n\r\n  /**\r\n   * Get namespaced styles for fallback mode\r\n   */\r\n  private getNamespacedStyles(): string {\r\n    // Transform base styles to be namespaced\r\n    // Replace :root with .tresta-widget\r\n    // Replace [data-tresta-widget] with .tresta-widget-root\r\n    let namespacedStyles = BASE_STYLES\r\n      .replace(/:root\\s*{/g, '.tresta-widget {')\r\n      .replace(/\\[data-tresta-widget\\]/g, '.tresta-widget-root');\r\n\r\n    // Add high specificity to prevent host page overrides\r\n    namespacedStyles = `.tresta-widget { all: initial; }\\n${namespacedStyles}`;\r\n\r\n    return namespacedStyles;\r\n  }\r\n\r\n  /**\r\n   * Clean up styles\r\n   */\r\n  cleanup(): void {\r\n    this.shadowRoot = null;\r\n\r\n    // Note: We don't remove the global style element in namespaced mode\r\n    // because other widget instances might be using it\r\n  }\r\n\r\n  /**\r\n   * Get the theme manager\r\n   */\r\n  getThemeManager(): ThemeManager {\r\n    return this.themeManager;\r\n  }\r\n\r\n  /**\r\n   * Check if Shadow DOM is being used\r\n   */\r\n  isShadowDOM(): boolean {\r\n    return this.useShadowDOM;\r\n  }\r\n\r\n  /**\r\n   * Get the shadow root (if using Shadow DOM)\r\n   */\r\n  getShadowRoot(): ShadowRoot | null {\r\n    return this.shadowRoot;\r\n  }\r\n\r\n  /**\r\n   * Apply CSP nonce when provided\r\n   */\r\n  private applyNonce(element: HTMLElement): void {\r\n    if (this.nonceApplier) {\r\n      this.nonceApplier(element);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Network layer with fetch and timeout support\r\n */\r\n\r\nimport { WidgetError, WidgetErrorCode } from '../types/index.js';\r\nimport type { RequestOptions, APIResponse } from './types.js';\r\n\r\n/**\r\n * Create a fetch request with timeout support\r\n */\r\nexport async function fetchWithTimeout<T>(\r\n  url: string,\r\n  options: RequestOptions = {}\r\n): Promise<APIResponse<T>> {\r\n  const {\r\n    method = 'GET',\r\n    headers = {},\r\n    body,\r\n    timeout = 10000, // 10 second default timeout\r\n  } = options;\r\n\r\n  // Create an AbortController for timeout\r\n  const controller = new AbortController();\r\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n\r\n  try {\r\n    const fetchOptions: RequestInit = {\r\n      method,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        ...headers,\r\n      },\r\n      signal: controller.signal,\r\n      credentials: 'omit', // Never send credentials (withCredentials: false)\r\n    };\r\n\r\n    if (body && method !== 'GET') {\r\n      fetchOptions.body = JSON.stringify(body);\r\n    }\r\n\r\n    const response = await fetch(url, fetchOptions);\r\n\r\n    clearTimeout(timeoutId);\r\n\r\n    // Parse response\r\n    let data: T;\r\n    const contentType = response.headers.get('content-type');\r\n\r\n    if (contentType && contentType.includes('application/json')) {\r\n      data = await response.json();\r\n    } else {\r\n      data = (await response.text()) as unknown as T;\r\n    }\r\n\r\n    return {\r\n      data,\r\n      status: response.status,\r\n      headers: response.headers,\r\n    };\r\n  } catch (error) {\r\n    clearTimeout(timeoutId);\r\n\r\n    // Handle abort (timeout)\r\n    if (error instanceof Error && error.name === 'AbortError') {\r\n      throw new WidgetError(\r\n        WidgetErrorCode.API_TIMEOUT,\r\n        `Request timed out after ${timeout}ms`,\r\n        true\r\n      );\r\n    }\r\n\r\n    // Handle network errors\r\n    if (error instanceof TypeError) {\r\n      throw new WidgetError(\r\n        WidgetErrorCode.NETWORK_ERROR,\r\n        'Network request failed. Please check your connection.',\r\n        true\r\n      );\r\n    }\r\n\r\n    // Re-throw other errors\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Request interceptor - can be used to modify requests before sending\r\n */\r\nexport type RequestInterceptor = (\r\n  url: string,\r\n  options: RequestOptions\r\n) => { url: string; options: RequestOptions } | Promise<{ url: string; options: RequestOptions }>;\r\n\r\n/**\r\n * Response interceptor - can be used to modify responses after receiving\r\n */\r\nexport type ResponseInterceptor = <T>(\r\n  response: APIResponse<T>\r\n) => APIResponse<T> | Promise<APIResponse<T>>;\r\n\r\n/**\r\n * Network client with interceptor support\r\n */\r\nexport class NetworkClient {\r\n  private requestInterceptors: RequestInterceptor[] = [];\r\n  private responseInterceptors: ResponseInterceptor[] = [];\r\n\r\n  /**\r\n   * Add a request interceptor\r\n   */\r\n  addRequestInterceptor(interceptor: RequestInterceptor): void {\r\n    this.requestInterceptors.push(interceptor);\r\n  }\r\n\r\n  /**\r\n   * Add a response interceptor\r\n   */\r\n  addResponseInterceptor(interceptor: ResponseInterceptor): void {\r\n    this.responseInterceptors.push(interceptor);\r\n  }\r\n\r\n  /**\r\n   * Execute a request with interceptors\r\n   */\r\n  async request<T>(url: string, options: RequestOptions = {}): Promise<APIResponse<T>> {\r\n    // Apply request interceptors\r\n    let modifiedUrl = url;\r\n    let modifiedOptions = options;\r\n\r\n    for (const interceptor of this.requestInterceptors) {\r\n      const result = await interceptor(modifiedUrl, modifiedOptions);\r\n      modifiedUrl = result.url;\r\n      modifiedOptions = result.options;\r\n    }\r\n\r\n    // Execute request\r\n    let response = await fetchWithTimeout<T>(modifiedUrl, modifiedOptions);\r\n\r\n    // Apply response interceptors\r\n    for (const interceptor of this.responseInterceptors) {\r\n      response = await interceptor(response);\r\n    }\r\n\r\n    return response;\r\n  }\r\n}\r\n","/**\r\n * Retry logic with exponential backoff and jitter\r\n */\r\n\r\nimport { WidgetError, WidgetErrorCode } from '../types/index.js';\r\n\r\nexport interface RetryConfig {\r\n  maxRetries: number;\r\n  baseDelay: number; // Base delay in milliseconds\r\n  maxDelay: number; // Maximum delay in milliseconds\r\n  jitter: number; // Jitter in milliseconds\r\n}\r\n\r\nconst DEFAULT_RETRY_CONFIG: RetryConfig = {\r\n  maxRetries: 3,\r\n  baseDelay: 1000, // 1 second\r\n  maxDelay: 10000, // 10 seconds\r\n  jitter: 1000, // 1 second\r\n};\r\n\r\n/**\r\n * Calculate delay with exponential backoff and jitter\r\n * Formula: delay = base * 2^attempt + random(0, jitter)\r\n */\r\nfunction calculateDelay(attempt: number, config: RetryConfig): number {\r\n  const exponentialDelay = config.baseDelay * Math.pow(2, attempt);\r\n  const jitter = Math.random() * config.jitter;\r\n  const delay = Math.min(exponentialDelay + jitter, config.maxDelay);\r\n  return delay;\r\n}\r\n\r\n/**\r\n * Sleep for a specified duration\r\n */\r\nfunction sleep(ms: number): Promise<void> {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * Determine if an error is retryable\r\n */\r\nfunction isRetryableError(error: unknown): boolean {\r\n  if (error instanceof WidgetError) {\r\n    // Only retry if the error is marked as recoverable\r\n    // Retryable error codes: API_TIMEOUT, NETWORK_ERROR, API_ERROR\r\n    // Note: RATE_LIMITED is NOT retried - it should fail immediately\r\n    const retryableCodes = [\r\n      WidgetErrorCode.API_TIMEOUT,\r\n      WidgetErrorCode.NETWORK_ERROR,\r\n      WidgetErrorCode.API_ERROR,\r\n    ];\r\n    return error.recoverable && retryableCodes.includes(error.code);\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Retry a function with exponential backoff\r\n */\r\nexport async function retry<T>(\r\n  fn: () => Promise<T>,\r\n  config: Partial<RetryConfig> = {}\r\n): Promise<T> {\r\n  const retryConfig = { ...DEFAULT_RETRY_CONFIG, ...config };\r\n  let lastError: unknown;\r\n\r\n  for (let attempt = 0; attempt < retryConfig.maxRetries; attempt++) {\r\n    try {\r\n      return await fn();\r\n    } catch (error) {\r\n      lastError = error;\r\n\r\n      // Check if we should retry\r\n      if (!isRetryableError(error)) {\r\n        throw error;\r\n      }\r\n\r\n      // Check if we've exhausted retries\r\n      if (attempt === retryConfig.maxRetries - 1) {\r\n        throw error;\r\n      }\r\n\r\n      // Calculate delay and wait\r\n      const delay = calculateDelay(attempt, retryConfig);\r\n\r\n      if (error instanceof WidgetError) {\r\n        console.warn(\r\n          `[TrestaWidget] Request failed (attempt ${attempt + 1}/${retryConfig.maxRetries}): ${error.message}. Retrying in ${Math.round(delay)}ms...`\r\n        );\r\n      }\r\n\r\n      await sleep(delay);\r\n    }\r\n  }\r\n\r\n  // This should never be reached, but TypeScript needs it\r\n  throw lastError;\r\n}\r\n\r\n/**\r\n * Retry helper class for more complex retry scenarios\r\n */\r\nexport class RetryHelper {\r\n  private config: RetryConfig;\r\n\r\n  constructor(config: Partial<RetryConfig> = {}) {\r\n    this.config = { ...DEFAULT_RETRY_CONFIG, ...config };\r\n  }\r\n\r\n  /**\r\n   * Execute a function with retry logic\r\n   */\r\n  async execute<T>(fn: () => Promise<T>): Promise<T> {\r\n    return retry(fn, this.config);\r\n  }\r\n\r\n  /**\r\n   * Update retry configuration\r\n   */\r\n  updateConfig(config: Partial<RetryConfig>): void {\r\n    this.config = { ...this.config, ...config };\r\n  }\r\n\r\n  /**\r\n   * Get current configuration\r\n   */\r\n  getConfig(): RetryConfig {\r\n    return { ...this.config };\r\n  }\r\n}\r\n","/**\r\n * Rate limiter for client-side throttling\r\n * Implements 100 requests per minute per widgetId\r\n */\r\n\r\nexport interface RateLimiterConfig {\r\n  maxRequests: number; // Maximum requests per window\r\n  windowMs: number; // Time window in milliseconds\r\n}\r\n\r\nconst DEFAULT_RATE_LIMITER_CONFIG: RateLimiterConfig = {\r\n  maxRequests: 100,\r\n  windowMs: 60000, // 1 minute\r\n};\r\n\r\ninterface RequestRecord {\r\n  timestamps: number[];\r\n}\r\n\r\n/**\r\n * Rate limiter using sliding window algorithm\r\n */\r\nexport class RateLimiter {\r\n  private config: RateLimiterConfig;\r\n  private records: Map<string, RequestRecord> = new Map();\r\n\r\n  constructor(config: Partial<RateLimiterConfig> = {}) {\r\n    this.config = { ...DEFAULT_RATE_LIMITER_CONFIG, ...config };\r\n  }\r\n\r\n  /**\r\n   * Check if a request is allowed for the given key (widgetId)\r\n   * Returns true if allowed, false if rate limited\r\n   */\r\n  isAllowed(key: string): boolean {\r\n    const now = Date.now();\r\n    const record = this.getOrCreateRecord(key);\r\n\r\n    // Remove timestamps outside the current window\r\n    record.timestamps = record.timestamps.filter(\r\n      (timestamp) => now - timestamp < this.config.windowMs\r\n    );\r\n\r\n    // Check if we're under the limit\r\n    if (record.timestamps.length < this.config.maxRequests) {\r\n      record.timestamps.push(now);\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Get the time until the next request is allowed (in milliseconds)\r\n   * Returns 0 if a request is currently allowed\r\n   */\r\n  getRetryAfter(key: string): number {\r\n    const now = Date.now();\r\n    const record = this.records.get(key);\r\n\r\n    if (!record || record.timestamps.length === 0) {\r\n      return 0;\r\n    }\r\n\r\n    // Remove timestamps outside the current window\r\n    record.timestamps = record.timestamps.filter(\r\n      (timestamp) => now - timestamp < this.config.windowMs\r\n    );\r\n\r\n    // If we're under the limit, no wait needed\r\n    if (record.timestamps.length < this.config.maxRequests) {\r\n      return 0;\r\n    }\r\n\r\n    // Calculate when the oldest request will expire\r\n    const oldestTimestamp = record.timestamps[0];\r\n    if (!oldestTimestamp) {\r\n      return 0;\r\n    }\r\n    \r\n    const retryAfter = oldestTimestamp + this.config.windowMs - now;\r\n\r\n    return Math.max(0, retryAfter);\r\n  }\r\n\r\n  /**\r\n   * Reset rate limit for a specific key\r\n   */\r\n  reset(key: string): void {\r\n    this.records.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Reset all rate limits\r\n   */\r\n  resetAll(): void {\r\n    this.records.clear();\r\n  }\r\n\r\n  /**\r\n   * Get current request count for a key\r\n   */\r\n  getRequestCount(key: string): number {\r\n    const now = Date.now();\r\n    const record = this.records.get(key);\r\n\r\n    if (!record) {\r\n      return 0;\r\n    }\r\n\r\n    // Filter to only count requests in current window\r\n    const validTimestamps = record.timestamps.filter(\r\n      (timestamp) => now - timestamp < this.config.windowMs\r\n    );\r\n\r\n    return validTimestamps.length;\r\n  }\r\n\r\n  /**\r\n   * Get or create a record for a key\r\n   */\r\n  private getOrCreateRecord(key: string): RequestRecord {\r\n    let record = this.records.get(key);\r\n\r\n    if (!record) {\r\n      record = { timestamps: [] };\r\n      this.records.set(key, record);\r\n    }\r\n\r\n    return record;\r\n  }\r\n\r\n  /**\r\n   * Update configuration\r\n   */\r\n  updateConfig(config: Partial<RateLimiterConfig>): void {\r\n    this.config = { ...this.config, ...config };\r\n  }\r\n\r\n  /**\r\n   * Get current configuration\r\n   */\r\n  getConfig(): RateLimiterConfig {\r\n    return { ...this.config };\r\n  }\r\n}\r\n","const DEFAULT_CDN_BASE_URL = 'https://api.tresta.app';\r\nconst DEFAULT_API_BASE_URL = 'https://api.tresta.app';\r\nconst DEFAULT_BRANDING_URL = 'https://tresta.app';\r\n\r\ntype EnvRecord = Record<string, string | undefined>;\r\n\r\nconst getEnvSource = (): EnvRecord => {\r\n  if (typeof import.meta !== 'undefined' && import.meta.env) {\r\n    return import.meta.env as EnvRecord;\r\n  }\r\n\r\n  const globalProcess = typeof globalThis !== 'undefined'\r\n    ? (globalThis as { process?: { env?: EnvRecord } }).process\r\n    : undefined;\r\n\r\n  if (globalProcess?.env) {\r\n    return globalProcess.env;\r\n  }\r\n\r\n  return {};\r\n};\r\n\r\nconst envSource = getEnvSource();\r\n\r\nconst getEnvValue = (...keys: string[]): string | undefined => {\r\n  for (const key of keys) {\r\n    const value = envSource[key];\r\n    if (typeof value === 'string' && value.trim().length > 0) {\r\n      return value;\r\n    }\r\n  }\r\n  return undefined;\r\n};\r\n\r\nconst normalizeUrl = (value?: string): string | undefined => {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n\r\n  return value.replace(/\\/+$/, '');\r\n};\r\n\r\nconst toHostname = (value?: string): string | undefined => {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n\r\n  try {\r\n    return new URL(value).hostname;\r\n  } catch {\r\n    return value\r\n      .replace(/^https?:\\/\\//, '')\r\n      .replace(/\\/.+$/, '')\r\n      .trim();\r\n  }\r\n};\r\n\r\nconst parseCommaSeparated = (value?: string): string[] => {\r\n  if (!value) {\r\n    return [];\r\n  }\r\n\r\n  return value\r\n    .split(',')\r\n    .map((entry) => entry.trim())\r\n    .filter(Boolean);\r\n};\r\n\r\nexport const WIDGET_CDN_BASE_URL =\r\n  normalizeUrl(\r\n    getEnvValue('VITE_WIDGET_CDN_BASE_URL', 'NEXT_PUBLIC_WIDGET_CDN_BASE_URL')\r\n  ) ?? DEFAULT_CDN_BASE_URL;\r\n\r\nexport const WIDGET_API_BASE_URL =\r\n  normalizeUrl(\r\n    getEnvValue('VITE_WIDGET_API_BASE_URL', 'NEXT_PUBLIC_WIDGET_API_BASE_URL')\r\n  ) ?? DEFAULT_API_BASE_URL;\r\n\r\nexport const WIDGET_TELEMETRY_ENDPOINT =\r\n  normalizeUrl(\r\n    getEnvValue('VITE_WIDGET_TELEMETRY_ENDPOINT', 'NEXT_PUBLIC_WIDGET_TELEMETRY_ENDPOINT')\r\n  ) ?? `${WIDGET_API_BASE_URL}/telemetry`;\r\n\r\nexport const WIDGET_BRANDING_URL =\r\n  normalizeUrl(\r\n    getEnvValue('VITE_WIDGET_BRANDING_URL', 'NEXT_PUBLIC_WIDGET_BRANDING_URL')\r\n  ) ?? DEFAULT_BRANDING_URL;\r\n\r\nconst additionalDomains = parseCommaSeparated(\r\n  getEnvValue('VITE_WIDGET_ALLOWED_DOMAINS', 'NEXT_PUBLIC_WIDGET_ALLOWED_DOMAINS')\r\n);\r\n\r\nexport const WIDGET_ALLOWED_DOMAINS = Array.from(\r\n  new Set(\r\n    [\r\n      toHostname(WIDGET_CDN_BASE_URL),\r\n      toHostname(WIDGET_API_BASE_URL),\r\n      ...additionalDomains,\r\n    ].filter(Boolean) as string[]\r\n  )\r\n);\r\n\r\nconst normalizeVersionSegment = (version: string): string => {\r\n  if (!version) {\r\n    return 'latest';\r\n  }\r\n\r\n  return version.startsWith('v') ? version : `v${version}`;\r\n};\r\n\r\nexport const buildWidgetScriptUrl = (version: string): string => {\r\n  return `${WIDGET_CDN_BASE_URL}/widget/${normalizeVersionSegment(version)}/tresta-widget.iife.js`;\r\n};\r\n","/**\r\n * API Client with retry logic, rate limiting, and error handling\r\n */\r\n\r\nimport { WidgetError, WidgetErrorCode } from '../types/index.js';\r\nimport type { WidgetData } from '../types/index.js';\r\nimport { NetworkClient } from './network.js';\r\nimport { retry } from './retry.js';\r\nimport { RateLimiter } from './rate-limiter.js';\r\nimport type { APIClientConfig } from './types.js';\r\nimport { Logger } from '../utils/logger.js';\r\nimport { WIDGET_API_BASE_URL } from '../config/env.js';\r\n\r\nconst DEFAULT_API_CLIENT_CONFIG: APIClientConfig = {\r\n  baseURL: WIDGET_API_BASE_URL,\r\n  timeout: 10000, // 10 seconds\r\n  maxRetries: 3,\r\n};\r\n\r\nconst DEFAULT_THEME_MODE = 'light';\r\nconst DEFAULT_PRIMARY_COLOR = '#0066FF';\r\nconst DEFAULT_SECONDARY_COLOR = '#00CC99';\r\nconst DEFAULT_MAX_TESTIMONIALS = 10;\r\nconst DEFAULT_ROTATE_INTERVAL = 5000;\r\n\r\n/**\r\n * API Client for fetching widget data\r\n */\r\nexport class APIClient {\r\n  private config: APIClientConfig;\r\n  private networkClient: NetworkClient;\r\n  private rateLimiter: RateLimiter;\r\n  private apiKey: string | undefined;\r\n  private logger: Logger | null = null;\r\n\r\n  constructor(config: Partial<APIClientConfig> = {}, apiKey?: string, logger?: Logger) {\r\n    this.config = { ...DEFAULT_API_CLIENT_CONFIG, ...config };\r\n    this.networkClient = new NetworkClient();\r\n    this.rateLimiter = new RateLimiter({\r\n      maxRequests: 100,\r\n      windowMs: 60000, // 100 requests per minute\r\n    });\r\n    this.apiKey = apiKey;\r\n    this.logger = logger || null;\r\n  }\r\n\r\n  /**\r\n   * Fetch widget data from the API\r\n   */\r\n  async fetchWidgetData(widgetId: string): Promise<WidgetData> {\r\n    // Check if API key is provided\r\n    if (!this.apiKey) {\r\n      throw new WidgetError(\r\n        WidgetErrorCode.UNAUTHORIZED,\r\n        'API key is required. Please provide an API key.',\r\n        false\r\n      );\r\n    }\r\n\r\n    // Check rate limit\r\n    if (!this.rateLimiter.isAllowed(widgetId)) {\r\n      const retryAfter = this.rateLimiter.getRetryAfter(widgetId);\r\n      const message = `Rate limit exceeded for widget ${widgetId}. Retry after ${Math.ceil(retryAfter / 1000)}s`;\r\n      if (this.logger) {\r\n        this.logger.warn(message);\r\n      } else {\r\n        console.warn(`[TrestaWidget] ${message}`);\r\n      }\r\n      throw new WidgetError(\r\n        WidgetErrorCode.RATE_LIMITED,\r\n        `Rate limit exceeded. Please try again in ${Math.ceil(retryAfter / 1000)} seconds.`,\r\n        true\r\n      );\r\n    }\r\n\r\n    // Fetch with retry logic\r\n    return retry(\r\n      async () => {\r\n        const url = `${this.config.baseURL}/api/widgets/${widgetId}/public`;\r\n\r\n        if (this.logger) {\r\n          this.logger.debug(`Fetching widget data from: ${url}`);\r\n          this.logger.debug(`Using API key: ${this.apiKey?.substring(0, 15)}...`);\r\n        }\r\n\r\n        try {\r\n          const response = await this.networkClient.request<any>(url, {\r\n            method: 'GET',\r\n            timeout: this.config.timeout,\r\n            headers: {\r\n              'Authorization': `Bearer ${this.apiKey}`,\r\n              'Content-Type': 'application/json',\r\n            },\r\n          });\r\n\r\n          if (this.logger) {\r\n            this.logger.debug('Received response:', response.status);\r\n          }\r\n\r\n          // Handle HTTP status codes and transform response\r\n          const rawData = this.handleResponse(response, widgetId);\r\n\r\n          // Transform the API response to match WidgetData interface\r\n          return this.transformApiResponse(rawData);\r\n        } catch (error) {\r\n          // Re-throw WidgetErrors as-is\r\n          if (error instanceof WidgetError) {\r\n            throw error;\r\n          }\r\n\r\n          // Wrap unknown errors\r\n          const errorMessage = `Unexpected error for widget ${widgetId}:`;\r\n          if (this.logger) {\r\n            this.logger.error(errorMessage, error);\r\n          } else {\r\n            console.error(`[TrestaWidget] ${errorMessage}`, error);\r\n          }\r\n          throw new WidgetError(\r\n            WidgetErrorCode.API_ERROR,\r\n            'An unexpected error occurred while fetching widget data',\r\n            true\r\n          );\r\n        }\r\n      },\r\n      { maxRetries: this.config.maxRetries }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Transform API response to WidgetData format\r\n   */\r\n  private transformApiResponse(apiResponse: any): WidgetData {\r\n    if (this.logger) {\r\n      this.logger.debug('Raw API response:', apiResponse);\r\n    }\r\n\r\n    // Handle both direct data and wrapped response formats\r\n    const data = apiResponse.data || apiResponse;\r\n\r\n    if (!data || !data.widget) {\r\n      const errorDetails = { hasData: !!data, hasWidget: !!(data?.widget) };\r\n      if (this.logger) {\r\n        this.logger.error('Invalid API response structure:', errorDetails);\r\n      } else {\r\n        console.error('[TrestaWidget] Invalid API response structure:', errorDetails);\r\n      }\r\n      throw new WidgetError(\r\n        WidgetErrorCode.PARSE_ERROR,\r\n        'Invalid API response format',\r\n        false\r\n      );\r\n    }\r\n\r\n    if (this.logger) {\r\n      this.logger.debug('Transforming widget data:', {\r\n        widgetId: data.widget.id,\r\n        testimonialCount: data.testimonials?.length || 0,\r\n      });\r\n    }\r\n\r\n    const settings = data.widget.settings ?? {};\r\n    const layoutType = data.widget.layout || 'grid';\r\n    const maxTestimonials = settings.maxTestimonials ?? DEFAULT_MAX_TESTIMONIALS;\r\n    const autoRotate = layoutType === 'carousel' ? settings.autoRotate ?? false : false;\r\n    const rotateInterval = settings.rotateInterval ?? DEFAULT_ROTATE_INTERVAL;\r\n    const showNavigation = layoutType === 'carousel' ? settings.showNavigation ?? true : false;\r\n    const columns = settings.columns ?? (layoutType === 'grid' ? 3 : 1);\r\n\r\n    // Transform to WidgetData format\r\n    return {\r\n      widgetId: data.widget.id,\r\n      config: {\r\n        layout: {\r\n          type: layoutType,\r\n          maxTestimonials,\r\n          autoRotate,\r\n          rotateInterval,\r\n          showNavigation,\r\n          columns,\r\n        },\r\n        theme: {\r\n          mode: settings.theme || DEFAULT_THEME_MODE,\r\n          primaryColor: data.widget.theme?.primaryColor || DEFAULT_PRIMARY_COLOR,\r\n          secondaryColor: data.widget.theme?.secondaryColor || DEFAULT_SECONDARY_COLOR,\r\n          fontFamily: settings.fontFamily,\r\n          cardStyle: settings.cardStyle || 'default',\r\n        },\r\n        display: {\r\n          showRating: settings.showRating ?? true,\r\n          showDate: settings.showDate ?? true,\r\n          showAvatar: settings.showAvatar ?? true,\r\n          showAuthorRole: settings.showAuthorRole ?? true,\r\n          showAuthorCompany: settings.showAuthorCompany ?? true,\r\n          maxTestimonials,\r\n        },\r\n      },\r\n      testimonials: (data.testimonials || []).map((t: any) => ({\r\n        id: t.id,\r\n        content: t.content,\r\n        rating: t.rating,\r\n        createdAt: t.createdAt,\r\n        isPublished: true,\r\n        isApproved: true,\r\n        isOAuthVerified: t.isOAuthVerified || false,\r\n        oauthProvider: t.oauthProvider,\r\n        author: {\r\n          name: t.authorName,\r\n          email: undefined, // Never expose email\r\n          avatar: t.authorAvatar,\r\n          role: t.authorRole,\r\n          company: t.authorCompany,\r\n        },\r\n        media: t.videoUrl ? {\r\n          type: 'video' as const,\r\n          url: t.videoUrl,\r\n        } : undefined,\r\n      })),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handle API response based on status code\r\n   */\r\n  private handleResponse<T>(\r\n    response: { data: T; status: number; headers: Headers },\r\n    widgetId: string\r\n  ): T {\r\n    const { data, status, headers } = response;\r\n\r\n    // Success responses (2xx)\r\n    if (status >= 200 && status < 300) {\r\n      return data;\r\n    }\r\n\r\n    // Handle specific error status codes\r\n    switch (status) {\r\n      case 401:\r\n      case 403: {\r\n        const message = `Unauthorized access for widget ${widgetId} (${status})`;\r\n        if (this.logger) {\r\n          this.logger.error(message);\r\n        } else {\r\n          console.error(`[TrestaWidget] ${message}`);\r\n        }\r\n        throw new WidgetError(\r\n          WidgetErrorCode.UNAUTHORIZED,\r\n          'Unable to load testimonials. Please check your widget configuration.',\r\n          false // Not recoverable\r\n        );\r\n      }\r\n\r\n      case 404: {\r\n        const message = `Widget ${widgetId} not found (404)`;\r\n        if (this.logger) {\r\n          this.logger.error(message);\r\n        } else {\r\n          console.error(`[TrestaWidget] ${message}`);\r\n        }\r\n        throw new WidgetError(\r\n          WidgetErrorCode.INVALID_WIDGET_ID,\r\n          'Widget not found. Please check your widget ID.',\r\n          false // Not recoverable\r\n        );\r\n      }\r\n\r\n      case 429: {\r\n        // Rate limited by server\r\n        const retryAfterHeader = headers.get('Retry-After');\r\n        const retryAfter = retryAfterHeader\r\n          ? parseInt(retryAfterHeader, 10) * 1000\r\n          : 60000; // Default to 60 seconds\r\n\r\n        const message = `Server rate limit for widget ${widgetId}. Retry after ${retryAfter / 1000}s`;\r\n        if (this.logger) {\r\n          this.logger.warn(message);\r\n        } else {\r\n          console.warn(`[TrestaWidget] ${message}`);\r\n        }\r\n\r\n        throw new WidgetError(\r\n          WidgetErrorCode.RATE_LIMITED,\r\n          `Rate limit exceeded. Please try again in ${Math.ceil(retryAfter / 1000)} seconds.`,\r\n          true // Recoverable with retry\r\n        );\r\n      }\r\n\r\n      case 500:\r\n      case 502:\r\n      case 503:\r\n      case 504: {\r\n        const message = `Server error for widget ${widgetId} (${status})`;\r\n        if (this.logger) {\r\n          this.logger.error(message);\r\n        } else {\r\n          console.error(`[TrestaWidget] ${message}`);\r\n        }\r\n        throw new WidgetError(\r\n          WidgetErrorCode.API_ERROR,\r\n          'Server error. Please try again later.',\r\n          true // Recoverable with retry\r\n        );\r\n      }\r\n\r\n      default: {\r\n        const message = `Unexpected status code ${status} for widget ${widgetId}`;\r\n        if (this.logger) {\r\n          this.logger.error(message);\r\n        } else {\r\n          console.error(`[TrestaWidget] ${message}`);\r\n        }\r\n        throw new WidgetError(\r\n          WidgetErrorCode.API_ERROR,\r\n          `Unexpected error (${status}). Please try again later.`,\r\n          status >= 500 // 5xx errors are recoverable\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the network client (for testing/advanced usage)\r\n   */\r\n  getNetworkClient(): NetworkClient {\r\n    return this.networkClient;\r\n  }\r\n\r\n  /**\r\n   * Get the rate limiter (for testing/advanced usage)\r\n   */\r\n  getRateLimiter(): RateLimiter {\r\n    return this.rateLimiter;\r\n  }\r\n\r\n  /**\r\n   * Update configuration\r\n   */\r\n  updateConfig(config: Partial<APIClientConfig>): void {\r\n    this.config = { ...this.config, ...config };\r\n  }\r\n\r\n  /**\r\n   * Get current configuration\r\n   */\r\n  getConfig(): APIClientConfig {\r\n    return { ...this.config };\r\n  }\r\n}\r\n","/**\r\n * IndexedDB storage adapter\r\n */\r\n\r\nimport type { CacheEntry, StorageAdapter } from './types.js';\r\n\r\nconst DB_NAME = 'tresta-widget-cache';\r\nconst DB_VERSION = 1;\r\nconst STORE_NAME = 'testimonials';\r\n\r\nexport class IndexedDBAdapter implements StorageAdapter {\r\n  private dbPromise: Promise<IDBDatabase> | null = null;\r\n  private available: boolean | null = null;\r\n\r\n  /**\r\n   * Check if IndexedDB is available (handles private browsing mode)\r\n   */\r\n  async isAvailable(): Promise<boolean> {\r\n    if (this.available !== null) {\r\n      return this.available;\r\n    }\r\n\r\n    try {\r\n      // Immediate detection of IndexedDB unavailability\r\n      if (!('indexedDB' in window)) {\r\n        this.available = false;\r\n        return false;\r\n      }\r\n\r\n      // Test if we can actually open a database (private browsing check)\r\n      const testDB = await new Promise<IDBDatabase>((resolve, reject) => {\r\n        const request = indexedDB.open('__test__', 1);\r\n        request.onerror = () => reject(request.error);\r\n        request.onsuccess = () => resolve(request.result);\r\n        request.onupgradeneeded = () => {\r\n          // Create a test store\r\n          request.result.createObjectStore('test');\r\n        };\r\n      });\r\n\r\n      testDB.close();\r\n      indexedDB.deleteDatabase('__test__');\r\n\r\n      this.available = true;\r\n      return true;\r\n    } catch (error) {\r\n      console.warn('[TrestaWidget] IndexedDB unavailable, will use localStorage fallback:', error);\r\n      this.available = false;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get or create the database connection\r\n   */\r\n  private async getDB(): Promise<IDBDatabase> {\r\n    if (this.dbPromise) {\r\n      return this.dbPromise;\r\n    }\r\n\r\n    this.dbPromise = new Promise((resolve, reject) => {\r\n      const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n      request.onerror = () => {\r\n        reject(new Error(`Failed to open IndexedDB: ${request.error}`));\r\n      };\r\n\r\n      request.onsuccess = () => {\r\n        resolve(request.result);\r\n      };\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        const db = (event.target as IDBOpenDBRequest).result;\r\n\r\n        // Create object store if it doesn't exist\r\n        if (!db.objectStoreNames.contains(STORE_NAME)) {\r\n          const store = db.createObjectStore(STORE_NAME, { keyPath: 'widgetId' });\r\n          // Create index on expiresAt for efficient cleanup\r\n          store.createIndex('expiresAt', 'expiresAt', { unique: false });\r\n        }\r\n      };\r\n    });\r\n\r\n    return this.dbPromise;\r\n  }\r\n\r\n  /**\r\n   * Get a cache entry by key\r\n   */\r\n  async get(key: string): Promise<CacheEntry | null> {\r\n    try {\r\n      const db = await this.getDB();\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readonly');\r\n        const store = transaction.objectStore(STORE_NAME);\r\n        const request = store.get(key);\r\n\r\n        request.onerror = () => reject(request.error);\r\n        request.onsuccess = () => {\r\n          const entry = request.result as CacheEntry | undefined;\r\n\r\n          // Check if entry is expired\r\n          if (entry && entry.expiresAt < Date.now()) {\r\n            // Delete expired entry asynchronously\r\n            this.delete(key).catch(() => {\r\n              // Ignore deletion errors\r\n            });\r\n            resolve(null);\r\n          } else {\r\n            resolve(entry || null);\r\n          }\r\n        };\r\n      });\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] IndexedDB get error:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set a cache entry\r\n   */\r\n  async set(_key: string, value: CacheEntry): Promise<void> {\r\n    try {\r\n      const db = await this.getDB();\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n        const store = transaction.objectStore(STORE_NAME);\r\n        const request = store.put(value);\r\n\r\n        request.onerror = () => reject(request.error);\r\n        request.onsuccess = () => resolve();\r\n      });\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] IndexedDB set error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a cache entry\r\n   */\r\n  async delete(key: string): Promise<void> {\r\n    try {\r\n      const db = await this.getDB();\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n        const store = transaction.objectStore(STORE_NAME);\r\n        const request = store.delete(key);\r\n\r\n        request.onerror = () => reject(request.error);\r\n        request.onsuccess = () => resolve();\r\n      });\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] IndexedDB delete error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all cache entries\r\n   */\r\n  async clear(): Promise<void> {\r\n    try {\r\n      const db = await this.getDB();\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n        const store = transaction.objectStore(STORE_NAME);\r\n        const request = store.clear();\r\n\r\n        request.onerror = () => reject(request.error);\r\n        request.onsuccess = () => resolve();\r\n      });\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] IndexedDB clear error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear expired entries\r\n   */\r\n  async clearExpired(): Promise<void> {\r\n    try {\r\n      const db = await this.getDB();\r\n      const now = Date.now();\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite');\r\n        const store = transaction.objectStore(STORE_NAME);\r\n        const index = store.index('expiresAt');\r\n\r\n        // Get all entries with expiresAt < now\r\n        const range = IDBKeyRange.upperBound(now);\r\n        const request = index.openCursor(range);\r\n\r\n        request.onerror = () => reject(request.error);\r\n        request.onsuccess = (event) => {\r\n          const cursor = (event.target as IDBRequest<IDBCursorWithValue>).result;\r\n          if (cursor) {\r\n            cursor.delete();\r\n            cursor.continue();\r\n          } else {\r\n            resolve();\r\n          }\r\n        };\r\n      });\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] IndexedDB clearExpired error:', error);\r\n      // Don't throw - cleanup is best effort\r\n    }\r\n  }\r\n}\r\n","/**\r\n * localStorage storage adapter (fallback)\r\n */\r\n\r\nimport type { CacheEntry, StorageAdapter } from './types.js';\r\n\r\nconst STORAGE_PREFIX = 'tresta-widget-';\r\n\r\nexport class LocalStorageAdapter implements StorageAdapter {\r\n  private available: boolean | null = null;\r\n\r\n  /**\r\n   * Check if localStorage is available\r\n   */\r\n  async isAvailable(): Promise<boolean> {\r\n    if (this.available !== null) {\r\n      return this.available;\r\n    }\r\n\r\n    try {\r\n      const testKey = '__tresta_test__';\r\n      localStorage.setItem(testKey, 'test');\r\n      localStorage.removeItem(testKey);\r\n      this.available = true;\r\n      return true;\r\n    } catch (error) {\r\n      console.warn('[TrestaWidget] localStorage unavailable:', error);\r\n      this.available = false;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a cache entry by key\r\n   */\r\n  async get(key: string): Promise<CacheEntry | null> {\r\n    try {\r\n      const storageKey = STORAGE_PREFIX + key;\r\n      const item = localStorage.getItem(storageKey);\r\n\r\n      if (!item) {\r\n        return null;\r\n      }\r\n\r\n      const entry = JSON.parse(item) as CacheEntry;\r\n\r\n      // Check if entry is expired\r\n      if (entry.expiresAt < Date.now()) {\r\n        // Delete expired entry\r\n        await this.delete(key);\r\n        return null;\r\n      }\r\n\r\n      return entry;\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] localStorage get error:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set a cache entry\r\n   */\r\n  async set(key: string, value: CacheEntry): Promise<void> {\r\n    try {\r\n      const storageKey = STORAGE_PREFIX + key;\r\n      const serialized = JSON.stringify(value);\r\n      localStorage.setItem(storageKey, serialized);\r\n    } catch (error) {\r\n      // Handle quota exceeded error\r\n      if (error instanceof DOMException &&\r\n        (error.name === 'QuotaExceededError' || error.name === 'NS_ERROR_DOM_QUOTA_REACHED')) {\r\n        console.warn('[TrestaWidget] localStorage quota exceeded, clearing old entries');\r\n        await this.clearExpired();\r\n\r\n        // Try again after cleanup\r\n        try {\r\n          const storageKey = STORAGE_PREFIX + key;\r\n          const serialized = JSON.stringify(value);\r\n          localStorage.setItem(storageKey, serialized);\r\n        } catch (retryError) {\r\n          console.error('[TrestaWidget] localStorage set error after cleanup:', retryError);\r\n          throw retryError;\r\n        }\r\n      } else {\r\n        console.error('[TrestaWidget] localStorage set error:', error);\r\n        throw error;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a cache entry\r\n   */\r\n  async delete(key: string): Promise<void> {\r\n    try {\r\n      const storageKey = STORAGE_PREFIX + key;\r\n      localStorage.removeItem(storageKey);\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] localStorage delete error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all cache entries\r\n   */\r\n  async clear(): Promise<void> {\r\n    try {\r\n      const keysToRemove: string[] = [];\r\n\r\n      // Find all keys with our prefix\r\n      for (let i = 0; i < localStorage.length; i++) {\r\n        const key = localStorage.key(i);\r\n        if (key && key.startsWith(STORAGE_PREFIX)) {\r\n          keysToRemove.push(key);\r\n        }\r\n      }\r\n\r\n      // Remove all matching keys\r\n      keysToRemove.forEach(key => localStorage.removeItem(key));\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] localStorage clear error:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear expired entries\r\n   */\r\n  async clearExpired(): Promise<void> {\r\n    try {\r\n      const now = Date.now();\r\n      const keysToRemove: string[] = [];\r\n\r\n      // Find all expired entries\r\n      for (let i = 0; i < localStorage.length; i++) {\r\n        const key = localStorage.key(i);\r\n        if (key && key.startsWith(STORAGE_PREFIX)) {\r\n          try {\r\n            const item = localStorage.getItem(key);\r\n            if (item) {\r\n              const entry = JSON.parse(item) as CacheEntry;\r\n              if (entry.expiresAt < now) {\r\n                keysToRemove.push(key);\r\n              }\r\n            }\r\n          } catch (parseError) {\r\n            // If we can't parse it, remove it\r\n            keysToRemove.push(key);\r\n          }\r\n        }\r\n      }\r\n\r\n      // Remove expired keys\r\n      keysToRemove.forEach(key => localStorage.removeItem(key));\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] localStorage clearExpired error:', error);\r\n      // Don't throw - cleanup is best effort\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Cache manager with IndexedDB and localStorage fallback\r\n */\r\n\r\nimport type { WidgetData } from '../types/index.js';\r\nimport type { CacheEntry, StorageAdapter } from './types.js';\r\nimport { IndexedDBAdapter } from './indexeddb.js';\r\nimport { LocalStorageAdapter } from './localstorage.js';\r\n\r\nconst DEFAULT_TTL = 24 * 60 * 60 * 1000; // 24 hours\r\nconst LOCALSTORAGE_TTL = 60 * 60 * 1000; // 1 hour (reduced for localStorage)\r\n\r\nexport class StorageManager {\r\n  private adapter: StorageAdapter | null = null;\r\n  private initPromise: Promise<void> | null = null;\r\n\r\n  /**\r\n   * Initialize the storage adapter\r\n   */\r\n  private async init(): Promise<void> {\r\n    if (this.initPromise) {\r\n      return this.initPromise;\r\n    }\r\n\r\n    this.initPromise = (async () => {\r\n      // Try IndexedDB first\r\n      const indexedDBAdapter = new IndexedDBAdapter();\r\n      if (await indexedDBAdapter.isAvailable()) {\r\n        this.adapter = indexedDBAdapter;\r\n        console.log('[TrestaWidget] Using IndexedDB for caching');\r\n\r\n        // Clear expired entries on initialization (don't await to avoid blocking)\r\n        this.clearExpired().catch(() => {\r\n          // Ignore cleanup errors\r\n        });\r\n        return;\r\n      }\r\n\r\n      // Fall back to localStorage\r\n      const localStorageAdapter = new LocalStorageAdapter();\r\n      if (await localStorageAdapter.isAvailable()) {\r\n        this.adapter = localStorageAdapter;\r\n        console.log('[TrestaWidget] Using localStorage for caching (IndexedDB unavailable)');\r\n\r\n        // Clear expired entries on initialization (don't await to avoid blocking)\r\n        this.clearExpired().catch(() => {\r\n          // Ignore cleanup errors\r\n        });\r\n        return;\r\n      }\r\n\r\n      // No storage available\r\n      console.warn('[TrestaWidget] No storage available, caching disabled');\r\n      this.adapter = null;\r\n    })();\r\n\r\n    return this.initPromise;\r\n  }\r\n\r\n  /**\r\n   * Get the current adapter\r\n   */\r\n  private async getAdapter(): Promise<StorageAdapter | null> {\r\n    await this.init();\r\n    return this.adapter;\r\n  }\r\n\r\n  /**\r\n   * Generate cache key for a widget ID\r\n   */\r\n  private getCacheKey(widgetId: string): string {\r\n    return `tresta-widget-${widgetId}`;\r\n  }\r\n\r\n  /**\r\n   * Get TTL based on adapter type\r\n   */\r\n  private getTTL(): number {\r\n    if (this.adapter instanceof IndexedDBAdapter) {\r\n      return DEFAULT_TTL;\r\n    } else if (this.adapter instanceof LocalStorageAdapter) {\r\n      return LOCALSTORAGE_TTL;\r\n    }\r\n    return DEFAULT_TTL;\r\n  }\r\n\r\n  /**\r\n   * Get cached widget data\r\n   */\r\n  async get(widgetId: string): Promise<WidgetData | null> {\r\n    try {\r\n      const adapter = await this.getAdapter();\r\n      if (!adapter) {\r\n        return null;\r\n      }\r\n\r\n      const key = this.getCacheKey(widgetId);\r\n      const entry = await adapter.get(key);\r\n\r\n      if (!entry) {\r\n        return null;\r\n      }\r\n\r\n      return entry.data;\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] Cache get error:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set cached widget data\r\n   */\r\n  async set(widgetId: string, data: WidgetData, ttl?: number): Promise<void> {\r\n    try {\r\n      const adapter = await this.getAdapter();\r\n      if (!adapter) {\r\n        return;\r\n      }\r\n\r\n      const key = this.getCacheKey(widgetId);\r\n      const now = Date.now();\r\n      const effectiveTTL = ttl ?? this.getTTL();\r\n\r\n      const entry: CacheEntry = {\r\n        widgetId,\r\n        data,\r\n        timestamp: now,\r\n        expiresAt: now + effectiveTTL,\r\n      };\r\n\r\n      await adapter.set(key, entry);\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] Cache set error:', error);\r\n      // Don't throw - caching is best effort\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete cached widget data\r\n   */\r\n  async delete(widgetId: string): Promise<void> {\r\n    try {\r\n      const adapter = await this.getAdapter();\r\n      if (!adapter) {\r\n        return;\r\n      }\r\n\r\n      const key = this.getCacheKey(widgetId);\r\n      await adapter.delete(key);\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] Cache delete error:', error);\r\n      // Don't throw - deletion is best effort\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all cached data\r\n   */\r\n  async clear(): Promise<void> {\r\n    try {\r\n      const adapter = await this.getAdapter();\r\n      if (!adapter) {\r\n        return;\r\n      }\r\n\r\n      await adapter.clear();\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] Cache clear error:', error);\r\n      // Don't throw - clearing is best effort\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear expired entries\r\n   */\r\n  async clearExpired(): Promise<void> {\r\n    try {\r\n      const adapter = await this.getAdapter();\r\n      if (!adapter) {\r\n        return;\r\n      }\r\n\r\n      if ('clearExpired' in adapter && typeof adapter.clearExpired === 'function') {\r\n        await adapter.clearExpired();\r\n      }\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] Cache clearExpired error:', error);\r\n      // Don't throw - cleanup is best effort\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Sampling logic for telemetry\r\n */\r\n\r\nexport class TelemetrySampler {\r\n  private samplingRate: number;\r\n\r\n  constructor(samplingRate: number = 0.01) {\r\n    // Default to 1% sampling\r\n    this.samplingRate = Math.max(0, Math.min(1, samplingRate));\r\n  }\r\n\r\n  /**\r\n   * Determine if this event should be sampled\r\n   */\r\n  shouldSample(): boolean {\r\n    return Math.random() < this.samplingRate;\r\n  }\r\n\r\n  /**\r\n   * Update the sampling rate\r\n   */\r\n  setSamplingRate(rate: number): void {\r\n    this.samplingRate = Math.max(0, Math.min(1, rate));\r\n  }\r\n\r\n  /**\r\n   * Get the current sampling rate\r\n   */\r\n  getSamplingRate(): number {\r\n    return this.samplingRate;\r\n  }\r\n}\r\n","/**\r\n * Telemetry tracker - collects anonymous usage and performance metrics\r\n * \r\n * Privacy-first design:\r\n * - No PII collected\r\n * - Respects DNT (Do Not Track)\r\n * - 1% sampling by default\r\n * - Opt-out via data-telemetry=\"false\"\r\n */\r\n\r\nimport type { TelemetryEvent, TelemetryConfig, TelemetryData } from './types.js';\r\nimport { TelemetrySampler } from './sampler.js';\r\nimport { WIDGET_TELEMETRY_ENDPOINT } from '../config/env.js';\r\n\r\nexport class TelemetryTracker {\r\n  private config: TelemetryConfig;\r\n  private sampler: TelemetrySampler;\r\n  private errorCounts: Map<string, number> = new Map();\r\n  private loadStartTime: number = 0;\r\n  private widgetId: string;\r\n  private version: string;\r\n  private layoutType?: string;\r\n\r\n  constructor(\r\n    widgetId: string,\r\n    version: string,\r\n    config: Partial<TelemetryConfig> = {}\r\n  ) {\r\n    this.widgetId = widgetId;\r\n    this.version = version;\r\n\r\n    // Check if telemetry is disabled\r\n    const telemetryDisabled = config.enabled === false;\r\n    const dntEnabled = this.isDNTEnabled();\r\n\r\n    this.config = {\r\n      enabled: !telemetryDisabled && !dntEnabled,\r\n      samplingRate: config.samplingRate ?? 0.01, // Default 1%\r\n      endpoint: config.endpoint ?? WIDGET_TELEMETRY_ENDPOINT,\r\n    };\r\n\r\n    this.sampler = new TelemetrySampler(this.config.samplingRate);\r\n  }\r\n\r\n  /**\r\n   * Check if Do Not Track is enabled\r\n   */\r\n  private isDNTEnabled(): boolean {\r\n    // Check navigator.doNotTrack\r\n    if (typeof navigator !== 'undefined') {\r\n      const dnt = (navigator as any).doNotTrack || (window as any).doNotTrack || (navigator as any).msDoNotTrack;\r\n\r\n      // DNT can be \"1\", \"yes\", or true\r\n      if (dnt === '1' || dnt === 'yes' || dnt === true) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Start tracking widget load time\r\n   */\r\n  startLoadTracking(): void {\r\n    if (!this.config.enabled) return;\r\n    this.loadStartTime = performance.now();\r\n  }\r\n\r\n  /**\r\n   * Track successful widget load\r\n   */\r\n  trackLoad(layoutType?: string): void {\r\n    if (!this.config.enabled) return;\r\n    if (!this.sampler.shouldSample()) return;\r\n\r\n    this.layoutType = layoutType || 'unknown';\r\n    const loadTime = this.loadStartTime > 0 ? performance.now() - this.loadStartTime : 0;\r\n\r\n    const event: TelemetryEvent = {\r\n      widgetId: this.widgetId,\r\n      version: this.version,\r\n      eventType: 'load',\r\n      loadTime: Math.round(loadTime),\r\n      layoutType: layoutType || 'unknown',\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    this.send(event);\r\n  }\r\n\r\n  /**\r\n   * Track an error\r\n   */\r\n  trackError(errorCode: string): void {\r\n    if (!this.config.enabled) return;\r\n\r\n    // Always track error counts locally (not sampled)\r\n    const currentCount = this.errorCounts.get(errorCode) || 0;\r\n    this.errorCounts.set(errorCode, currentCount + 1);\r\n\r\n    // Only send error events if sampled\r\n    if (!this.sampler.shouldSample()) return;\r\n\r\n    const event: TelemetryEvent = {\r\n      widgetId: this.widgetId,\r\n      version: this.version,\r\n      eventType: 'error',\r\n      errorCode,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    this.send(event);\r\n  }\r\n\r\n  /**\r\n   * Track an interaction\r\n   */\r\n  trackInteraction(layoutType?: string): void {\r\n    if (!this.config.enabled) return;\r\n    if (!this.sampler.shouldSample()) return;\r\n\r\n    const event: TelemetryEvent = {\r\n      widgetId: this.widgetId,\r\n      version: this.version,\r\n      eventType: 'interaction',\r\n      layoutType: layoutType || this.layoutType || 'unknown',\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    this.send(event);\r\n  }\r\n\r\n  /**\r\n   * Get telemetry data summary (for debugging)\r\n   */\r\n  getTelemetryData(): TelemetryData {\r\n    const loadTime = this.loadStartTime > 0 ? performance.now() - this.loadStartTime : 0;\r\n\r\n    const errorCounts: Record<string, number> = {};\r\n    this.errorCounts.forEach((count, code) => {\r\n      errorCounts[code] = count;\r\n    });\r\n\r\n    return {\r\n      widgetId: this.widgetId,\r\n      version: this.version,\r\n      loadTime: Math.round(loadTime),\r\n      layoutType: this.layoutType || 'unknown',\r\n      errorCounts,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Send telemetry event to server (non-blocking)\r\n   */\r\n  private send(event: TelemetryEvent): void {\r\n    if (!this.config.enabled || !this.config.endpoint) return;\r\n\r\n    // Use sendBeacon if available (non-blocking, survives page unload)\r\n    if (typeof navigator !== 'undefined' && navigator.sendBeacon) {\r\n      try {\r\n        const blob = new Blob([JSON.stringify(event)], { type: 'application/json' });\r\n        navigator.sendBeacon(this.config.endpoint, blob);\r\n      } catch (error) {\r\n        // Silently fail - telemetry should never break the widget\r\n        console.debug('[TrestaWidget] Telemetry sendBeacon failed:', error);\r\n      }\r\n    } else {\r\n      // Fallback to fetch with keepalive\r\n      try {\r\n        fetch(this.config.endpoint, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(event),\r\n          keepalive: true,\r\n          // No credentials - this is anonymous telemetry\r\n          credentials: 'omit',\r\n        }).catch(() => {\r\n          // Silently fail - telemetry should never break the widget\r\n        });\r\n      } catch (error) {\r\n        // Silently fail - telemetry should never break the widget\r\n        console.debug('[TrestaWidget] Telemetry fetch failed:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if telemetry is enabled\r\n   */\r\n  isEnabled(): boolean {\r\n    return this.config.enabled;\r\n  }\r\n\r\n  /**\r\n   * Update sampling rate (for per-account settings)\r\n   */\r\n  setSamplingRate(rate: number): void {\r\n    this.config.samplingRate = rate;\r\n    this.sampler.setSamplingRate(rate);\r\n  }\r\n\r\n  /**\r\n   * Disable telemetry\r\n   */\r\n  disable(): void {\r\n    this.config.enabled = false;\r\n  }\r\n\r\n  /**\r\n   * Enable telemetry (respects DNT)\r\n   */\r\n  enable(): void {\r\n    if (!this.isDNTEnabled()) {\r\n      this.config.enabled = true;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Testimonial Limiter Utility\r\n * \r\n * Handles limiting and sorting of testimonials based on configuration.\r\n * Implements Requirements: 12.1, 12.2, 12.3, 12.4, 12.5\r\n */\r\n\r\nimport type { Testimonial } from '../types/index.js';\r\n\r\n/**\r\n * Limits testimonials to the specified maximum count, prioritizing most recent.\r\n * \r\n * @param testimonials - Array of testimonials to limit\r\n * @param maxTestimonials - Maximum number of testimonials to return (default: 100)\r\n * @returns Limited array of testimonials, sorted by createdAt descending\r\n */\r\nexport function limitTestimonials(\r\n  testimonials: Testimonial[],\r\n  maxTestimonials?: number\r\n): Testimonial[] {\r\n  // Handle empty or invalid input\r\n  if (!testimonials || testimonials.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  // Default to 100 if not specified\r\n  const limit = maxTestimonials ?? 100;\r\n\r\n  // If limit is 0 or negative, return empty array\r\n  if (limit <= 0) {\r\n    return [];\r\n  }\r\n\r\n  // If we have fewer testimonials than the limit, just sort and return all\r\n  if (testimonials.length <= limit) {\r\n    return sortByCreatedAtDesc(testimonials);\r\n  }\r\n\r\n  // Sort by createdAt descending and take the first 'limit' items\r\n  return sortByCreatedAtDesc(testimonials).slice(0, limit);\r\n}\r\n\r\n/**\r\n * Sorts testimonials by createdAt in descending order (most recent first)\r\n * \r\n * @param testimonials - Array of testimonials to sort\r\n * @returns Sorted array (does not mutate original)\r\n */\r\nfunction sortByCreatedAtDesc(testimonials: Testimonial[]): Testimonial[] {\r\n  // Create a copy to avoid mutating the original array\r\n  return [...testimonials].sort((a, b) => {\r\n    const dateA = new Date(a.createdAt).getTime();\r\n    const dateB = new Date(b.createdAt).getTime();\r\n\r\n    // Sort descending (most recent first)\r\n    return dateB - dateA;\r\n  });\r\n}\r\n","/**\r\n * Centralized logging utility with debug mode support\r\n * \r\n * In production builds, console.debug calls are automatically removed by Terser\r\n * via the drop_console configuration in vite.config.ts\r\n */\r\n\r\nconst WIDGET_VERSION = '1.0.0';\r\n\r\nexport class Logger {\r\n  private widgetId: string;\r\n  private version: string;\r\n  private debugEnabled: boolean;\r\n\r\n  constructor(widgetId: string, version: string = WIDGET_VERSION, debugEnabled: boolean = false) {\r\n    this.widgetId = widgetId;\r\n    this.version = version;\r\n    this.debugEnabled = debugEnabled;\r\n  }\r\n\r\n  /**\r\n   * Log debug messages (only in debug mode, tree-shaken in production)\r\n   */\r\n  debug(message: string, ...args: any[]): void {\r\n    if (this.debugEnabled) {\r\n      console.debug(`[TrestaWidget v${this.version}]`, message, ...args);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log info messages (always shown)\r\n   */\r\n  info(message: string, ...args: any[]): void {\r\n    console.log(`[TrestaWidget v${this.version}]`, message, ...args);\r\n  }\r\n\r\n  /**\r\n   * Log warning messages (always shown)\r\n   */\r\n  warn(message: string, ...args: any[]): void {\r\n    console.warn(`[TrestaWidget v${this.version}]`, message, ...args);\r\n  }\r\n\r\n  /**\r\n   * Log error messages (always shown)\r\n   */\r\n  error(message: string, ...args: any[]): void {\r\n    console.error(`[TrestaWidget v${this.version}]`, message, ...args);\r\n  }\r\n\r\n  /**\r\n   * Log empty state (special case for requirement 20.4)\r\n   */\r\n  logEmpty(): void {\r\n    if (this.debugEnabled) {\r\n      console.debug(`[TrestaWidget v${this.version}] empty`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if debug mode is enabled\r\n   */\r\n  isDebugEnabled(): boolean {\r\n    return this.debugEnabled;\r\n  }\r\n\r\n  /**\r\n   * Get the widget ID\r\n   */\r\n  getWidgetId(): string {\r\n    return this.widgetId;\r\n  }\r\n\r\n  /**\r\n   * Get the version\r\n   */\r\n  getVersion(): string {\r\n    return this.version;\r\n  }\r\n}\r\n","/**\r\n * CSP Validator - Ensures Content Security Policy compliance\r\n * \r\n * Features:\r\n * - Validates that all resources load from allowed domains\r\n * - Detects CSP violations at runtime\r\n * - Provides nonce support for strict CSP environments\r\n * - Validates no inline scripts or eval() usage\r\n */\r\n\r\nimport {\r\n  WIDGET_ALLOWED_DOMAINS,\r\n  WIDGET_API_BASE_URL,\r\n  WIDGET_CDN_BASE_URL,\r\n  buildWidgetScriptUrl,\r\n} from '../config/env.js';\r\n\r\nexport interface CSPConfig {\r\n  allowedDomains: string[];\r\n  nonce?: string;\r\n  reportViolations?: boolean;\r\n}\r\n\r\n// Default allowed domains per requirements\r\nconst DEFAULT_ALLOWED_DOMAINS = [...WIDGET_ALLOWED_DOMAINS];\r\n\r\n/**\r\n * CSP Validator class\r\n */\r\nexport class CSPValidator {\r\n  private config: CSPConfig;\r\n  private violations: CSPViolation[] = [];\r\n\r\n  constructor(config: Partial<CSPConfig> = {}) {\r\n    this.config = {\r\n      allowedDomains: DEFAULT_ALLOWED_DOMAINS,\r\n      reportViolations: true,\r\n      ...config,\r\n    };\r\n\r\n    // Set up CSP violation listener if reporting is enabled\r\n    if (this.config.reportViolations && typeof document !== 'undefined') {\r\n      this.setupViolationListener();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validates that a URL is from an allowed domain\r\n   */\r\n  validateURL(url: string): boolean {\r\n    if (!url) {\r\n      return false;\r\n    }\r\n\r\n    // Allow relative URLs\r\n    if (url.startsWith('/') || url.startsWith('./') || url.startsWith('../')) {\r\n      return true;\r\n    }\r\n\r\n    // Allow data URLs for inline images (common for small icons)\r\n    if (url.startsWith('data:')) {\r\n      return true;\r\n    }\r\n\r\n    try {\r\n      const parsed = new URL(url);\r\n      const hostname = parsed.hostname;\r\n\r\n      // Check if hostname matches any allowed domain\r\n      return this.config.allowedDomains.some(domain => {\r\n        // Exact match or subdomain match\r\n        return hostname === domain || hostname.endsWith(`.${domain}`);\r\n      });\r\n    } catch {\r\n      // Invalid URL\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validates that all resources in the widget are from allowed domains\r\n   */\r\n  validateResources(root: HTMLElement): CSPValidationResult {\r\n    const violations: CSPViolation[] = [];\r\n\r\n    // Check all images\r\n    const images = root.querySelectorAll('img');\r\n    images.forEach(img => {\r\n      const src = img.getAttribute('src');\r\n      if (src && !this.validateURL(src)) {\r\n        violations.push({\r\n          type: 'image',\r\n          url: src,\r\n          element: img,\r\n          message: `Image source not from allowed domain: ${src}`,\r\n        });\r\n      }\r\n    });\r\n\r\n    // Check all scripts (should not exist in widget content)\r\n    const scripts = root.querySelectorAll('script');\r\n    scripts.forEach(script => {\r\n      violations.push({\r\n        type: 'script',\r\n        url: script.getAttribute('src') || 'inline',\r\n        element: script,\r\n        message: 'Script tag found in widget content (CSP violation)',\r\n      });\r\n    });\r\n\r\n    // Check all iframes (should not exist in widget content)\r\n    const iframes = root.querySelectorAll('iframe');\r\n    iframes.forEach(iframe => {\r\n      violations.push({\r\n        type: 'iframe',\r\n        url: iframe.getAttribute('src') || 'inline',\r\n        element: iframe,\r\n        message: 'Iframe found in widget content (CSP violation)',\r\n      });\r\n    });\r\n\r\n    // Check all links\r\n    const links = root.querySelectorAll('a');\r\n    links.forEach(link => {\r\n      const href = link.getAttribute('href');\r\n      if (href && href.startsWith('javascript:')) {\r\n        violations.push({\r\n          type: 'link',\r\n          url: href,\r\n          element: link,\r\n          message: 'JavaScript URL in link (CSP violation)',\r\n        });\r\n      }\r\n    });\r\n\r\n    // Check for inline event handlers\r\n    const elementsWithEvents = root.querySelectorAll('[onclick], [onload], [onerror], [onmouseover]');\r\n    elementsWithEvents.forEach(element => {\r\n      violations.push({\r\n        type: 'inline-event',\r\n        url: 'inline',\r\n        element: element as HTMLElement,\r\n        message: 'Inline event handler found (CSP violation)',\r\n      });\r\n    });\r\n\r\n    return {\r\n      valid: violations.length === 0,\r\n      violations,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Checks if the current environment has a strict CSP\r\n   */\r\n  async detectStrictCSP(): Promise<boolean> {\r\n    // Try to detect CSP by attempting to create an inline script\r\n    // This is a non-invasive check that doesn't actually execute anything\r\n    try {\r\n      const meta = document.querySelector('meta[http-equiv=\"Content-Security-Policy\"]');\r\n      if (meta) {\r\n        const content = meta.getAttribute('content') || '';\r\n        // Check for strict CSP directives\r\n        return content.includes(\"'strict-dynamic'\") ||\r\n          (!content.includes(\"'unsafe-inline'\") && !content.includes(\"'unsafe-eval'\"));\r\n      }\r\n    } catch {\r\n      // If we can't check, assume no strict CSP\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Gets the nonce value from the current script tag or config\r\n   */\r\n  getNonce(): string | null {\r\n    // First check config\r\n    if (this.config.nonce) {\r\n      return this.config.nonce;\r\n    }\r\n\r\n    // Try to find nonce from the widget script tag\r\n    if (typeof document !== 'undefined') {\r\n      const scripts = document.querySelectorAll('script[data-widget-id]');\r\n      for (const script of Array.from(scripts)) {\r\n        const nonce = script.getAttribute('nonce');\r\n        if (nonce) {\r\n          return nonce;\r\n        }\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Applies nonce to dynamically created elements if needed\r\n   */\r\n  applyNonce(element: HTMLElement): void {\r\n    const nonce = this.getNonce();\r\n    if (nonce) {\r\n      // Apply nonce to script and style tags\r\n      if (element.tagName === 'SCRIPT' || element.tagName === 'STYLE') {\r\n        element.setAttribute('nonce', nonce);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets all recorded violations\r\n   */\r\n  getViolations(): CSPViolation[] {\r\n    return [...this.violations];\r\n  }\r\n\r\n  /**\r\n   * Clears all recorded violations\r\n   */\r\n  clearViolations(): void {\r\n    this.violations = [];\r\n  }\r\n\r\n  /**\r\n   * Sets up a listener for CSP violations\r\n   */\r\n  private setupViolationListener(): void {\r\n    if (typeof document === 'undefined') {\r\n      return;\r\n    }\r\n\r\n    document.addEventListener('securitypolicyviolation', (event) => {\r\n      // Only track violations related to our widget\r\n      if (event.blockedURI && this.isWidgetRelated(event)) {\r\n        this.violations.push({\r\n          type: 'csp-violation',\r\n          url: event.blockedURI,\r\n          message: `CSP violation: ${event.violatedDirective} - ${event.blockedURI}`,\r\n          directive: event.violatedDirective,\r\n        });\r\n\r\n        console.warn('[TrestaWidget] CSP violation detected:', {\r\n          directive: event.violatedDirective,\r\n          blockedURI: event.blockedURI,\r\n          sourceFile: event.sourceFile,\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Checks if a CSP violation is related to our widget\r\n   */\r\n  private isWidgetRelated(event: SecurityPolicyViolationEvent): boolean {\r\n    // Check if the violation is from our widget domains\r\n    const blockedURI = event.blockedURI;\r\n    const sourceFile = event.sourceFile;\r\n\r\n    return (\r\n      this.config.allowedDomains.some(domain =>\r\n        blockedURI.includes(domain) || sourceFile?.includes(domain)\r\n      ) ||\r\n      sourceFile?.includes('tresta-widget') ||\r\n      blockedURI.includes('tresta-widget')\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * CSP Violation interface\r\n */\r\nexport interface CSPViolation {\r\n  type: 'image' | 'script' | 'iframe' | 'link' | 'inline-event' | 'csp-violation';\r\n  url: string;\r\n  element?: HTMLElement;\r\n  message: string;\r\n  directive?: string;\r\n}\r\n\r\n/**\r\n * CSP Validation Result\r\n */\r\nexport interface CSPValidationResult {\r\n  valid: boolean;\r\n  violations: CSPViolation[];\r\n}\r\n\r\n/**\r\n * Validates CSP compliance for required directives\r\n */\r\nexport function getRequiredCSPDirectives(): string[] {\r\n  return [\r\n    `script-src 'self' ${WIDGET_CDN_BASE_URL}`,\r\n    `connect-src ${WIDGET_API_BASE_URL}`,\r\n    `img-src ${WIDGET_CDN_BASE_URL} ${WIDGET_API_BASE_URL} data:`,\r\n    `style-src 'self' ${WIDGET_CDN_BASE_URL}`,\r\n  ];\r\n}\r\n\r\n/**\r\n * Generates CSP-friendly embed code with nonce support\r\n */\r\nexport function generateCSPFriendlyEmbedCode(\r\n  widgetId: string,\r\n  version: string,\r\n  integrity?: string,\r\n  nonce?: string\r\n): string {\r\n  const nonceAttr = nonce ? ` nonce=\"${nonce}\"` : '';\r\n  const integrityAttr = integrity ? ` integrity=\"${integrity}\" crossorigin=\"anonymous\"` : '';\r\n  const scriptSrc = buildWidgetScriptUrl(version);\r\n\r\n  return `<!-- Tresta Testimonial Widget (CSP-friendly) -->\r\n<div id=\"tresta-widget-${widgetId}\" data-widget-id=\"${widgetId}\"></div>\r\n<script async \r\n        src=\"${scriptSrc}\"${integrityAttr}${nonceAttr}\r\n        data-widget-id=\"${widgetId}\"></script>`;\r\n}\r\n\r\n// Export singleton instance\r\nexport const defaultCSPValidator = new CSPValidator();\r\n","import{options as r,Fragment as e}from\"preact\";export{Fragment}from\"preact\";var t=/[\"&<]/;function n(r){if(0===r.length||!1===t.test(r))return r;for(var e=0,n=0,o=\"\",f=\"\";n<r.length;n++){switch(r.charCodeAt(n)){case 34:f=\"&quot;\";break;case 38:f=\"&amp;\";break;case 60:f=\"&lt;\";break;default:continue}n!==e&&(o+=r.slice(e,n)),o+=f,e=n+1}return n!==e&&(o+=r.slice(e,n)),o}var o=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,f=0,i=Array.isArray;function u(e,t,n,o,i,u){t||(t={});var a,c,p=t;if(\"ref\"in p)for(c in p={},t)\"ref\"==c?a=t[c]:p[c]=t[c];var l={type:e,props:p,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--f,__i:-1,__u:0,__source:i,__self:u};if(\"function\"==typeof e&&(a=e.defaultProps))for(c in a)void 0===p[c]&&(p[c]=a[c]);return r.vnode&&r.vnode(l),l}function a(r){var t=u(e,{tpl:r,exprs:[].slice.call(arguments,1)});return t.key=t.__v,t}var c={},p=/[A-Z]/g;function l(e,t){if(r.attr){var f=r.attr(e,t);if(\"string\"==typeof f)return f}if(t=function(r){return null!==r&&\"object\"==typeof r&&\"function\"==typeof r.valueOf?r.valueOf():r}(t),\"ref\"===e||\"key\"===e)return\"\";if(\"style\"===e&&\"object\"==typeof t){var i=\"\";for(var u in t){var a=t[u];if(null!=a&&\"\"!==a){var l=\"-\"==u[0]?u:c[u]||(c[u]=u.replace(p,\"-$&\").toLowerCase()),s=\";\";\"number\"!=typeof a||l.startsWith(\"--\")||o.test(l)||(s=\"px;\"),i=i+l+\":\"+a+s}}return e+'=\"'+n(i)+'\"'}return null==t||!1===t||\"function\"==typeof t||\"object\"==typeof t?\"\":!0===t?e:e+'=\"'+n(\"\"+t)+'\"'}function s(r){if(null==r||\"boolean\"==typeof r||\"function\"==typeof r)return null;if(\"object\"==typeof r){if(void 0===r.constructor)return r;if(i(r)){for(var e=0;e<r.length;e++)r[e]=s(r[e]);return r}}return n(\"\"+r)}export{u as jsx,l as jsxAttr,u as jsxDEV,s as jsxEscape,a as jsxTemplate,u as jsxs};\n//# sourceMappingURL=jsxRuntime.module.js.map\n","function r(e){var t,f,n=\"\";if(\"string\"==typeof e||\"number\"==typeof e)n+=e;else if(\"object\"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=\" \"),n+=f)}else for(f in e)e[f]&&(n&&(n+=\" \"),n+=f);return n}export function clsx(){for(var e,t,f=0,n=\"\",o=arguments.length;f<o;f++)(e=arguments[f])&&(t=r(e))&&(n&&(n+=\" \"),n+=t);return n}export default clsx;","import { type ClassValue, clsx } from \"clsx\";\r\n\r\n/**\r\n * Lightweight class name merger.\r\n * Widget doesn't need tailwind-merge  just clsx for conditional joining.\r\n */\r\nexport function cn(...inputs: ClassValue[]): string {\r\n  return clsx(inputs);\r\n}\r\n","/**\r\n * TestimonialCard  Widget embed component\r\n *\r\n * Uses vanilla CSS classes (tresta-card-*) instead of Tailwind utilities\r\n * and inlines the Star SVG instead of importing lucide-preact.\r\n * This keeps the widget bundle lightweight.\r\n */\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport type { Testimonial, DisplayOptions, ThemeConfig } from \"@/types\";\r\n\r\ninterface TestimonialCardProps {\r\n  testimonial: Testimonial;\r\n  displayOptions: DisplayOptions;\r\n  theme: ThemeConfig;\r\n}\r\n\r\nfunction StarIcon({ filled }: { filled: boolean }) {\r\n  return (\r\n    <svg\r\n      width=\"16\"\r\n      height=\"16\"\r\n      viewBox=\"0 0 24 24\"\r\n      fill={filled ? \"#eab308\" : \"none\"}\r\n      stroke={filled ? \"#eab308\" : \"currentColor\"}\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n      className=\"tresta-star\"\r\n    >\r\n      <polygon points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function TestimonialCard({\r\n  testimonial,\r\n  displayOptions,\r\n  theme,\r\n}: TestimonialCardProps) {\r\n  const isDark = theme.mode === \"dark\";\r\n  const cardStyle = theme.cardStyle ?? \"default\";\r\n\r\n  const cardClass = cn(\r\n    \"tresta-card\",\r\n    isDark ? \"tresta-card--dark\" : \"tresta-card--light\",\r\n    `tresta-card--${cardStyle}`,\r\n  );\r\n\r\n  return (\r\n    <div className={cardClass}>\r\n      <div className=\"tresta-card__body\">\r\n        {/* Star Rating */}\r\n        {displayOptions.showRating && testimonial.rating > 0 && (\r\n          <div className=\"tresta-card__stars\">\r\n            {[1, 2, 3, 4, 5].map((star) => (\r\n              <StarIcon key={star} filled={star <= testimonial.rating} />\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {/* Content */}\r\n        <p\r\n          className={cn(\r\n            \"tresta-card__content\",\r\n            isDark\r\n              ? \"tresta-card__content--dark\"\r\n              : \"tresta-card__content--light\",\r\n          )}\r\n        >\r\n          &quot;{testimonial.content}&quot;\r\n        </p>\r\n\r\n        {/* Author */}\r\n        <div className=\"tresta-card__author\">\r\n          {displayOptions.showAvatar && (\r\n            <div\r\n              className={cn(\r\n                \"tresta-card__avatar\",\r\n                isDark\r\n                  ? \"tresta-card__avatar--dark\"\r\n                  : \"tresta-card__avatar--light\",\r\n              )}\r\n            >\r\n              {testimonial.author.avatar ? (\r\n                <img\r\n                  src={testimonial.author.avatar}\r\n                  alt={testimonial.author.name}\r\n                  className=\"tresta-card__avatar-img\"\r\n                  loading=\"lazy\"\r\n                />\r\n              ) : (\r\n                <span className=\"tresta-card__avatar-initials\">\r\n                  {getInitials(testimonial.author.name)}\r\n                </span>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          <div>\r\n            <p className=\"tresta-card__name\">{testimonial.author.name}</p>\r\n            {(displayOptions.showAuthorRole ||\r\n              displayOptions.showAuthorCompany) && (\r\n              <p className=\"tresta-card__meta\">\r\n                {displayOptions.showAuthorRole && testimonial.author.role}\r\n                {displayOptions.showAuthorRole &&\r\n                  displayOptions.showAuthorCompany &&\r\n                  \", \"}\r\n                {displayOptions.showAuthorCompany && testimonial.author.company}\r\n              </p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Date */}\r\n        {displayOptions.showDate && (\r\n          <div\r\n            className={cn(\r\n              \"tresta-card__date\",\r\n              isDark ? \"tresta-card__date--dark\" : \"tresta-card__date--light\",\r\n            )}\r\n          >\r\n            {new Date(testimonial.createdAt).toLocaleDateString(undefined, {\r\n              year: \"numeric\",\r\n              month: \"long\",\r\n              day: \"numeric\",\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(\" \")\r\n    .map((part) => part[0])\r\n    .join(\"\")\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n","/**\r\n * Grid Layout\r\n *\r\n * Responsive CSS Grid with configurable columns (14).\r\n * Cards are equal height within each row.\r\n */\r\n\r\nimport { TestimonialCard } from \"../TestimonialCard\";\r\nimport type { LayoutProps } from \"./types\";\r\n\r\nexport function GridLayout({\r\n  testimonials,\r\n  displayOptions,\r\n  theme,\r\n  layout,\r\n}: LayoutProps) {\r\n  const cols = Math.min(layout.columns ?? 3, 4);\r\n\r\n  return (\r\n    <div\r\n      className=\"tresta-grid\"\r\n      style={{\r\n        display: \"grid\",\r\n        gridTemplateColumns: `repeat(1, 1fr)`,\r\n        gap: \"16px\",\r\n      }}\r\n      data-cols={cols}\r\n    >\r\n      {testimonials.map((testimonial) => (\r\n        <TestimonialCard\r\n          key={testimonial.id}\r\n          testimonial={testimonial}\r\n          displayOptions={displayOptions}\r\n          theme={theme}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * List Layout\r\n *\r\n * Single-column, full-width cards. Clean, minimal.\r\n * Ideal for sidebars or narrow containers.\r\n */\r\n\r\nimport { TestimonialCard } from \"../TestimonialCard\";\r\nimport type { LayoutProps } from \"./types\";\r\n\r\nexport function ListLayout({\r\n  testimonials,\r\n  displayOptions,\r\n  theme,\r\n}: LayoutProps) {\r\n  return (\r\n    <div\r\n      className=\"tresta-list\"\r\n      style={{ display: \"flex\", flexDirection: \"column\", gap: \"16px\" }}\r\n    >\r\n      {testimonials.map((testimonial) => (\r\n        <TestimonialCard\r\n          key={testimonial.id}\r\n          testimonial={testimonial}\r\n          displayOptions={displayOptions}\r\n          theme={theme}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Masonry Layout\r\n *\r\n * Pinterest-style waterfall layout using CSS columns.\r\n * Cards have natural (variable) height; columns pack dynamically.\r\n */\r\n\r\nimport { TestimonialCard } from \"../TestimonialCard\";\r\nimport type { LayoutProps } from \"./types\";\r\n\r\nexport function MasonryLayout({\r\n  testimonials,\r\n  displayOptions,\r\n  theme,\r\n  layout,\r\n}: LayoutProps) {\r\n  const cols = Math.min(layout.columns ?? 3, 4);\r\n\r\n  return (\r\n    <div\r\n      className=\"tresta-masonry\"\r\n      data-cols={cols}\r\n      style={{\r\n        columnCount: 1,\r\n        columnGap: \"16px\",\r\n      }}\r\n    >\r\n      {testimonials.map((testimonial) => (\r\n        <div\r\n          key={testimonial.id}\r\n          className=\"tresta-masonry-item\"\r\n          style={{\r\n            breakInside: \"avoid\",\r\n            marginBottom: \"16px\",\r\n          }}\r\n        >\r\n          <TestimonialCard\r\n            testimonial={testimonial}\r\n            displayOptions={displayOptions}\r\n            theme={theme}\r\n          />\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import{options as n}from\"preact\";var t,r,u,i,o=0,f=[],c=n,e=c.__b,a=c.__r,v=c.diffed,l=c.__c,m=c.unmount,s=c.__;function p(n,t){c.__h&&c.__h(r,n,o||t),o=0;var u=r.__H||(r.__H={__:[],__h:[]});return n>=u.__.length&&u.__.push({}),u.__[n]}function d(n){return o=1,h(D,n)}function h(n,u,i){var o=p(t++,2);if(o.t=n,!o.__c&&(o.__=[i?i(u):D(void 0,u),function(n){var t=o.__N?o.__N[0]:o.__[0],r=o.t(t,n);t!==r&&(o.__N=[r,o.__[1]],o.__c.setState({}))}],o.__c=r,!r.__f)){var f=function(n,t,r){if(!o.__c.__H)return!0;var u=o.__c.__H.__.filter(function(n){return!!n.__c});if(u.every(function(n){return!n.__N}))return!c||c.call(this,n,t,r);var i=o.__c.props!==n;return u.forEach(function(n){if(n.__N){var t=n.__[0];n.__=n.__N,n.__N=void 0,t!==n.__[0]&&(i=!0)}}),c&&c.call(this,n,t,r)||i};r.__f=!0;var c=r.shouldComponentUpdate,e=r.componentWillUpdate;r.componentWillUpdate=function(n,t,r){if(this.__e){var u=c;c=void 0,f(n,t,r),c=u}e&&e.call(this,n,t,r)},r.shouldComponentUpdate=f}return o.__N||o.__}function y(n,u){var i=p(t++,3);!c.__s&&C(i.__H,u)&&(i.__=n,i.u=u,r.__H.__h.push(i))}function _(n,u){var i=p(t++,4);!c.__s&&C(i.__H,u)&&(i.__=n,i.u=u,r.__h.push(i))}function A(n){return o=5,T(function(){return{current:n}},[])}function F(n,t,r){o=6,_(function(){if(\"function\"==typeof n){var r=n(t());return function(){n(null),r&&\"function\"==typeof r&&r()}}if(n)return n.current=t(),function(){return n.current=null}},null==r?r:r.concat(n))}function T(n,r){var u=p(t++,7);return C(u.__H,r)&&(u.__=n(),u.__H=r,u.__h=n),u.__}function q(n,t){return o=8,T(function(){return n},t)}function x(n){var u=r.context[n.__c],i=p(t++,9);return i.c=n,u?(null==i.__&&(i.__=!0,u.sub(r)),u.props.value):n.__}function P(n,t){c.useDebugValue&&c.useDebugValue(t?t(n):n)}function b(n){var u=p(t++,10),i=d();return u.__=n,r.componentDidCatch||(r.componentDidCatch=function(n,t){u.__&&u.__(n,t),i[1](n)}),[i[0],function(){i[1](void 0)}]}function g(){var n=p(t++,11);if(!n.__){for(var u=r.__v;null!==u&&!u.__m&&null!==u.__;)u=u.__;var i=u.__m||(u.__m=[0,0]);n.__=\"P\"+i[0]+\"-\"+i[1]++}return n.__}function j(){for(var n;n=f.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(z),n.__H.__h.forEach(B),n.__H.__h=[]}catch(t){n.__H.__h=[],c.__e(t,n.__v)}}c.__b=function(n){r=null,e&&e(n)},c.__=function(n,t){n&&t.__k&&t.__k.__m&&(n.__m=t.__k.__m),s&&s(n,t)},c.__r=function(n){a&&a(n),t=0;var i=(r=n.__c).__H;i&&(u===r?(i.__h=[],r.__h=[],i.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(i.__h.forEach(z),i.__h.forEach(B),i.__h=[],t=0)),u=r},c.diffed=function(n){v&&v(n);var t=n.__c;t&&t.__H&&(t.__H.__h.length&&(1!==f.push(t)&&i===c.requestAnimationFrame||((i=c.requestAnimationFrame)||w)(j)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),u=r=null},c.__c=function(n,t){t.some(function(n){try{n.__h.forEach(z),n.__h=n.__h.filter(function(n){return!n.__||B(n)})}catch(r){t.some(function(n){n.__h&&(n.__h=[])}),t=[],c.__e(r,n.__v)}}),l&&l(n,t)},c.unmount=function(n){m&&m(n);var t,r=n.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{z(n)}catch(n){t=n}}),r.__H=void 0,t&&c.__e(t,r.__v))};var k=\"function\"==typeof requestAnimationFrame;function w(n){var t,r=function(){clearTimeout(u),k&&cancelAnimationFrame(t),setTimeout(n)},u=setTimeout(r,35);k&&(t=requestAnimationFrame(r))}function z(n){var t=r,u=n.__c;\"function\"==typeof u&&(n.__c=void 0,u()),r=t}function B(n){var t=r;n.__c=n.__(),r=t}function C(n,t){return!n||n.length!==t.length||t.some(function(t,r){return t!==n[r]})}function D(n,t){return\"function\"==typeof t?t(n):t}export{q as useCallback,x as useContext,P as useDebugValue,y as useEffect,b as useErrorBoundary,g as useId,F as useImperativeHandle,_ as useLayoutEffect,T as useMemo,h as useReducer,A as useRef,d as useState};\n//# sourceMappingURL=hooks.module.js.map\n","/**\r\n * Carousel Layout\r\n *\r\n * Horizontal slider with auto-rotation, navigation arrows,\r\n * dot indicators, and touch/swipe support.\r\n * Uses pure CSS scroll-snap for smooth, performant sliding.\r\n */\r\n\r\nimport { useState, useEffect, useRef, useCallback } from \"preact/hooks\";\r\nimport { TestimonialCard } from \"../TestimonialCard\";\r\nimport type { LayoutProps } from \"./types\";\r\n\r\nexport function CarouselLayout({\r\n  testimonials,\r\n  displayOptions,\r\n  theme,\r\n  layout,\r\n}: LayoutProps) {\r\n  const [current, setCurrent] = useState(0);\r\n  const trackRef = useRef<HTMLDivElement>(null);\r\n  const total = testimonials.length;\r\n\r\n  const autoRotate = layout.autoRotate ?? false;\r\n  const interval = layout.rotateInterval ?? 5000;\r\n  const showNav = layout.showNavigation !== false;\r\n\r\n  // Auto-rotate\r\n  useEffect(() => {\r\n    if (!autoRotate || total <= 1) return;\r\n    const timer = setInterval(() => {\r\n      setCurrent((prev) => (prev + 1) % total);\r\n    }, interval);\r\n    return () => clearInterval(timer);\r\n  }, [autoRotate, interval, total]);\r\n\r\n  // Scroll to current slide\r\n  useEffect(() => {\r\n    const track = trackRef.current;\r\n    if (!track) return;\r\n    const slide = track.children[current] as HTMLElement | undefined;\r\n    if (slide) {\r\n      slide.scrollIntoView({\r\n        behavior: \"smooth\",\r\n        block: \"nearest\",\r\n        inline: \"start\",\r\n      });\r\n    }\r\n  }, [current]);\r\n\r\n  const goTo = useCallback(\r\n    (idx: number) => {\r\n      setCurrent(((idx % total) + total) % total);\r\n    },\r\n    [total],\r\n  );\r\n\r\n  const prev = useCallback(() => goTo(current - 1), [current, goTo]);\r\n  const next = useCallback(() => goTo(current + 1), [current, goTo]);\r\n\r\n  return (\r\n    <div\r\n      className=\"tresta-carousel\"\r\n      style={{ position: \"relative\", width: \"100%\" }}\r\n    >\r\n      {/* Track */}\r\n      <div\r\n        ref={trackRef}\r\n        className=\"tresta-carousel-track\"\r\n        style={{\r\n          display: \"flex\",\r\n          overflowX: \"auto\",\r\n          scrollSnapType: \"x mandatory\",\r\n          scrollbarWidth: \"none\",\r\n          gap: \"16px\",\r\n        }}\r\n      >\r\n        {testimonials.map((testimonial) => (\r\n          <div\r\n            key={testimonial.id}\r\n            className=\"tresta-carousel-slide\"\r\n            style={{\r\n              flex: \"0 0 100%\",\r\n              scrollSnapAlign: \"start\",\r\n              minWidth: 0,\r\n            }}\r\n          >\r\n            <TestimonialCard\r\n              testimonial={testimonial}\r\n              displayOptions={displayOptions}\r\n              theme={theme}\r\n            />\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Navigation Arrows */}\r\n      {showNav && total > 1 && (\r\n        <>\r\n          <button\r\n            type=\"button\"\r\n            onClick={prev}\r\n            className=\"tresta-carousel-prev\"\r\n            aria-label=\"Previous testimonial\"\r\n          >\r\n            <svg\r\n              width=\"20\"\r\n              height=\"20\"\r\n              viewBox=\"0 0 24 24\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              stroke-width=\"2\"\r\n              stroke-linecap=\"round\"\r\n              stroke-linejoin=\"round\"\r\n            >\r\n              <polyline points=\"15 18 9 12 15 6\" />\r\n            </svg>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={next}\r\n            className=\"tresta-carousel-next\"\r\n            aria-label=\"Next testimonial\"\r\n          >\r\n            <svg\r\n              width=\"20\"\r\n              height=\"20\"\r\n              viewBox=\"0 0 24 24\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              stroke-width=\"2\"\r\n              stroke-linecap=\"round\"\r\n              stroke-linejoin=\"round\"\r\n            >\r\n              <polyline points=\"9 18 15 12 9 6\" />\r\n            </svg>\r\n          </button>\r\n        </>\r\n      )}\r\n\r\n      {/* Dot Indicators */}\r\n      {total > 1 && (\r\n        <div className=\"tresta-carousel-dots\">\r\n          {testimonials.map((_, idx) => (\r\n            <button\r\n              key={idx}\r\n              type=\"button\"\r\n              onClick={() => goTo(idx)}\r\n              className={`tresta-carousel-dot ${idx === current ? \"active\" : \"\"}`}\r\n              aria-label={`Go to testimonial ${idx + 1}`}\r\n            />\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Wall of Love Layout\r\n *\r\n * Dense, multi-column card layout with subtle random rotations\r\n * and varied sizes to create a \"wall of sticky notes\" effect.\r\n */\r\n\r\nimport { TestimonialCard } from \"../TestimonialCard\";\r\nimport type { LayoutProps } from \"./types\";\r\n\r\n/** Deterministic pseudo-random based on index for consistent renders */\r\nfunction getRotation(index: number): number {\r\n  const seed = ((index * 7 + 3) % 11) - 5; // Range: -5 to 5\r\n  return seed * 0.4; // Range: -2deg to 2deg\r\n}\r\n\r\nfunction getScale(index: number): number {\r\n  // Subtle scale variation: 0.97 to 1.03\r\n  return 1 + (((index * 13 + 5) % 7) - 3) * 0.01;\r\n}\r\n\r\nexport function WallOfLoveLayout({\r\n  testimonials,\r\n  displayOptions,\r\n  theme,\r\n  layout,\r\n}: LayoutProps) {\r\n  const cols = Math.min(layout.columns ?? 3, 4);\r\n\r\n  return (\r\n    <div\r\n      className=\"tresta-wall\"\r\n      data-cols={cols}\r\n      style={{\r\n        columnCount: 1,\r\n        columnGap: \"12px\",\r\n      }}\r\n    >\r\n      {testimonials.map((testimonial, idx) => (\r\n        <div\r\n          key={testimonial.id}\r\n          className=\"tresta-wall-item\"\r\n          style={{\r\n            breakInside: \"avoid\",\r\n            marginBottom: \"12px\",\r\n            transform: `rotate(${getRotation(idx)}deg) scale(${getScale(idx)})`,\r\n            transition: \"transform 0.3s ease\",\r\n          }}\r\n        >\r\n          <TestimonialCard\r\n            testimonial={testimonial}\r\n            displayOptions={displayOptions}\r\n            theme={theme}\r\n          />\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Marquee Layout\r\n *\r\n * Infinite horizontal scrolling testimonials (Aceternity-style).\r\n * Two rows scrolling in opposite directions, pauses on hover.\r\n * Pure CSS animation  no JS timers.\r\n */\r\n\r\nimport { TestimonialCard } from \"../TestimonialCard\";\r\nimport type { LayoutProps } from \"./types\";\r\n\r\nexport function MarqueeLayout({\r\n  testimonials,\r\n  displayOptions,\r\n  theme,\r\n}: LayoutProps) {\r\n  if (testimonials.length === 0) return null;\r\n\r\n  // Split testimonials into two rows\r\n  const mid = Math.ceil(testimonials.length / 2);\r\n  const row1 = testimonials.slice(0, mid);\r\n  const row2 = testimonials.slice(mid);\r\n\r\n  return (\r\n    <div\r\n      className=\"tresta-marquee\"\r\n      style={{ overflow: \"hidden\", width: \"100%\" }}\r\n    >\r\n      {/* Row 1: scrolls left */}\r\n      <MarqueeRow\r\n        items={row1}\r\n        displayOptions={displayOptions}\r\n        theme={theme}\r\n        direction=\"left\"\r\n      />\r\n\r\n      {/* Row 2: scrolls right (only if enough testimonials) */}\r\n      {row2.length > 0 && (\r\n        <div style={{ marginTop: \"16px\" }}>\r\n          <MarqueeRow\r\n            items={row2}\r\n            displayOptions={displayOptions}\r\n            theme={theme}\r\n            direction=\"right\"\r\n          />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface MarqueeRowProps {\r\n  items: LayoutProps[\"testimonials\"];\r\n  displayOptions: LayoutProps[\"displayOptions\"];\r\n  theme: LayoutProps[\"theme\"];\r\n  direction: \"left\" | \"right\";\r\n}\r\n\r\nfunction MarqueeRow({\r\n  items,\r\n  displayOptions,\r\n  theme,\r\n  direction,\r\n}: MarqueeRowProps) {\r\n  // Duplicate items for seamless loop\r\n  const doubled = [...items, ...items];\r\n\r\n  return (\r\n    <div\r\n      className={`tresta-marquee-row ${direction === \"right\" ? \"tresta-marquee-reverse\" : \"\"}`}\r\n    >\r\n      <div className=\"tresta-marquee-track\">\r\n        {doubled.map((testimonial, idx) => (\r\n          <div key={`${testimonial.id}-${idx}`} className=\"tresta-marquee-item\">\r\n            <TestimonialCard\r\n              testimonial={testimonial}\r\n              displayOptions={displayOptions}\r\n              theme={theme}\r\n            />\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * WidgetRoot  Root component for the Tresta Widget.\r\n *\r\n * Delegates layout rendering to dedicated layout components.\r\n * Handles theme wrapper and branding badge.\r\n */\r\n\r\nimport type { WidgetData } from \"@/types\";\r\nimport {\r\n  GridLayout,\r\n  ListLayout,\r\n  MasonryLayout,\r\n  CarouselLayout,\r\n  WallOfLoveLayout,\r\n  MarqueeLayout,\r\n} from \"./layouts\";\r\n\r\ninterface WidgetRootProps {\r\n  data: WidgetData;\r\n}\r\n\r\nexport function WidgetRoot({ data }: WidgetRootProps) {\r\n  const { testimonials, config } = data;\r\n  const { layout, display, theme } = config;\r\n\r\n  const layoutProps = { testimonials, displayOptions: display, theme, layout };\r\n\r\n  function renderLayout() {\r\n    switch (layout.type) {\r\n      case \"list\":\r\n        return <ListLayout {...layoutProps} />;\r\n      case \"masonry\":\r\n        return <MasonryLayout {...layoutProps} />;\r\n      case \"carousel\":\r\n        return <CarouselLayout {...layoutProps} />;\r\n      case \"wall\":\r\n        return <WallOfLoveLayout {...layoutProps} />;\r\n      case \"marquee\":\r\n        return <MarqueeLayout {...layoutProps} />;\r\n      case \"grid\":\r\n      default:\r\n        return <GridLayout {...layoutProps} />;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={`tresta-widget-root ${theme.mode === \"dark\" ? \"tresta-widget-root--dark\" : \"\"}`}\r\n    >\r\n      {renderLayout()}\r\n\r\n      {/* Branding Badge */}\r\n      <div className=\"tresta-branding\">\r\n        <a\r\n          href=\"https://tresta.dev\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n          className=\"tresta-branding__link\"\r\n        >\r\n          Powered by Tresta\r\n        </a>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Main Widget class - orchestrates all widget functionality\r\n */\r\n\r\nimport { render, h } from 'preact';\r\nimport type { WidgetConfig, WidgetInstance, WidgetState, WidgetData } from '../types/index.js';\r\nimport { WidgetError } from '../types/index.js';\r\nimport { StyleManager } from '../styles/style-manager.js';\r\nimport { APIClient } from '../api/client.js';\r\nimport { StorageManager } from '../storage/cache-manager.js';\r\nimport { TelemetryTracker } from '../telemetry/index.js';\r\nimport { limitTestimonials } from '../utils/testimonial-limiter.js';\r\nimport { Logger } from '../utils/logger.js';\r\nimport { CSPValidator } from '../security/csp-validator.js';\r\nimport type { CSPConfig } from '../security/csp-validator.js';\r\nimport { WIDGET_API_BASE_URL } from '../config/env.js';\r\nimport { WidgetRoot } from '../components/WidgetRoot';\r\n\r\n// Track all widget instances for proper cleanup and isolation\r\nconst widgetInstances = new WeakMap<HTMLElement, Widget>();\r\n\r\nexport class Widget implements WidgetInstance {\r\n  private config: WidgetConfig;\r\n  private state: WidgetState;\r\n  private container: HTMLElement | null = null;\r\n  private root: HTMLElement | null = null;\r\n  private styleManager: StyleManager | null = null;\r\n  private contentRoot: HTMLElement | null = null;\r\n  private liveRegion: HTMLElement | null = null;\r\n  private eventListeners: Array<{ element: HTMLElement; event: string; handler: EventListener }> = [];\r\n  private apiClient: APIClient;\r\n  private storageManager: StorageManager;\r\n  private telemetryTracker: TelemetryTracker;\r\n  private logger: Logger;\r\n  private cspValidator: CSPValidator;\r\n\r\n  constructor(config: WidgetConfig) {\r\n    this.config = config;\r\n    this.state = {\r\n      mounted: false,\r\n      loading: false,\r\n      error: null,\r\n      data: null,\r\n    };\r\n\r\n    // Initialize logger\r\n    this.logger = new Logger(\r\n      config.widgetId,\r\n      config.version || '1.0.0',\r\n      config.debug || false\r\n    );\r\n\r\n    // Initialize API client with API key and custom base URL if provided\r\n    const apiClientConfig = config.apiUrl ? { baseURL: config.apiUrl } : {};\r\n    this.apiClient = new APIClient(apiClientConfig, config.apiKey, this.logger);\r\n    this.storageManager = new StorageManager();\r\n\r\n    // Initialize telemetry tracker\r\n    this.telemetryTracker = new TelemetryTracker(\r\n      config.widgetId,\r\n      config.version || '1.0.0',\r\n      {\r\n        enabled: config.telemetry !== false,\r\n      }\r\n    );\r\n\r\n    // Initialize CSP validator\r\n    const cspConfig: Partial<CSPConfig> = {\r\n      reportViolations: config.debug || false,\r\n    };\r\n\r\n    if (config.nonce) {\r\n      cspConfig.nonce = config.nonce;\r\n    }\r\n\r\n    this.cspValidator = new CSPValidator(cspConfig);\r\n\r\n    this.logger.debug('Initialized with config:', {\r\n      widgetId: config.widgetId,\r\n      apiKey: config.apiKey ? `${config.apiKey.substring(0, 15)}...` : 'NOT PROVIDED',\r\n      apiUrl: config.apiUrl || `default (${WIDGET_API_BASE_URL})`,\r\n      debug: config.debug,\r\n      telemetry: config.telemetry,\r\n      version: config.version,\r\n    });\r\n    this.logger.debug('Telemetry enabled:', this.telemetryTracker.isEnabled());\r\n  }\r\n\r\n  async mount(container: HTMLElement): Promise<void> {\r\n    try {\r\n      // Start telemetry load tracking\r\n      this.telemetryTracker.startLoadTracking();\r\n\r\n      // Check if widget is already mounted in this container\r\n      if (widgetInstances.has(container)) {\r\n        const existingWidget = widgetInstances.get(container);\r\n        if (existingWidget && existingWidget !== this) {\r\n          console.warn(`[TrestaWidget] Container already has a widget instance. Unmounting existing widget.`);\r\n          existingWidget.unmount();\r\n        }\r\n      }\r\n\r\n      this.container = container;\r\n      this.state.mounted = true;\r\n      this.state.loading = true;\r\n\r\n      // Create widget root\r\n      this.root = document.createElement('div');\r\n      this.root.setAttribute('data-tresta-widget', this.config.widgetId);\r\n      this.root.setAttribute('data-version', this.config.version || '1.0.0');\r\n      this.root.setAttribute('data-instance-id', this.generateInstanceId());\r\n\r\n      // Add lang attribute for localization support\r\n      if (this.config.lang) {\r\n        this.root.setAttribute('lang', this.config.lang);\r\n      }\r\n\r\n      // Add role for semantic structure\r\n      this.root.setAttribute('role', 'region');\r\n      this.root.setAttribute('aria-label', 'Testimonials widget');\r\n\r\n      // Initialize style manager and get content root\r\n      this.styleManager = new StyleManager({\r\n        debug: this.config.debug ?? false,\r\n        theme: this.config.theme,\r\n        ...(this.config.useShadowDOM !== undefined && { useShadowDOM: this.config.useShadowDOM }),\r\n        nonceApplier: (element) => this.cspValidator.applyNonce(element),\r\n      });\r\n      this.contentRoot = this.styleManager.initializeStyles(this.root);\r\n\r\n      // Create ARIA live region for dynamic content announcements\r\n      this.liveRegion = document.createElement('div');\r\n      this.liveRegion.setAttribute('role', 'status');\r\n      this.liveRegion.setAttribute('aria-live', 'polite');\r\n      this.liveRegion.setAttribute('aria-atomic', 'true');\r\n      this.liveRegion.className = 'tresta-sr-only';\r\n      this.contentRoot.appendChild(this.liveRegion);\r\n\r\n      container.appendChild(this.root);\r\n\r\n      // Register this instance\r\n      widgetInstances.set(container, this);\r\n\r\n      // Fetch and render widget data\r\n      await this.fetchAndRender();\r\n\r\n      this.logger.debug('Mounted successfully to container', container);\r\n    } catch (error) {\r\n      this.state.loading = false;\r\n      this.state.error = error as Error;\r\n\r\n      // Track error in telemetry\r\n      if (error instanceof WidgetError) {\r\n        this.telemetryTracker.trackError(error.code);\r\n      } else {\r\n        this.telemetryTracker.trackError('MOUNT_ERROR');\r\n      }\r\n\r\n      // Log error with widget ID and version\r\n      this.logError('Mount failed', error);\r\n\r\n      // Render error state - don't throw to prevent breaking host page\r\n      this.renderErrorState(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch widget data with cache fallback\r\n   */\r\n  private async fetchAndRender(): Promise<void> {\r\n    try {\r\n      this.logger.debug('Starting fetchAndRender');\r\n\r\n      this.state.loading = true;\r\n\r\n      // Announce loading state to screen readers\r\n      this.announceToScreenReader('Loading testimonials');\r\n\r\n      // Try to fetch from API\r\n      const data = await this.fetchWithFallback();\r\n\r\n      this.logger.debug('Data fetched successfully:', {\r\n        widgetId: data.widgetId,\r\n        testimonialCount: data.testimonials?.length || 0,\r\n      });\r\n\r\n      this.state.data = data;\r\n      this.state.error = null;\r\n      this.state.loading = false;\r\n\r\n      // Render the widget content\r\n      this.renderContent(data);\r\n\r\n      // Track successful load with layout type\r\n      this.telemetryTracker.trackLoad(data.config?.layout?.type);\r\n\r\n      // Announce successful load to screen readers\r\n      const count = data.testimonials?.length || 0;\r\n      this.announceToScreenReader(`${count} testimonial${count !== 1 ? 's' : ''} loaded`);\r\n\r\n    } catch (error) {\r\n      this.state.loading = false;\r\n      this.state.error = error as Error;\r\n\r\n      // Track error in telemetry\r\n      if (error instanceof WidgetError) {\r\n        this.telemetryTracker.trackError(error.code);\r\n      } else {\r\n        this.telemetryTracker.trackError('FETCH_ERROR');\r\n      }\r\n\r\n      // Log error with widget ID and version\r\n      this.logError('Failed to fetch widget data', error);\r\n\r\n      // Render error state\r\n      this.renderErrorState(error);\r\n\r\n      // Announce error to screen readers\r\n      this.announceToScreenReader('Failed to load testimonials', 'assertive');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch widget data with cache fallback on errors\r\n   */\r\n  private async fetchWithFallback(): Promise<WidgetData> {\r\n    try {\r\n      // Fetch from API\r\n      const data = await this.apiClient.fetchWidgetData(this.config.widgetId);\r\n\r\n      // Cache the successful response\r\n      await this.storageManager.set(this.config.widgetId, data);\r\n\r\n      this.logger.debug('Fetched widget data from API');\r\n\r\n      return data;\r\n    } catch (error) {\r\n      // Try to use cached data as fallback\r\n      const cached = await this.storageManager.get(this.config.widgetId);\r\n\r\n      if (cached) {\r\n        this.logger.warn('Using cached data due to API error');\r\n        return cached;\r\n      }\r\n\r\n      // No cache available, re-throw the error\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render widget content\r\n   */\r\n  private renderContent(data: WidgetData): void {\r\n    this.logger.debug('renderContent called', {\r\n      hasContentRoot: !!this.contentRoot,\r\n      testimonialCount: data.testimonials?.length || 0,\r\n      widgetData: data,\r\n    });\r\n\r\n    if (!this.contentRoot) {\r\n      this.logger.error('No content root available for rendering');\r\n      return;\r\n    }\r\n\r\n    // Apply maxTestimonials limit before rendering\r\n    // Check both layoutConfig and displayOptions for maxTestimonials\r\n    const maxTestimonials = data.config.layout.maxTestimonials ?? data.config.display.maxTestimonials;\r\n    const limitedTestimonials = limitTestimonials(data.testimonials, maxTestimonials);\r\n\r\n    // Create a new data object with limited testimonials\r\n    const renderData = {\r\n      ...data,\r\n      testimonials: limitedTestimonials\r\n    };\r\n\r\n    // Preact Render\r\n    // We create a container for the app if it doesn't exist, or reuse it\r\n    let appContainer = this.contentRoot.querySelector('.tresta-app-root');\r\n    if (!appContainer) {\r\n      appContainer = document.createElement('div');\r\n      appContainer.className = 'tresta-app-root';\r\n      this.contentRoot.appendChild(appContainer);\r\n    }\r\n\r\n    render(\r\n      h(WidgetRoot, { data: renderData }),\r\n      appContainer\r\n    );\r\n\r\n    this.logger.debug(`Widget rendered successfully with Preact`);\r\n\r\n    // Validate CSP compliance in debug mode\r\n    if (this.config.debug && this.contentRoot) {\r\n      const cspResult = this.cspValidator.validateResources(this.contentRoot);\r\n      if (!cspResult.valid) {\r\n        this.logger.warn('CSP violations detected:', cspResult.violations);\r\n      } else {\r\n        this.logger.debug('CSP validation passed');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render error state\r\n   */\r\n  private renderErrorState(error: unknown): void {\r\n    if (!this.contentRoot) return;\r\n\r\n    // Determine error message\r\n    let message = this.config.errorMessage;\r\n\r\n    if (!message) {\r\n      if (error instanceof WidgetError) {\r\n        message = error.message;\r\n      } else {\r\n        message = 'Unable to load testimonials. Please try again later.';\r\n      }\r\n    }\r\n\r\n    // TODO: Use Preact Error Component\r\n    this.contentRoot.innerHTML = `<div class=\"tresta-error\">${message}</div>`;\r\n  }\r\n\r\n  /**\r\n   * Log error with widget ID and version\r\n   */\r\n  private logError(context: string, error: unknown): void {\r\n    if (error instanceof WidgetError) {\r\n      this.logger.error(\r\n        `${context} for widget ${this.config.widgetId}:`,\r\n        `[${error.code}]`,\r\n        error.message\r\n      );\r\n    } else if (error instanceof Error) {\r\n      this.logger.error(\r\n        `${context} for widget ${this.config.widgetId}:`,\r\n        error.message\r\n      );\r\n    } else {\r\n      this.logger.error(\r\n        `${context} for widget ${this.config.widgetId}:`,\r\n        error\r\n      );\r\n    }\r\n  }\r\n\r\n  unmount(): void {\r\n    try {\r\n      // Unmount Preact\r\n      if (this.contentRoot) {\r\n        const appContainer = this.contentRoot.querySelector('.tresta-app-root');\r\n        if (appContainer) {\r\n          render(null, appContainer);\r\n        }\r\n      }\r\n\r\n      // Remove all event listeners\r\n      this.cleanupEventListeners();\r\n\r\n      // Clean up style manager\r\n      if (this.styleManager) {\r\n        this.styleManager.cleanup();\r\n        this.styleManager = null;\r\n      }\r\n\r\n      // Remove widget root from DOM\r\n      if (this.root && this.root.parentNode) {\r\n        this.root.parentNode.removeChild(this.root);\r\n        this.root = null;\r\n      }\r\n\r\n      // Unregister instance\r\n      if (this.container) {\r\n        widgetInstances.delete(this.container);\r\n      }\r\n\r\n      this.state.mounted = false;\r\n      this.container = null;\r\n      this.contentRoot = null;\r\n\r\n      this.logger.debug('Unmounted successfully');\r\n    } catch (error) {\r\n      console.error('[TrestaWidget] Unmount failed:', error);\r\n    }\r\n  }\r\n\r\n  async refresh(): Promise<void> {\r\n    try {\r\n      this.logger.debug('Refresh requested');\r\n\r\n      if (!this.state.mounted) {\r\n        this.logger.warn('Cannot refresh: widget not mounted');\r\n        return;\r\n      }\r\n\r\n      // Fetch and render fresh data\r\n      await this.fetchAndRender();\r\n    } catch (error) {\r\n      // Error is already handled in fetchAndRender\r\n      // Just log for debugging\r\n      this.logError('Refresh failed', error);\r\n    }\r\n  }\r\n\r\n  getState(): WidgetState {\r\n    return { ...this.state };\r\n  }\r\n\r\n  /**\r\n   * Clean up all event listeners\r\n   */\r\n  private cleanupEventListeners(): void {\r\n    this.eventListeners.forEach(({ element, event, handler }) => {\r\n      element.removeEventListener(event, handler);\r\n    });\r\n    this.eventListeners = [];\r\n  }\r\n\r\n  /**\r\n   * Generate a unique instance ID for this widget\r\n   */\r\n  private generateInstanceId(): string {\r\n    return `${this.config.widgetId}-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;\r\n  }\r\n\r\n  /**\r\n   * Announces a message to screen readers via ARIA live region\r\n   */\r\n  private announceToScreenReader(\r\n    message: string,\r\n    priority: 'polite' | 'assertive' = 'polite'\r\n  ): void {\r\n    if (!this.liveRegion) return;\r\n\r\n    // Update the priority if needed\r\n    this.liveRegion.setAttribute('aria-live', priority);\r\n\r\n    // Update the message\r\n    this.liveRegion.textContent = message;\r\n\r\n    // Clear the message after a delay to allow for repeated announcements\r\n    setTimeout(() => {\r\n      if (this.liveRegion) {\r\n        this.liveRegion.textContent = '';\r\n      }\r\n    }, 1000);\r\n  }\r\n\r\n  /**\r\n   * Get the widget instance for a container\r\n   */\r\n  static getInstance(container: HTMLElement): Widget | undefined {\r\n    return widgetInstances.get(container);\r\n  }\r\n\r\n  /**\r\n   * Get the style manager (for testing)\r\n   */\r\n  getStyleManager(): StyleManager | null {\r\n    return this.styleManager;\r\n  }\r\n\r\n  /**\r\n   * Get the content root element (for testing)\r\n   */\r\n  getContentRoot(): HTMLElement | null {\r\n    return this.contentRoot;\r\n  }\r\n\r\n  /**\r\n   * Get the telemetry tracker (for testing and debugging)\r\n   */\r\n  getTelemetryTracker(): TelemetryTracker {\r\n    return this.telemetryTracker;\r\n  }\r\n}\r\n","/**\r\n * Auto-initialization logic for widgets embedded via script tag\r\n */\r\n\r\nimport { Widget } from './widget.js';\r\nimport { parseWidgetConfig, validateConfig } from './config.js';\r\nimport type { WidgetConfig } from '../types/index.js';\r\n\r\n/**\r\n * Parse configuration from data attributes on script tag or container\r\n */\r\nfunction parseConfig(element: HTMLScriptElement | HTMLElement): WidgetConfig {\r\n  const config = parseWidgetConfig(element);\r\n\r\n  // Validate the configuration\r\n  if (!validateConfig(config)) {\r\n    throw new Error('[TrestaWidget] Invalid widget configuration');\r\n  }\r\n\r\n  return config;\r\n}\r\n\r\n/**\r\n * Find container for widget\r\n */\r\nfunction findContainer(script: HTMLScriptElement, widgetId: string): HTMLElement {\r\n  const containerSelector = script.getAttribute('data-container');\r\n\r\n  if (containerSelector) {\r\n    const container = document.querySelector(containerSelector);\r\n    if (!container) {\r\n      throw new Error(`[TrestaWidget] Container not found: ${containerSelector}`);\r\n    }\r\n    return container as HTMLElement;\r\n  }\r\n\r\n  // Look for div with matching widget ID\r\n  const defaultContainer = document.getElementById(`tresta-widget-${widgetId}`);\r\n  if (defaultContainer) {\r\n    return defaultContainer;\r\n  }\r\n\r\n  // Create container inline after script tag\r\n  const container = document.createElement('div');\r\n  container.id = `tresta-widget-${widgetId}`;\r\n  script.parentNode?.insertBefore(container, script.nextSibling);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Initialize a single widget from a script tag\r\n */\r\nfunction initializeWidget(script: HTMLScriptElement): void {\r\n  try {\r\n    const config = parseConfig(script);\r\n    const container = findContainer(script, config.widgetId);\r\n\r\n    // Check if already initialized\r\n    const existingInstance = Widget.getInstance(container);\r\n    if (existingInstance) {\r\n      if (config.debug) {\r\n        console.debug(`[TrestaWidget v${config.version || '1.0.0'}] Widget ${config.widgetId} already initialized in container`);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Create and mount new widget instance\r\n    const widget = new Widget(config);\r\n    widget.mount(container);\r\n  } catch (error) {\r\n    console.error('[TrestaWidget] Failed to initialize widget:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Auto-initialize all widgets on the page\r\n */\r\nexport function autoInitialize(): void {\r\n  try {\r\n    const scripts = document.querySelectorAll(\r\n      'script[data-widget-id], script[data-tresta-widget]'\r\n    );\r\n\r\n    if (scripts.length === 0) {\r\n      // No widgets to initialize\r\n      return;\r\n    }\r\n\r\n    // Initialize each widget independently\r\n    scripts.forEach((script) => {\r\n      initializeWidget(script as HTMLScriptElement);\r\n    });\r\n  } catch (error) {\r\n    console.error('[TrestaWidget] Auto-initialization failed:', error);\r\n  }\r\n}\r\n","/**\r\n * Configuration parser and validator\r\n */\r\n\r\nimport type { WidgetConfig, ThemeConfig } from '../types/index.js';\r\nimport { ThemeManager } from '../styles/theme-manager.js';\r\n\r\nfunction getWidgetId(element: HTMLElement): string | null {\r\n  return (\r\n    element.getAttribute('data-widget-id') ||\r\n    element.getAttribute('data-tresta-widget')\r\n  );\r\n}\r\n\r\nexport function parseWidgetConfig(element: HTMLElement): Partial<WidgetConfig> {\r\n  const widgetId = getWidgetId(element);\r\n  const apiKey = element.getAttribute('data-api-key');\r\n  const version = element.getAttribute('data-version');\r\n  const apiUrl = element.getAttribute('data-api-url');\r\n  const nonce = element.getAttribute('nonce');\r\n\r\n  const config: Partial<WidgetConfig> = {\r\n    debug: element.getAttribute('data-debug') === 'true',\r\n    telemetry: element.getAttribute('data-telemetry') !== 'false',\r\n  };\r\n\r\n  if (widgetId) {\r\n    config.widgetId = widgetId;\r\n  }\r\n\r\n  if (apiKey) {\r\n    config.apiKey = apiKey;\r\n  }\r\n\r\n  if (version) {\r\n    config.version = version;\r\n  } else {\r\n    config.version = '1.0.0';\r\n  }\r\n\r\n  if (apiUrl) {\r\n    config.apiUrl = apiUrl;\r\n  }\r\n\r\n  if (nonce) {\r\n    config.nonce = nonce;\r\n  }\r\n\r\n  // Parse theme configuration from data attributes\r\n  const themeConfig = ThemeManager.parseThemeFromElement(element);\r\n  if (Object.keys(themeConfig).length > 0) {\r\n    config.theme = themeConfig as ThemeConfig;\r\n  }\r\n\r\n  return config;\r\n}\r\n\r\nexport function validateConfig(config: Partial<WidgetConfig>): config is WidgetConfig {\r\n  if (!config.widgetId) {\r\n    throw new Error('[TrestaWidget] widgetId is required');\r\n  }\r\n  if (!config.apiKey) {\r\n    throw new Error('[TrestaWidget] apiKey is required');\r\n  }\r\n  return true;\r\n}\r\n","/**\r\n * Tresta Widget - CDN-delivered testimonial widget system\r\n * @version 1.0.0\r\n */\r\n\r\nimport { Widget } from './core/widget.js';\r\nimport { autoInitialize } from './core/loader.js';\r\nimport type { WidgetConfig, WidgetInstance } from './types/index.js';\r\n\r\n// Expose global API\r\nexport const TrestaWidget = {\r\n  /**\r\n   * Programmatically mount a widget instance\r\n   * @param element - Container element or CSS selector\r\n   * @param config - Widget configuration\r\n   * @returns Widget instance\r\n   */\r\n  async mount(element: string | HTMLElement, config: WidgetConfig): Promise<WidgetInstance> {\r\n    const container = typeof element === 'string'\r\n      ? document.querySelector(element)\r\n      : element;\r\n\r\n    if (!container) {\r\n      throw new Error(`[TrestaWidget] Container not found: ${element}`);\r\n    }\r\n\r\n    const widget = new Widget(config);\r\n    await widget.mount(container as HTMLElement);\r\n    return widget;\r\n  },\r\n\r\n  /**\r\n   * Unmount a widget instance\r\n   * @param element - Container element or CSS selector\r\n   */\r\n  unmount(element: string | HTMLElement): void {\r\n    const container = typeof element === 'string'\r\n      ? document.querySelector(element)\r\n      : element;\r\n\r\n    if (!container) {\r\n      console.warn(`[TrestaWidget] Container not found: ${element}`);\r\n      return;\r\n    }\r\n\r\n    // Get the widget instance and unmount it properly\r\n    const instance = Widget.getInstance(container as HTMLElement);\r\n    if (instance) {\r\n      instance.unmount();\r\n    } else {\r\n      console.warn(`[TrestaWidget] No widget instance found in container`);\r\n    }\r\n  },\r\n\r\n  version: '1.0.0',\r\n};\r\n\r\n// Auto-initialize widgets on page load\r\nif (typeof window !== 'undefined') {\r\n  // Expose to global scope\r\n  (window as any).TrestaWidget = TrestaWidget;\r\n\r\n  // Initialize when DOM is ready\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', autoInitialize);\r\n  } else {\r\n    // DOM is already ready, initialize immediately\r\n    autoInitialize();\r\n  }\r\n}\r\n\r\nexport { Widget };\r\nexport type { WidgetConfig, WidgetInstance };\r\n"],"names":["n","l","u","i","r","o","e","f","c","s","a","p","v","y","w","Array","isArray","d","g","parentNode","removeChild","_","t","arguments","length","children","call","defaultProps","m","type","props","key","ref","__k","__","__b","__e","__c","constructor","__v","__i","__u","vnode","k","x","this","context","S","C","base","M","__d","push","$","__r","debounceRendering","sort","shift","__P","O","__n","namespaceURI","N","I","h","b","String","L","D","P","B","A","nextSibling","insertBefore","nodeType","T","setProperty","test","j","style","cssText","replace","toLowerCase","slice","addEventListener","removeEventListener","removeAttribute","setAttribute","F","event","H","prototype","render","contextType","value","__E","E","sub","state","__h","_sb","__s","getDerivedStateFromProps","componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","some","componentWillUpdate","componentDidUpdate","getChildContext","getSnapshotBeforeUpdate","V","then","indexOf","z","localName","document","createTextNode","createElementNS","is","__m","data","childNodes","attributes","name","__html","innerHTML","content","q","diffed","forEach","map","current","unmount","componentWillUnmount","G","documentElement","firstChild","getDerivedStateFromError","setState","componentDidCatch","forceUpdate","Promise","bind","resolve","setTimeout","WidgetErrorCode","WidgetError","Error","code","message","recoverable","super","ThemeManager","config","__publicField","theme","getDefaultTheme","debug","console","log","mode","primaryColor","secondaryColor","cardStyle","applyTheme","root","applyThemeMode","applyColors","applyFontFamily","applyCardStyle","effectiveMode","detectPreferredColorScheme","window","matchMedia","matches","fontFamily","fontFamilyWithFallback","updateTheme","getTheme","parseThemeFromElement","element","getAttribute","BASE_STYLES","StyleManager","useShadowDOM","detectShadowDOMSupport","nonceApplier","themeConfig","themeManager","Element","initializeStyles","container","initializeShadowDOM","initializeNamespacedCSS","shadowRoot","attachShadow","styleElement","createElement","applyNonce","textContent","getShadowDOMStyles","appendChild","contentWrapper","classList","add","getElementById","id","getNamespacedStyles","head","namespacedStyles","cleanup","getThemeManager","isShadowDOM","getShadowRoot","NetworkClient","addRequestInterceptor","interceptor","requestInterceptors","addResponseInterceptor","responseInterceptors","request","url","options","modifiedUrl","modifiedOptions","result","response","async","method","headers","body","timeout","controller","AbortController","timeoutId","abort","fetchOptions","signal","credentials","JSON","stringify","fetch","clearTimeout","contentType","get","includes","json","text","status","error","API_TIMEOUT","TypeError","NETWORK_ERROR","fetchWithTimeout","DEFAULT_RETRY_CONFIG","maxRetries","baseDelay","maxDelay","jitter","calculateDelay","attempt","exponentialDelay","Math","pow","random","min","sleep","ms","isRetryableError","retryableCodes","API_ERROR","DEFAULT_RATE_LIMITER_CONFIG","maxRequests","windowMs","RateLimiter","Map","isAllowed","now","Date","record","getOrCreateRecord","timestamps","filter","timestamp","getRetryAfter","records","oldestTimestamp","retryAfter","max","reset","delete","resetAll","clear","getRequestCount","set","updateConfig","getConfig","envSource","_documentCurrentScript","tagName","toUpperCase","src","URL","baseURI","href","__vite_import_meta_env__","globalProcess","globalThis","process","env","getEnvSource","getEnvValue","keys","trim","normalizeUrl","toHostname","hostname","WIDGET_CDN_BASE_URL","WIDGET_API_BASE_URL","WIDGET_TELEMETRY_ENDPOINT","additionalDomains","split","entry","Boolean","WIDGET_ALLOWED_DOMAINS","from","Set","DEFAULT_API_CLIENT_CONFIG","baseURL","APIClient","apiKey","logger","networkClient","rateLimiter","fetchWidgetData","widgetId","UNAUTHORIZED","ceil","warn","RATE_LIMITED","fn","retryConfig","lastError","delay","round","retry","substring","Authorization","rawData","handleResponse","transformApiResponse","errorMessage","apiResponse","widget","errorDetails","hasData","hasWidget","PARSE_ERROR","testimonialCount","testimonials","settings","layoutType","layout","maxTestimonials","autoRotate","rotateInterval","showNavigation","columns","display","showRating","showDate","showAvatar","showAuthorRole","showAuthorCompany","rating","createdAt","isPublished","isApproved","isOAuthVerified","oauthProvider","author","authorName","email","avatar","authorAvatar","role","authorRole","company","authorCompany","media","videoUrl","INVALID_WIDGET_ID","retryAfterHeader","parseInt","getNetworkClient","getRateLimiter","STORE_NAME","IndexedDBAdapter","isAvailable","available","reject","indexedDB","open","onerror","onsuccess","onupgradeneeded","createObjectStore","close","deleteDatabase","getDB","dbPromise","db","target","objectStoreNames","contains","keyPath","createIndex","unique","transaction","objectStore","expiresAt","catch","_key","put","clearExpired","index","range","IDBKeyRange","upperBound","openCursor","cursor","continue","STORAGE_PREFIX","LocalStorageAdapter","testKey","localStorage","setItem","removeItem","storageKey","item","getItem","parse","serialized","DOMException","retryError","keysToRemove","startsWith","parseError","DEFAULT_TTL","StorageManager","init","initPromise","indexedDBAdapter","adapter","localStorageAdapter","getAdapter","getCacheKey","getTTL","ttl","TelemetrySampler","samplingRate","shouldSample","setSamplingRate","rate","getSamplingRate","TelemetryTracker","version","telemetryDisabled","enabled","dntEnabled","isDNTEnabled","endpoint","sampler","navigator","dnt","doNotTrack","msDoNotTrack","startLoadTracking","loadStartTime","performance","trackLoad","loadTime","eventType","send","trackError","errorCode","currentCount","errorCounts","trackInteraction","getTelemetryData","count","sendBeacon","blob","Blob","keepalive","isEnabled","disable","enable","sortByCreatedAtDesc","dateA","getTime","Logger","debugEnabled","args","info","logEmpty","isDebugEnabled","getWidgetId","getVersion","DEFAULT_ALLOWED_DOMAINS","CSPValidator","allowedDomains","reportViolations","setupViolationListener","validateURL","domain","endsWith","validateResources","violations","querySelectorAll","img","script","iframe","link","valid","detectStrictCSP","meta","querySelector","getNonce","nonce","scripts","getViolations","clearViolations","blockedURI","isWidgetRelated","violatedDirective","directive","sourceFile","__source","__self","cn","inputs","clsx","StarIcon","filled","jsx","width","height","viewBox","fill","stroke","className","points","TestimonialCard","testimonial","displayOptions","isDark","jsxs","star","alt","loading","part","join","toLocaleDateString","year","month","day","GridLayout","gridTemplateColumns","gap","ListLayout","flexDirection","MasonryLayout","columnCount","columnGap","breakInside","marginBottom","__H","__N","requestAnimationFrame","cancelAnimationFrame","CarouselLayout","setCurrent","__f","every","useState","trackRef","total","interval","showNav","useEffect","timer","setInterval","prev","clearInterval","track","slide","scrollIntoView","behavior","block","inline","goTo","useCallback","idx","next","position","overflowX","scrollSnapType","scrollbarWidth","flex","scrollSnapAlign","minWidth","Fragment","onClick","getScale","WallOfLoveLayout","transform","transition","MarqueeLayout","mid","row1","row2","overflow","MarqueeRow","items","direction","marginTop","WidgetRoot","layoutProps","renderLayout","rel","widgetInstances","WeakMap","Widget","mounted","apiClientConfig","apiUrl","apiClient","storageManager","telemetryTracker","telemetry","cspConfig","cspValidator","mount","has","existingWidget","generateInstanceId","lang","styleManager","contentRoot","liveRegion","fetchAndRender","logError","renderErrorState","announceToScreenReader","fetchWithFallback","renderContent","cached","hasContentRoot","widgetData","limitedTestimonials","limit","limitTestimonials","renderData","appContainer","cspResult","cleanupEventListeners","refresh","getState","eventListeners","handler","toString","priority","getInstance","getStyleManager","getContentRoot","getTelemetryTracker","initializeWidget","Object","parseWidgetConfig","validateConfig","parseConfig","containerSelector","defaultContainer","findContainer","autoInitialize","TrestaWidget","instance","readyState"],"mappings":"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","x_google_ignoreList":[0,17,18,24]}