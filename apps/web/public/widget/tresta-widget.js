var TrestaWidgetLib=function(t){"use strict";var e=Object.defineProperty,r=(t,r,a)=>((t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a)(t,"symbol"!=typeof r?r+"":r,a),a="undefined"!=typeof document?document.currentScript:null,i=(t=>(t.INVALID_WIDGET_ID="INVALID_WIDGET_ID",t.API_TIMEOUT="API_TIMEOUT",t.API_ERROR="API_ERROR",t.NETWORK_ERROR="NETWORK_ERROR",t.RATE_LIMITED="RATE_LIMITED",t.UNAUTHORIZED="UNAUTHORIZED",t.PARSE_ERROR="PARSE_ERROR",t.RENDER_ERROR="RENDER_ERROR",t))(i||{});class s extends Error{constructor(t,e,r=!0){super(e),this.code=t,this.recoverable=r,this.name="WidgetError"}}class o{constructor(t={}){r(this,"theme"),r(this,"debug"),this.theme=t.theme??this.getDefaultTheme(),this.debug=t.debug??!1,this.debug&&console.log("[TrestaWidget] ThemeManager initialized with theme:",this.theme)}getDefaultTheme(){return{mode:"light",primaryColor:"#3b82f6",secondaryColor:"#64748b",cardStyle:"default"}}applyTheme(t){this.applyThemeMode(t),this.applyColors(t),this.applyFontFamily(t),this.applyCardStyle(t),this.debug&&console.log("[TrestaWidget] Theme applied to root element")}applyThemeMode(t){let e=this.theme.mode;"auto"===e&&(e=this.detectPreferredColorScheme()),t.setAttribute("data-theme",e)}detectPreferredColorScheme(){return"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}applyColors(t){t.style.setProperty("--tresta-primary-color",this.theme.primaryColor),t.style.setProperty("--tresta-secondary-color",this.theme.secondaryColor)}applyFontFamily(t){if(this.theme.fontFamily){const e=`${this.theme.fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif`;t.style.setProperty("--tresta-font-family",e)}}applyCardStyle(t){t.setAttribute("data-card-style",this.theme.cardStyle)}updateTheme(t){this.theme={...this.theme,...t},this.debug&&console.log("[TrestaWidget] Theme updated:",this.theme)}getTheme(){return{...this.theme}}static parseThemeFromElement(t){const e={},r=t.getAttribute("data-theme-mode");"light"!==r&&"dark"!==r&&"auto"!==r||(e.mode=r);const a=t.getAttribute("data-primary-color");a&&(e.primaryColor=a);const i=t.getAttribute("data-secondary-color");i&&(e.secondaryColor=i);const s=t.getAttribute("data-font-family");s&&(e.fontFamily=s);const o=t.getAttribute("data-card-style");return"default"!==o&&"minimal"!==o&&"bordered"!==o||(e.cardStyle=o),e}}const n='\n:root{--tresta-primary-color: #3b82f6;--tresta-secondary-color: #64748b;--tresta-text-color: #1e293b;--tresta-bg-color: #ffffff;--tresta-border-color: #e2e8f0;--tresta-border-radius: 8px;--tresta-spacing: 16px;--tresta-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;--tresta-theme-bg: #ffffff;--tresta-theme-text: #1e293b;--tresta-theme-border: #e2e8f0;--tresta-theme-shadow: rgba(0, 0, 0, .1);--tresta-card-bg: #ffffff;--tresta-card-border: #e2e8f0;--tresta-card-shadow: 0 1px 3px 0 rgba(0, 0, 0, .1), 0 1px 2px 0 rgba(0, 0, 0, .06);--tresta-card-padding: 16px}:root[data-theme=dark]{--tresta-theme-bg: #1e293b;--tresta-theme-text: #f1f5f9;--tresta-theme-border: #334155;--tresta-theme-shadow: rgba(0, 0, 0, .3);--tresta-card-bg: #334155;--tresta-card-border: #475569;--tresta-card-shadow: 0 1px 3px 0 rgba(0, 0, 0, .3), 0 1px 2px 0 rgba(0, 0, 0, .2);--tresta-text-color: #f1f5f9;--tresta-bg-color: #1e293b;--tresta-border-color: #334155}[data-tresta-widget]{font-family:var(--tresta-font-family);color:var(--tresta-text-color);background-color:var(--tresta-bg-color);box-sizing:border-box;line-height:1.5;font-size:16px;all:revert;display:block}[data-tresta-widget] *,[data-tresta-widget] *:before,[data-tresta-widget] *:after{box-sizing:border-box}[data-tresta-widget] p,[data-tresta-widget] h1,[data-tresta-widget] h2,[data-tresta-widget] h3,[data-tresta-widget] h4,[data-tresta-widget] h5,[data-tresta-widget] h6{margin:0;padding:0;font-weight:400}[data-tresta-widget] button{font-family:inherit;cursor:pointer;border:none;background:none;padding:0;margin:0;color:inherit}[data-tresta-widget] img{max-width:100%;height:auto;display:block;border:none}[data-tresta-widget] a{color:var(--tresta-primary-color);text-decoration:none}[data-tresta-widget] a:hover{text-decoration:underline}[data-tresta-widget] .widget-container{padding:var(--tresta-spacing);border:2px solid var(--tresta-border-color);border-radius:var(--tresta-border-radius);background-color:var(--tresta-bg-color)}[data-tresta-widget] .widget-loading{text-align:center;color:var(--tresta-secondary-color);padding:var(--tresta-spacing)}[data-tresta-widget] .widget-error{text-align:center;color:#dc2626;padding:var(--tresta-spacing)}[data-tresta-widget] .widget-empty{text-align:center;color:var(--tresta-secondary-color);padding:var(--tresta-spacing)}[data-tresta-widget] .tresta-branding-badge{margin-top:1.5rem;display:flex;justify-content:flex-end}[data-tresta-widget] .tresta-branding-link{display:inline-flex;align-items:center;gap:.35rem;font-size:12px;line-height:1;color:var(--tresta-secondary-color);border:1px solid var(--tresta-border-color);border-radius:999px;padding:.3rem .85rem;text-decoration:none;transition:color .2s ease,border-color .2s ease,background-color .2s ease}[data-tresta-widget] .tresta-branding-link:hover,[data-tresta-widget] .tresta-branding-link:focus-visible{color:var(--tresta-primary-color);border-color:var(--tresta-primary-color);background-color:#3b82f614}[data-tresta-widget] .tresta-branding-logo{display:inline-flex;width:18px;height:18px}[data-tresta-widget] .tresta-branding-logo svg{display:block;width:100%;height:100%}[data-tresta-widget] .tresta-branding-text{font-weight:500}[data-tresta-widget][data-card-style=default] .testimonial-card{background-color:var(--tresta-card-bg);border:1px solid var(--tresta-card-border);border-radius:var(--tresta-border-radius);box-shadow:var(--tresta-card-shadow);padding:var(--tresta-card-padding)}[data-tresta-widget][data-card-style=minimal] .testimonial-card{background-color:transparent;border:none;border-radius:0;box-shadow:none;padding:var(--tresta-card-padding)}[data-tresta-widget][data-card-style=bordered] .testimonial-card{background-color:var(--tresta-card-bg);border:2px solid var(--tresta-primary-color);border-radius:var(--tresta-border-radius);box-shadow:none;padding:var(--tresta-card-padding)}@media(min-width:576px){:root{--tresta-spacing: 20px;--tresta-card-padding: 20px}[data-tresta-widget]{font-size:16px}}@media(min-width:768px){:root{--tresta-spacing: 24px;--tresta-card-padding: 24px}}@media(min-width:1024px){:root{--tresta-spacing: 32px;--tresta-card-padding: 28px}}@media(min-width:1440px){:root{--tresta-spacing: 32px;--tresta-card-padding: 32px}}@media(min-width:2560px){[data-tresta-widget]{font-size:18px}:root{--tresta-spacing: 40px;--tresta-card-padding: 40px}}.tresta-sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}[data-tresta-widget] button:focus-visible,[data-tresta-widget] a:focus-visible,[data-tresta-widget] [tabindex]:focus-visible,[data-tresta-widget] input:focus-visible,[data-tresta-widget] select:focus-visible,[data-tresta-widget] textarea:focus-visible{outline:3px solid var(--tresta-primary-color);outline-offset:2px;border-radius:2px}[data-tresta-widget] *:focus{outline:none}[data-tresta-widget] *:focus-visible{outline:3px solid var(--tresta-primary-color);outline-offset:2px}[data-tresta-widget] .tresta-skip-link{position:absolute;top:-40px;left:0;background:var(--tresta-primary-color);color:#fff;padding:8px 16px;text-decoration:none;z-index:100;border-radius:4px}[data-tresta-widget] .tresta-skip-link:focus{top:0}@media(prefers-reduced-motion:reduce){[data-tresta-widget] *,[data-tresta-widget] *:before,[data-tresta-widget] *:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}@media(prefers-contrast:high){[data-tresta-widget]{--tresta-border-color: currentColor}[data-tresta-widget] button,[data-tresta-widget] a{border:2px solid currentColor}}[data-tresta-widget] [aria-live]{position:relative}[data-tresta-widget] [aria-busy=true]{opacity:.6;pointer-events:none}\n\n.tresta-testimonial-card{display:flex;flex-direction:column;gap:1rem;padding:1.5rem;background:var(--card-background, #ffffff);border-radius:8px;transition:transform .2s ease,box-shadow .2s ease;font-family:var(--font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif);color:var(--text-color, #333333);line-height:1.6}.tresta-testimonial-card.card-style-default{box-shadow:0 2px 8px #0000001a}.tresta-testimonial-card.card-style-default:hover{box-shadow:0 4px 12px #00000026}.tresta-testimonial-card.card-style-minimal{box-shadow:none;background:transparent;border-bottom:1px solid var(--border-color, #e0e0e0);border-radius:0;padding:1.5rem 0}.tresta-testimonial-card.card-style-bordered{box-shadow:none;border:2px solid var(--border-color, #e0e0e0)}.tresta-testimonial-card.card-style-bordered:hover{border-color:var(--primary-color, #0066cc)}.tresta-card-header{display:flex;align-items:flex-start;gap:1rem}.tresta-avatar-container{flex-shrink:0}.tresta-avatar{width:48px;height:48px;border-radius:50%;object-fit:cover;background:var(--avatar-background, #f0f0f0)}.tresta-author-info{flex:1;min-width:0}.tresta-author-name-row{display:flex;align-items:center;gap:.5rem;margin-bottom:.25rem}.tresta-author-name{font-weight:600;font-size:1rem;color:var(--text-color, #333333)}.tresta-author-role{font-size:.875rem;color:var(--text-secondary, #666666);margin-bottom:.125rem}.tresta-author-company{font-size:.875rem;color:var(--text-secondary, #666666)}.tresta-verification-badge{display:inline-flex;align-items:center;gap:.25rem}.tresta-verification-icon{color:var(--primary-color, #0066cc);flex-shrink:0}.tresta-sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.tresta-rating{display:flex;align-items:center;gap:.25rem}.tresta-star{flex-shrink:0}.tresta-star-full,.tresta-star-half{color:var(--rating-color, #fbbf24)}.tresta-star-empty{color:var(--rating-empty-color, #d1d5db)}.tresta-testimonial-content{font-size:1rem;color:var(--text-color, #333333);white-space:pre-line;word-wrap:break-word}.tresta-testimonial-date{font-size:.875rem;color:var(--text-secondary, #666666);margin-top:auto}@media(prefers-color-scheme:dark){.tresta-testimonial-card{--card-background: #1f2937;--text-color: #f9fafb;--text-secondary: #d1d5db;--border-color: #374151;--avatar-background: #374151}}@media(max-width:640px){.tresta-testimonial-card{padding:1rem}.tresta-avatar{width:40px;height:40px}.tresta-author-name,.tresta-testimonial-content{font-size:.9375rem}}.tresta-testimonial-card:focus-visible{outline:2px solid var(--primary-color, #0066cc);outline-offset:2px}\n\n.tresta-widget-error-state,.tresta-widget-empty-state{display:flex;align-items:center;justify-content:center;padding:2rem;min-height:200px;text-align:center}.tresta-widget-state-message{margin:0;color:var(--tresta-secondary-color, #666);font-size:1rem;line-height:1.5;font-family:var(--tresta-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif)}.tresta-widget-error-state .tresta-widget-state-message{color:var(--tresta-error-color, #d32f2f)}.tresta-widget-empty-state .tresta-widget-state-message{color:var(--tresta-secondary-color, #999);font-style:italic}\n\n.tresta-list{display:flex;flex-direction:column;gap:1rem;width:100%;padding:.5rem 0}.tresta-list-item{width:100%}@media(max-width:768px){.tresta-list{gap:.75rem}}@media(max-width:480px){.tresta-list{gap:.5rem;padding:.25rem 0}}@media(prefers-reduced-motion:reduce){.tresta-list{transition:none}}\n\n.tresta-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;width:100%;padding:.5rem 0}.tresta-grid[style*=--grid-columns]{grid-template-columns:repeat(var(--grid-columns, auto-fit),minmax(280px,1fr))}.tresta-grid-item{display:flex;flex-direction:column;min-height:100%}.tresta-grid-item .tresta-testimonial-card{height:100%;display:flex;flex-direction:column}@media(max-width:480px){.tresta-grid{grid-template-columns:1fr;gap:1rem}}@media(min-width:481px)and (max-width:768px){.tresta-grid{grid-template-columns:repeat(2,1fr);gap:1.25rem}}@media(min-width:769px)and (max-width:1200px){.tresta-grid{grid-template-columns:repeat(3,1fr);gap:1.5rem}}@media(min-width:1201px){.tresta-grid{grid-template-columns:repeat(4,1fr);gap:1.5rem}}@media(min-width:481px){.tresta-grid[style*="--grid-columns: 1"]{grid-template-columns:1fr}.tresta-grid[style*="--grid-columns: 2"]{grid-template-columns:repeat(2,1fr)}.tresta-grid[style*="--grid-columns: 3"]{grid-template-columns:repeat(3,1fr)}.tresta-grid[style*="--grid-columns: 4"]{grid-template-columns:repeat(4,1fr)}}@media(prefers-reduced-motion:reduce){.tresta-grid{transition:none}}@media(min-width:2560px){.tresta-grid{grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:2rem}}\n\n.tresta-masonry{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));grid-auto-rows:10px;grid-auto-flow:dense;gap:1.5rem;width:100%;padding:.5rem 0}.tresta-masonry[style*=--masonry-columns]{grid-template-columns:repeat(var(--masonry-columns),minmax(280px,1fr))}.tresta-masonry-item{display:flex;flex-direction:column}.tresta-masonry-item .tresta-testimonial-card{height:100%;display:flex;flex-direction:column}@media(max-width:480px){.tresta-masonry{grid-template-columns:1fr;gap:1rem}}@media(min-width:481px)and (max-width:768px){.tresta-masonry{grid-template-columns:repeat(2,1fr);gap:1.25rem}}@media(min-width:769px)and (max-width:1200px){.tresta-masonry{grid-template-columns:repeat(3,1fr);gap:1.5rem}}@media(min-width:1201px){.tresta-masonry{grid-template-columns:repeat(4,1fr);gap:1.5rem}}@media(min-width:481px){.tresta-masonry[style*="--masonry-columns: 1"]{grid-template-columns:1fr}.tresta-masonry[style*="--masonry-columns: 2"]{grid-template-columns:repeat(2,1fr)}.tresta-masonry[style*="--masonry-columns: 3"]{grid-template-columns:repeat(3,1fr)}.tresta-masonry[style*="--masonry-columns: 4"]{grid-template-columns:repeat(4,1fr)}}@supports not (grid-auto-rows: 10px){.tresta-masonry{display:flex;flex-wrap:wrap;gap:1.5rem}.tresta-masonry-item{flex:1 1 280px;max-width:calc(25% - 1.5rem)}@media(max-width:1200px){.tresta-masonry-item{max-width:calc(33.333% - 1.5rem)}}@media(max-width:768px){.tresta-masonry-item{max-width:calc(50% - 1.5rem)}}@media(max-width:480px){.tresta-masonry-item{max-width:100%}}}@media(prefers-reduced-motion:reduce){.tresta-masonry{transition:none}}@media(min-width:2560px){.tresta-masonry{grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:2rem}}\n\n.tresta-wall{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));grid-auto-rows:minmax(200px,auto);grid-auto-flow:dense;gap:1rem;width:100%;padding:.5rem 0}.tresta-wall[style*=--wall-columns]{grid-template-columns:repeat(var(--wall-columns),minmax(240px,1fr))}.tresta-wall-item{display:flex;flex-direction:column;min-height:200px}.tresta-wall-item-featured{grid-column:span 2;grid-row:span 2;min-height:400px}.tresta-wall-item .tresta-testimonial-card{height:100%;display:flex;flex-direction:column}.tresta-wall-item-featured .tresta-testimonial-content{font-size:1.125rem;line-height:1.6}.tresta-wall-item-featured .tresta-author-name{font-size:1.125rem}.tresta-wall-item-featured .tresta-rating{transform:scale(1.2);transform-origin:left center}@media(max-width:480px){.tresta-wall{grid-template-columns:1fr;gap:.75rem}.tresta-wall-item-featured{grid-column:span 1;grid-row:span 1;min-height:200px}.tresta-wall-item-featured .tresta-testimonial-content,.tresta-wall-item-featured .tresta-author-name{font-size:1rem}.tresta-wall-item-featured .tresta-rating{transform:scale(1)}}@media(min-width:481px)and (max-width:768px){.tresta-wall{grid-template-columns:repeat(2,1fr);gap:1rem}.tresta-wall-item-featured{grid-column:span 2;grid-row:span 1;min-height:250px}}@media(min-width:769px)and (max-width:1200px){.tresta-wall{grid-template-columns:repeat(3,1fr);gap:1.25rem}}@media(min-width:1201px){.tresta-wall{grid-template-columns:repeat(4,1fr);gap:1.5rem}}@media(min-width:481px){.tresta-wall[style*="--wall-columns: 1"]{grid-template-columns:1fr}.tresta-wall[style*="--wall-columns: 1"] .tresta-wall-item-featured{grid-column:span 1}.tresta-wall[style*="--wall-columns: 2"]{grid-template-columns:repeat(2,1fr)}.tresta-wall[style*="--wall-columns: 3"]{grid-template-columns:repeat(3,1fr)}.tresta-wall[style*="--wall-columns: 4"]{grid-template-columns:repeat(4,1fr)}}@supports not (display: grid){.tresta-wall{display:flex;flex-wrap:wrap;gap:1rem}.tresta-wall-item{flex:1 1 240px;max-width:calc(25% - 1rem)}.tresta-wall-item-featured{flex:1 1 480px;max-width:calc(50% - 1rem)}@media(max-width:1200px){.tresta-wall-item{max-width:calc(33.333% - 1rem)}}@media(max-width:768px){.tresta-wall-item{max-width:calc(50% - 1rem)}.tresta-wall-item-featured{max-width:100%}}@media(max-width:480px){.tresta-wall-item{max-width:100%}}}@media(prefers-reduced-motion:reduce){.tresta-wall{transition:none}.tresta-wall-item-featured .tresta-rating{transform:none}}@media(min-width:2560px){.tresta-wall{grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:2rem}}\n\n.tresta-carousel{position:relative;width:100%;overflow:hidden;padding:1rem 0}.tresta-carousel-track{display:flex;transition:transform .3s ease-in-out;will-change:transform}.tresta-carousel-slide{flex:0 0 100%;min-width:100%;padding:0 1rem;box-sizing:border-box}.tresta-carousel-slide[aria-hidden=true]{visibility:hidden}.tresta-carousel-slide[aria-hidden=false]{visibility:visible}.tresta-carousel-nav{position:absolute;top:50%;left:0;right:0;transform:translateY(-50%);display:flex;justify-content:space-between;pointer-events:none;z-index:10}.tresta-carousel-button{pointer-events:auto;background:#ffffffe6;border:1px solid rgba(0,0,0,.1);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;color:#333;box-shadow:0 2px 8px #0000001a}.tresta-carousel-button:hover{background:#fff;box-shadow:0 4px 12px #00000026;transform:scale(1.05)}.tresta-carousel-button:active{transform:scale(.95)}.tresta-carousel-button:focus{outline:2px solid var(--primary-color, #007bff);outline-offset:2px}.tresta-carousel-button:focus:not(:focus-visible){outline:none}.tresta-carousel-button:focus-visible{outline:2px solid var(--primary-color, #007bff);outline-offset:2px}.tresta-carousel-prev{margin-left:.5rem}.tresta-carousel-next{margin-right:.5rem}.tresta-carousel-indicators{display:flex;justify-content:center;align-items:center;gap:.5rem;margin-top:1.5rem;padding:.5rem}.tresta-carousel-dot{width:10px;height:10px;border-radius:50%;background:#0003;border:none;cursor:pointer;transition:all .2s ease;padding:0}.tresta-carousel-dot:hover{background:#0006;transform:scale(1.2)}.tresta-carousel-dot.active{background:var(--primary-color, #007bff);width:12px;height:12px}.tresta-carousel-dot:focus{outline:2px solid var(--primary-color, #007bff);outline-offset:2px}.tresta-carousel-dot:focus:not(:focus-visible){outline:none}.tresta-carousel-dot:focus-visible{outline:2px solid var(--primary-color, #007bff);outline-offset:2px}.tresta-widget[data-theme=dark] .tresta-carousel-button{background:#000c;border-color:#fff3;color:#fff}.tresta-widget[data-theme=dark] .tresta-carousel-button:hover{background:#000000e6}.tresta-widget[data-theme=dark] .tresta-carousel-dot{background:#ffffff4d}.tresta-widget[data-theme=dark] .tresta-carousel-dot:hover{background:#ffffff80}@media(max-width:768px){.tresta-carousel-button{width:36px;height:36px}.tresta-carousel-prev{margin-left:.25rem}.tresta-carousel-next{margin-right:.25rem}.tresta-carousel-slide{padding:0 .5rem}}@media(max-width:480px){.tresta-carousel-button{width:32px;height:32px}.tresta-carousel-button svg{width:18px;height:18px}.tresta-carousel-dot{width:8px;height:8px}.tresta-carousel-dot.active{width:10px;height:10px}}@media(prefers-reduced-motion:reduce){.tresta-carousel-track,.tresta-carousel-button,.tresta-carousel-dot{transition:none}}@media(hover:none)and (pointer:coarse){.tresta-carousel-button{width:44px;height:44px}.tresta-carousel-dot{width:12px;height:12px;min-width:44px;min-height:44px;display:flex;align-items:center;justify-content:center}.tresta-carousel-dot:before{content:"";width:12px;height:12px;border-radius:50%;background:currentColor}.tresta-carousel-dot.active:before{width:14px;height:14px}}\n'.trim();class l{constructor(t={}){r(this,"shadowRoot",null),r(this,"useShadowDOM"),r(this,"debug"),r(this,"themeManager"),r(this,"nonceApplier"),this.useShadowDOM=t.useShadowDOM??this.detectShadowDOMSupport(),this.debug=t.debug??!1,this.nonceApplier=t.nonceApplier;const e={debug:this.debug};t.theme&&(e.theme=t.theme),this.themeManager=new o(e),this.debug&&console.log(`[TrestaWidget] StyleManager initialized with Shadow DOM: ${this.useShadowDOM}`)}detectShadowDOMSupport(){return"attachShadow"in Element.prototype}initializeStyles(t){return this.useShadowDOM?this.initializeShadowDOM(t):this.initializeNamespacedCSS(t)}initializeShadowDOM(t){this.shadowRoot=t.attachShadow({mode:"open"});const e=document.createElement("style");this.applyNonce(e),e.textContent=this.getShadowDOMStyles(),this.shadowRoot.appendChild(e);const r=document.createElement("div");return r.setAttribute("data-tresta-widget-root","true"),r.setAttribute("data-tresta-widget","true"),this.shadowRoot.appendChild(r),this.themeManager.applyTheme(r),this.debug&&console.log("[TrestaWidget] Shadow DOM initialized"),r}initializeNamespacedCSS(t){if(t.classList.add("tresta-widget"),!document.getElementById("tresta-widget-styles")){const t=document.createElement("style");t.id="tresta-widget-styles",this.applyNonce(t),t.textContent=this.getNamespacedStyles(),document.head.appendChild(t)}const e=document.createElement("div");return e.setAttribute("data-tresta-widget-root","true"),e.setAttribute("data-tresta-widget","true"),e.classList.add("tresta-widget-root"),t.appendChild(e),this.themeManager.applyTheme(e),this.debug&&console.log("[TrestaWidget] Namespaced CSS initialized"),e}getShadowDOMStyles(){return n}getNamespacedStyles(){let t=n.replace(/:root\s*{/g,".tresta-widget {").replace(/\[data-tresta-widget\]/g,".tresta-widget-root");return t=`.tresta-widget { all: initial; }\n${t}`,t}cleanup(){this.shadowRoot=null}getThemeManager(){return this.themeManager}isShadowDOM(){return this.useShadowDOM}getShadowRoot(){return this.shadowRoot}applyNonce(t){this.nonceApplier&&this.nonceApplier(t)}}class d{constructor(){r(this,"requestInterceptors",[]),r(this,"responseInterceptors",[])}addRequestInterceptor(t){this.requestInterceptors.push(t)}addResponseInterceptor(t){this.responseInterceptors.push(t)}async request(t,e={}){let r=t,a=e;for(const i of this.requestInterceptors){const t=await i(r,a);r=t.url,a=t.options}let o=await async function(t,e={}){const{method:r="GET",headers:a={},body:o,timeout:n=1e4}=e,l=new AbortController,d=setTimeout(()=>l.abort(),n);try{const e={method:r,headers:{"Content-Type":"application/json",...a},signal:l.signal,credentials:"omit"};o&&"GET"!==r&&(e.body=JSON.stringify(o));const i=await fetch(t,e);let s;clearTimeout(d);const n=i.headers.get("content-type");return s=n&&n.includes("application/json")?await i.json():await i.text(),{data:s,status:i.status,headers:i.headers}}catch(c){if(clearTimeout(d),c instanceof Error&&"AbortError"===c.name)throw new s(i.API_TIMEOUT,`Request timed out after ${n}ms`,!0);if(c instanceof TypeError)throw new s(i.NETWORK_ERROR,"Network request failed. Please check your connection.",!0);throw c}}(r,a);for(const i of this.responseInterceptors)o=await i(o);return o}}const c={maxRetries:3,baseDelay:1e3,maxDelay:1e4,jitter:1e3};function h(t,e){const r=e.baseDelay*Math.pow(2,t),a=Math.random()*e.jitter;return Math.min(r+a,e.maxDelay)}function u(t){return new Promise(e=>setTimeout(e,t))}function m(t){if(t instanceof s){const e=[i.API_TIMEOUT,i.NETWORK_ERROR,i.API_ERROR];return t.recoverable&&e.includes(t.code)}return!1}const g={maxRequests:100,windowMs:6e4};class p{constructor(t={}){r(this,"config"),r(this,"records",new Map),this.config={...g,...t}}isAllowed(t){const e=Date.now(),r=this.getOrCreateRecord(t);return r.timestamps=r.timestamps.filter(t=>e-t<this.config.windowMs),r.timestamps.length<this.config.maxRequests&&(r.timestamps.push(e),!0)}getRetryAfter(t){const e=Date.now(),r=this.records.get(t);if(!r||0===r.timestamps.length)return 0;if(r.timestamps=r.timestamps.filter(t=>e-t<this.config.windowMs),r.timestamps.length<this.config.maxRequests)return 0;const a=r.timestamps[0];if(!a)return 0;const i=a+this.config.windowMs-e;return Math.max(0,i)}reset(t){this.records.delete(t)}resetAll(){this.records.clear()}getRequestCount(t){const e=Date.now(),r=this.records.get(t);return r?r.timestamps.filter(t=>e-t<this.config.windowMs).length:0}getOrCreateRecord(t){let e=this.records.get(t);return e||(e={timestamps:[]},this.records.set(t,e)),e}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}class f{constructor(t,e="1.0.0",a=!1){r(this,"widgetId"),r(this,"version"),r(this,"debugEnabled"),this.widgetId=t,this.version=e,this.debugEnabled=a}debug(t,...e){this.debugEnabled}info(t,...e){console.log(`[TrestaWidget v${this.version}]`,t,...e)}warn(t,...e){console.warn(`[TrestaWidget v${this.version}]`,t,...e)}error(t,...e){console.error(`[TrestaWidget v${this.version}]`,t,...e)}logEmpty(){this.debugEnabled}isDebugEnabled(){return this.debugEnabled}getWidgetId(){return this.widgetId}getVersion(){return this.version}}const w={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},y=(()=>{if(void 0!=={url:a&&"SCRIPT"===a.tagName.toUpperCase()&&a.src||new URL("tresta-widget.js",document.baseURI).href}&&w)return w;const t="undefined"!=typeof globalThis?globalThis.process:void 0;return t?.env?t.env:{}})(),b=(...t)=>{for(const e of t){const t=y[e];if("string"==typeof t&&t.trim().length>0)return t}},v=t=>{if(t)return t.replace(/\/+$/,"")},x=t=>{if(t)try{return new URL(t).hostname}catch{return t.replace(/^https?:\/\//,"").replace(/\/.+$/,"").trim()}},R=v(b("VITE_WIDGET_CDN_BASE_URL","NEXT_PUBLIC_WIDGET_CDN_BASE_URL"))??"https://cdn.tresta.app",T=v(b("VITE_WIDGET_API_BASE_URL","NEXT_PUBLIC_WIDGET_API_BASE_URL"))??"https://api.tresta.app",E=v(b("VITE_WIDGET_TELEMETRY_ENDPOINT","NEXT_PUBLIC_WIDGET_TELEMETRY_ENDPOINT"))??`${T}/telemetry`,A=v(b("VITE_WIDGET_BRANDING_URL","NEXT_PUBLIC_WIDGET_BRANDING_URL"))??"https://tresta.app",S=(I=b("VITE_WIDGET_ALLOWED_DOMAINS","NEXT_PUBLIC_WIDGET_ALLOWED_DOMAINS"))?I.split(",").map(t=>t.trim()).filter(Boolean):[];var I;const C=Array.from(new Set([x(R),x(T),...S].filter(Boolean))),k={baseURL:T,timeout:1e4,maxRetries:3};class D{constructor(t={},e,a){r(this,"config"),r(this,"networkClient"),r(this,"rateLimiter"),r(this,"apiKey"),r(this,"logger",null),this.config={...k,...t},this.networkClient=new d,this.rateLimiter=new p({maxRequests:100,windowMs:6e4}),this.apiKey=e,this.logger=a||null}async fetchWidgetData(t){if(!this.apiKey)throw new s(i.UNAUTHORIZED,"API key is required. Please provide an API key.",!1);if(!this.rateLimiter.isAllowed(t)){const e=this.rateLimiter.getRetryAfter(t),r=`Rate limit exceeded for widget ${t}. Retry after ${Math.ceil(e/1e3)}s`;throw this.logger?this.logger.warn(r):console.warn(`[TrestaWidget] ${r}`),new s(i.RATE_LIMITED,`Rate limit exceeded. Please try again in ${Math.ceil(e/1e3)} seconds.`,!0)}return async function(t,e={}){const r={...c,...e};let a;for(let o=0;o<r.maxRetries;o++)try{return await t()}catch(i){if(a=i,!m(i))throw i;if(o===r.maxRetries-1)throw i;const t=h(o,r);i instanceof s&&console.warn(`[TrestaWidget] Request failed (attempt ${o+1}/${r.maxRetries}): ${i.message}. Retrying in ${Math.round(t)}ms...`),await u(t)}throw a}(async()=>{const e=`${this.config.baseURL}/api/widgets/${t}/public`;this.logger&&(this.logger.debug(`Fetching widget data from: ${e}`),this.logger.debug(`Using API key: ${this.apiKey?.substring(0,15)}...`));try{const r=await this.networkClient.request(e,{method:"GET",timeout:this.config.timeout,headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"}});this.logger&&this.logger.debug("Received response:",r.status);const a=this.handleResponse(r,t);return this.transformApiResponse(a)}catch(r){if(r instanceof s)throw r;const e=`Unexpected error for widget ${t}:`;throw this.logger?this.logger.error(e,r):console.error(`[TrestaWidget] ${e}`,r),new s(i.API_ERROR,"An unexpected error occurred while fetching widget data",!0)}},{maxRetries:this.config.maxRetries})}transformApiResponse(t){this.logger&&this.logger.debug("Raw API response:",t);const e=t.data||t;if(!e||!e.widget){const t={hasData:!!e,hasWidget:!!e?.widget};throw this.logger?this.logger.error("Invalid API response structure:",t):console.error("[TrestaWidget] Invalid API response structure:",t),new s(i.PARSE_ERROR,"Invalid API response format",!1)}this.logger&&this.logger.debug("Transforming widget data:",{widgetId:e.widget.id,testimonialCount:e.testimonials?.length||0});const r=e.widget.settings??{},a=e.widget.layout||"grid",o=r.maxTestimonials??10,n="carousel"===a&&(r.autoRotate??!1),l=r.rotateInterval??5e3,d="carousel"===a&&(r.showNavigation??!0),c=r.columns??("grid"===a?3:1);return{widgetId:e.widget.id,config:{layout:{type:a,maxTestimonials:o,autoRotate:n,rotateInterval:l,showNavigation:d,columns:c},theme:{mode:r.theme||"light",primaryColor:e.widget.theme?.primaryColor||"#0066FF",secondaryColor:e.widget.theme?.secondaryColor||"#00CC99",fontFamily:r.fontFamily,cardStyle:r.cardStyle||"default"},display:{showRating:r.showRating??!0,showDate:r.showDate??!0,showAvatar:r.showAvatar??!0,showAuthorRole:r.showAuthorRole??!0,showAuthorCompany:r.showAuthorCompany??!0,maxTestimonials:o}},testimonials:(e.testimonials||[]).map(t=>({id:t.id,content:t.content,rating:t.rating,createdAt:t.createdAt,isPublished:!0,isApproved:!0,isOAuthVerified:t.isOAuthVerified||!1,oauthProvider:t.oauthProvider,author:{name:t.authorName,email:void 0,avatar:t.authorAvatar,role:t.authorRole,company:t.authorCompany},media:t.videoUrl?{type:"video",url:t.videoUrl}:void 0}))}}handleResponse(t,e){const{data:r,status:a,headers:o}=t;if(a>=200&&a<300)return r;switch(a){case 401:case 403:{const t=`Unauthorized access for widget ${e} (${a})`;throw this.logger?this.logger.error(t):console.error(`[TrestaWidget] ${t}`),new s(i.UNAUTHORIZED,"Unable to load testimonials. Please check your widget configuration.",!1)}case 404:{const t=`Widget ${e} not found (404)`;throw this.logger?this.logger.error(t):console.error(`[TrestaWidget] ${t}`),new s(i.INVALID_WIDGET_ID,"Widget not found. Please check your widget ID.",!1)}case 429:{const t=o.get("Retry-After"),r=t?1e3*parseInt(t,10):6e4,a=`Server rate limit for widget ${e}. Retry after ${r/1e3}s`;throw this.logger?this.logger.warn(a):console.warn(`[TrestaWidget] ${a}`),new s(i.RATE_LIMITED,`Rate limit exceeded. Please try again in ${Math.ceil(r/1e3)} seconds.`,!0)}case 500:case 502:case 503:case 504:{const t=`Server error for widget ${e} (${a})`;throw this.logger?this.logger.error(t):console.error(`[TrestaWidget] ${t}`),new s(i.API_ERROR,"Server error. Please try again later.",!0)}default:{const t=`Unexpected status code ${a} for widget ${e}`;throw this.logger?this.logger.error(t):console.error(`[TrestaWidget] ${t}`),new s(i.API_ERROR,`Unexpected error (${a}). Please try again later.`,a>=500)}}}getNetworkClient(){return this.networkClient}getRateLimiter(){return this.rateLimiter}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}const O="testimonials";class N{constructor(){r(this,"dbPromise",null),r(this,"available",null)}async isAvailable(){if(null!==this.available)return this.available;try{return"indexedDB"in window?((await new Promise((t,e)=>{const r=indexedDB.open("__test__",1);r.onerror=()=>e(r.error),r.onsuccess=()=>t(r.result),r.onupgradeneeded=()=>{r.result.createObjectStore("test")}})).close(),indexedDB.deleteDatabase("__test__"),this.available=!0,!0):(this.available=!1,!1)}catch(t){return console.warn("[TrestaWidget] IndexedDB unavailable, will use localStorage fallback:",t),this.available=!1,!1}}async getDB(){return this.dbPromise||(this.dbPromise=new Promise((t,e)=>{const r=indexedDB.open("tresta-widget-cache",1);r.onerror=()=>{e(new Error(`Failed to open IndexedDB: ${r.error}`))},r.onsuccess=()=>{t(r.result)},r.onupgradeneeded=t=>{const e=t.target.result;e.objectStoreNames.contains(O)||e.createObjectStore(O,{keyPath:"widgetId"}).createIndex("expiresAt","expiresAt",{unique:!1})}})),this.dbPromise}async get(t){try{const e=await this.getDB();return new Promise((r,a)=>{const i=e.transaction([O],"readonly").objectStore(O).get(t);i.onerror=()=>a(i.error),i.onsuccess=()=>{const e=i.result;e&&e.expiresAt<Date.now()?(this.delete(t).catch(()=>{}),r(null)):r(e||null)}})}catch(e){return console.error("[TrestaWidget] IndexedDB get error:",e),null}}async set(t,e){try{const t=await this.getDB();return new Promise((r,a)=>{const i=t.transaction([O],"readwrite").objectStore(O).put(e);i.onerror=()=>a(i.error),i.onsuccess=()=>r()})}catch(r){throw console.error("[TrestaWidget] IndexedDB set error:",r),r}}async delete(t){try{const e=await this.getDB();return new Promise((r,a)=>{const i=e.transaction([O],"readwrite").objectStore(O).delete(t);i.onerror=()=>a(i.error),i.onsuccess=()=>r()})}catch(e){throw console.error("[TrestaWidget] IndexedDB delete error:",e),e}}async clear(){try{const t=await this.getDB();return new Promise((e,r)=>{const a=t.transaction([O],"readwrite").objectStore(O).clear();a.onerror=()=>r(a.error),a.onsuccess=()=>e()})}catch(t){throw console.error("[TrestaWidget] IndexedDB clear error:",t),t}}async clearExpired(){try{const t=await this.getDB(),e=Date.now();return new Promise((r,a)=>{const i=t.transaction([O],"readwrite").objectStore(O).index("expiresAt"),s=IDBKeyRange.upperBound(e),o=i.openCursor(s);o.onerror=()=>a(o.error),o.onsuccess=t=>{const e=t.target.result;e?(e.delete(),e.continue()):r()}})}catch(t){console.error("[TrestaWidget] IndexedDB clearExpired error:",t)}}}const L="tresta-widget-";class M{constructor(){r(this,"available",null)}async isAvailable(){if(null!==this.available)return this.available;try{const t="__tresta_test__";return localStorage.setItem(t,"test"),localStorage.removeItem(t),this.available=!0,!0}catch(t){return console.warn("[TrestaWidget] localStorage unavailable:",t),this.available=!1,!1}}async get(t){try{const e=L+t,r=localStorage.getItem(e);if(!r)return null;const a=JSON.parse(r);return a.expiresAt<Date.now()?(await this.delete(t),null):a}catch(e){return console.error("[TrestaWidget] localStorage get error:",e),null}}async set(t,e){try{const r=L+t,a=JSON.stringify(e);localStorage.setItem(r,a)}catch(r){if(!(r instanceof DOMException)||"QuotaExceededError"!==r.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==r.name)throw console.error("[TrestaWidget] localStorage set error:",r),r;console.warn("[TrestaWidget] localStorage quota exceeded, clearing old entries"),await this.clearExpired();try{const r=L+t,a=JSON.stringify(e);localStorage.setItem(r,a)}catch(a){throw console.error("[TrestaWidget] localStorage set error after cleanup:",a),a}}}async delete(t){try{const e=L+t;localStorage.removeItem(e)}catch(e){throw console.error("[TrestaWidget] localStorage delete error:",e),e}}async clear(){try{const t=[];for(let e=0;e<localStorage.length;e++){const r=localStorage.key(e);r&&r.startsWith(L)&&t.push(r)}t.forEach(t=>localStorage.removeItem(t))}catch(t){throw console.error("[TrestaWidget] localStorage clear error:",t),t}}async clearExpired(){try{const e=Date.now(),r=[];for(let a=0;a<localStorage.length;a++){const i=localStorage.key(a);if(i&&i.startsWith(L))try{const t=localStorage.getItem(i);t&&JSON.parse(t).expiresAt<e&&r.push(i)}catch(t){r.push(i)}}r.forEach(t=>localStorage.removeItem(t))}catch(e){console.error("[TrestaWidget] localStorage clearExpired error:",e)}}}const P=864e5;class W{constructor(){r(this,"adapter",null),r(this,"initPromise",null)}async init(){return this.initPromise||(this.initPromise=(async()=>{const t=new N;if(await t.isAvailable())return this.adapter=t,console.log("[TrestaWidget] Using IndexedDB for caching"),void this.clearExpired().catch(()=>{});const e=new M;if(await e.isAvailable())return this.adapter=e,console.log("[TrestaWidget] Using localStorage for caching (IndexedDB unavailable)"),void this.clearExpired().catch(()=>{});console.warn("[TrestaWidget] No storage available, caching disabled"),this.adapter=null})()),this.initPromise}async getAdapter(){return await this.init(),this.adapter}getCacheKey(t){return`tresta-widget-${t}`}getTTL(){return this.adapter instanceof N?P:this.adapter instanceof M?36e5:P}async get(t){try{const e=await this.getAdapter();if(!e)return null;const r=this.getCacheKey(t),a=await e.get(r);return a?a.data:null}catch(e){return console.error("[TrestaWidget] Cache get error:",e),null}}async set(t,e,r){try{const a=await this.getAdapter();if(!a)return;const i=this.getCacheKey(t),s=Date.now(),o={widgetId:t,data:e,timestamp:s,expiresAt:s+(r??this.getTTL())};await a.set(i,o)}catch(a){console.error("[TrestaWidget] Cache set error:",a)}}async delete(t){try{const e=await this.getAdapter();if(!e)return;const r=this.getCacheKey(t);await e.delete(r)}catch(e){console.error("[TrestaWidget] Cache delete error:",e)}}async clear(){try{const t=await this.getAdapter();if(!t)return;await t.clear()}catch(t){console.error("[TrestaWidget] Cache clear error:",t)}}async clearExpired(){try{const t=await this.getAdapter();if(!t)return;"clearExpired"in t&&"function"==typeof t.clearExpired&&await t.clearExpired()}catch(t){console.error("[TrestaWidget] Cache clearExpired error:",t)}}}function $(t){const e=document.createElement("div");e.className=`tresta-widget-${t.type}-state`,"error"===t.type?(e.setAttribute("role","alert"),e.setAttribute("aria-live","assertive")):(e.setAttribute("role","status"),e.setAttribute("aria-live","polite")),e.setAttribute("aria-atomic","true");const r=document.createElement("p");return r.className="tresta-widget-state-message",t.message?r.textContent=t.message:"error"===t.type?r.textContent="Unable to load testimonials. Please try again later.":r.textContent="No testimonials yet",e.appendChild(r),e}class _{constructor(t=.01){r(this,"samplingRate"),this.samplingRate=Math.max(0,Math.min(1,t))}shouldSample(){return Math.random()<this.samplingRate}setSamplingRate(t){this.samplingRate=Math.max(0,Math.min(1,t))}getSamplingRate(){return this.samplingRate}}class U{constructor(t,e,a={}){r(this,"config"),r(this,"sampler"),r(this,"errorCounts",new Map),r(this,"loadStartTime",0),r(this,"widgetId"),r(this,"version"),r(this,"layoutType"),this.widgetId=t,this.version=e;const i=!1===a.enabled,s=this.isDNTEnabled();this.config={enabled:!i&&!s,samplingRate:a.samplingRate??.01,endpoint:a.endpoint??E},this.sampler=new _(this.config.samplingRate)}isDNTEnabled(){if("undefined"!=typeof navigator){const t=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;if("1"===t||"yes"===t||!0===t)return!0}return!1}startLoadTracking(){this.config.enabled&&(this.loadStartTime=performance.now())}trackLoad(t){if(!this.config.enabled)return;if(!this.sampler.shouldSample())return;this.layoutType=t||"unknown";const e=this.loadStartTime>0?performance.now()-this.loadStartTime:0,r={widgetId:this.widgetId,version:this.version,eventType:"load",loadTime:Math.round(e),layoutType:t||"unknown",timestamp:Date.now()};this.send(r)}trackError(t){if(!this.config.enabled)return;const e=this.errorCounts.get(t)||0;if(this.errorCounts.set(t,e+1),!this.sampler.shouldSample())return;const r={widgetId:this.widgetId,version:this.version,eventType:"error",errorCode:t,timestamp:Date.now()};this.send(r)}trackInteraction(t){if(!this.config.enabled)return;if(!this.sampler.shouldSample())return;const e={widgetId:this.widgetId,version:this.version,eventType:"interaction",layoutType:t||this.layoutType||"unknown",timestamp:Date.now()};this.send(e)}getTelemetryData(){const t=this.loadStartTime>0?performance.now()-this.loadStartTime:0,e={};return this.errorCounts.forEach((t,r)=>{e[r]=t}),{widgetId:this.widgetId,version:this.version,loadTime:Math.round(t),layoutType:this.layoutType||"unknown",errorCounts:e}}send(t){if(this.config.enabled&&this.config.endpoint)if("undefined"!=typeof navigator&&navigator.sendBeacon)try{const e=new Blob([JSON.stringify(t)],{type:"application/json"});navigator.sendBeacon(this.config.endpoint,e)}catch(e){}else try{fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),keepalive:!0,credentials:"omit"}).catch(()=>{})}catch(e){}}isEnabled(){return this.config.enabled}setSamplingRate(t){this.config.samplingRate=t,this.sampler.setSamplingRate(t)}disable(){this.config.enabled=!1}enable(){this.isDNTEnabled()||(this.config.enabled=!0)}}class B{constructor(t){r(this,"testimonial"),r(this,"displayOptions"),r(this,"theme"),this.testimonial=t.testimonial,this.displayOptions=t.displayOptions,this.theme=t.theme}render(){const t=document.createElement("article");t.className="tresta-testimonial-card",t.setAttribute("data-testimonial-id",this.testimonial.id),t.style.setProperty("--primary-color",this.theme.primaryColor),t.style.setProperty("--secondary-color",this.theme.secondaryColor),t.classList.add(`card-style-${this.theme.cardStyle}`);const e=[];return e.push(this.renderHeader()),this.displayOptions.showRating&&this.testimonial.rating>0&&e.push(this.renderRating()),e.push(this.renderContent()),this.displayOptions.showDate&&e.push(this.renderDate()),t.innerHTML=e.join(""),t}renderHeader(){const t=['<div class="tresta-card-header">'];return this.displayOptions.showAvatar&&this.testimonial.author.avatar&&t.push(this.renderAvatar()),t.push('<div class="tresta-author-info">'),t.push('<div class="tresta-author-name-row">'),t.push(`<span class="tresta-author-name">${this.escapeHtml(this.testimonial.author.name)}</span>`),this.testimonial.isOAuthVerified&&this.testimonial.oauthProvider&&t.push(this.renderVerificationBadge()),t.push("</div>"),this.displayOptions.showAuthorRole&&this.testimonial.author.role&&t.push(`<div class="tresta-author-role">${this.escapeHtml(this.testimonial.author.role)}</div>`),this.displayOptions.showAuthorCompany&&this.testimonial.author.company&&t.push(`<div class="tresta-author-company">${this.escapeHtml(this.testimonial.author.company)}</div>`),t.push("</div>"),t.push("</div>"),t.join("")}renderAvatar(){const t=this.testimonial.author.avatar,e=this.escapeHtml(this.testimonial.author.name);return`\n      <div class="tresta-avatar-container">\n        <img \n          class="tresta-avatar" \n          src="${this.escapeHtml(t)}" \n          alt="${e}"\n          loading="lazy"\n        />\n      </div>\n    `}renderVerificationBadge(){const t=this.escapeHtml(this.testimonial.oauthProvider);return`\n      <span \n        class="tresta-verification-badge" \n        role="img" \n        aria-label="Verified via ${t}"\n        title="Verified via ${t}"\n      >\n        <svg \n          class="tresta-verification-icon" \n          width="16" \n          height="16" \n          viewBox="0 0 16 16" \n          fill="none" \n          xmlns="http://www.w3.org/2000/svg"\n          aria-hidden="true"\n          focusable="false"\n        >\n          <circle cx="8" cy="8" r="8" fill="currentColor"/>\n          <path \n            d="M11.5 5.5L6.5 10.5L4 8" \n            stroke="white" \n            stroke-width="2" \n            stroke-linecap="round" \n            stroke-linejoin="round"\n          />\n        </svg>\n      </span>\n    `}renderRating(){const t=Math.max(0,Math.min(5,this.testimonial.rating)),e=Math.floor(t),r=t%1>=.5,a=5-e-(r?1:0),i=[];for(let s=0;s<e;s++)i.push(this.renderStar("full"));r&&i.push(this.renderStar("half"));for(let s=0;s<a;s++)i.push(this.renderStar("empty"));return`\n      <div class="tresta-rating" role="img" aria-label="${t} out of 5 stars">\n        ${i.join("")}\n      </div>\n    `}renderStar(t){const e=`tresta-star-${t}`;return"half"===t?`\n        <svg class="tresta-star ${e}" width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">\n          <defs>\n            <linearGradient id="half-fill-${this.testimonial.id}">\n              <stop offset="50%" stop-color="currentColor"/>\n              <stop offset="50%" stop-color="transparent"/>\n            </linearGradient>\n          </defs>\n          <path \n            d="M10 1L12.5 7.5L19 8.5L14.5 13L15.5 19L10 16L4.5 19L5.5 13L1 8.5L7.5 7.5L10 1Z" \n            fill="url(#half-fill-${this.testimonial.id})"\n            stroke="currentColor"\n            stroke-width="1"\n          />\n        </svg>\n      `:`\n      <svg class="tresta-star ${e}" width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">\n        <path \n          d="M10 1L12.5 7.5L19 8.5L14.5 13L15.5 19L10 16L4.5 19L5.5 13L1 8.5L7.5 7.5L10 1Z" \n          fill="${"full"===t?"currentColor":"transparent"}"\n          stroke="currentColor"\n          stroke-width="1"\n        />\n      </svg>\n    `}renderContent(){return`\n      <div class="tresta-testimonial-content">\n        ${this.escapeHtml(this.testimonial.content)}\n      </div>\n    `}renderDate(){const t=this.formatDate(this.testimonial.createdAt);return`\n      <div class="tresta-testimonial-date">\n        <time datetime="${this.testimonial.createdAt}">${t}</time>\n      </div>\n    `}formatDate(t){try{const e=new Date(t);if(isNaN(e.getTime()))return t;const r={year:"numeric",month:"long",day:"numeric"};return e.toLocaleDateString("en-US",r)}catch(e){return t}}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}class z{constructor(t){r(this,"testimonials"),r(this,"layoutConfig"),r(this,"displayOptions"),r(this,"theme"),r(this,"container",null),r(this,"currentIndex",0),r(this,"autoRotateTimer",null),r(this,"isPaused",!1),r(this,"touchStartX",0),r(this,"touchEndX",0),r(this,"isTransitioning",!1),this.testimonials=t.testimonials,this.layoutConfig=t.layoutConfig,this.displayOptions=t.displayOptions,this.theme=t.theme}render(){const t=document.createElement("div");if(t.className="tresta-carousel",t.setAttribute("role","region"),t.setAttribute("aria-label","Customer testimonials"),t.setAttribute("aria-roledescription","carousel"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","false"),0===this.testimonials.length){const e=document.createElement("div");return e.className="tresta-empty-state",e.textContent="No testimonials to display yet.",t.appendChild(e),t}const e=document.createElement("div");e.className="tresta-carousel-track",this.testimonials.forEach((t,r)=>{const a=this.renderSlide(t,r);e.appendChild(a)}),t.appendChild(e);const r=document.createElement("div");return r.className="tresta-sr-only",r.textContent="Use arrow keys to navigate between testimonials, or tab to navigation buttons",t.appendChild(r),!1!==this.layoutConfig.showNavigation&&t.appendChild(this.renderNavigationButtons()),t.appendChild(this.renderDotIndicators()),this.container=t,this.setupEventListeners(),!1!==this.layoutConfig.autoRotate&&this.startAutoRotate(),this.updateSlidePosition(!1),t}renderSlide(t,e){const r=document.createElement("div");r.className="tresta-carousel-slide",r.id=`testimonial-slide-${e}`,r.setAttribute("role","tabpanel"),r.setAttribute("aria-roledescription","slide"),r.setAttribute("aria-label",`Testimonial ${e+1} of ${this.testimonials.length}`);const a=new B({testimonial:t,displayOptions:this.displayOptions,theme:this.theme});return r.appendChild(a.render()),r}renderNavigationButtons(){const t=document.createElement("div");t.className="tresta-carousel-nav";const e=document.createElement("button");e.className="tresta-carousel-button tresta-carousel-prev",e.setAttribute("aria-label","Previous testimonial"),e.setAttribute("type","button"),e.innerHTML='\n      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">\n        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>\n    ',e.addEventListener("click",()=>this.previous());const r=document.createElement("button");return r.className="tresta-carousel-button tresta-carousel-next",r.setAttribute("aria-label","Next testimonial"),r.setAttribute("type","button"),r.innerHTML='\n      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">\n        <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>\n    ',r.addEventListener("click",()=>this.next()),t.appendChild(e),t.appendChild(r),t}renderDotIndicators(){const t=document.createElement("div");return t.className="tresta-carousel-indicators",t.setAttribute("role","tablist"),t.setAttribute("aria-label","Testimonial navigation"),this.testimonials.forEach((e,r)=>{const a=document.createElement("button");a.className="tresta-carousel-dot",a.setAttribute("type","button"),a.setAttribute("role","tab"),a.setAttribute("aria-label",`Go to testimonial ${r+1}`),a.setAttribute("aria-selected",0===r?"true":"false"),a.setAttribute("tabindex",0===r?"0":"-1"),a.setAttribute("aria-controls",`testimonial-slide-${r}`),0===r&&a.classList.add("active"),a.addEventListener("click",()=>this.goToSlide(r)),t.appendChild(a)}),t}setupEventListeners(){this.container&&(this.container.addEventListener("touchstart",t=>this.handleTouchStart(t),{passive:!0}),this.container.addEventListener("touchend",t=>this.handleTouchEnd(t),{passive:!0}),this.container.addEventListener("mouseenter",()=>this.pause()),this.container.addEventListener("mouseleave",()=>this.resume()),this.container.addEventListener("keydown",t=>this.handleKeyDown(t)),this.container.addEventListener("focusin",()=>this.pause()),this.container.addEventListener("focusout",()=>this.resume()))}handleTouchStart(t){const e=t.touches[0];e&&(this.touchStartX=e.clientX,this.pause())}handleTouchEnd(t){const e=t.changedTouches[0];e&&(this.touchEndX=e.clientX,this.handleSwipe(),this.resume())}handleSwipe(){const t=this.touchStartX-this.touchEndX;Math.abs(t)<50||(t>0?this.next():this.previous())}handleKeyDown(t){switch(t.key){case"ArrowLeft":t.preventDefault(),this.previous();break;case"ArrowRight":t.preventDefault(),this.next();break;case"Home":t.preventDefault(),this.goToSlide(0);break;case"End":t.preventDefault(),this.goToSlide(this.testimonials.length-1);break;case"Escape":t.preventDefault(),this.pause()}}previous(){this.isTransitioning||(this.currentIndex=(this.currentIndex-1+this.testimonials.length)%this.testimonials.length,this.updateSlidePosition())}next(){this.isTransitioning||(this.currentIndex=(this.currentIndex+1)%this.testimonials.length,this.updateSlidePosition())}goToSlide(t){this.isTransitioning||t===this.currentIndex||t<0||t>=this.testimonials.length||(this.currentIndex=t,this.updateSlidePosition())}updateSlidePosition(t=!0){if(!this.container)return;const e=this.container.querySelector(".tresta-carousel-track"),r=this.container.querySelectorAll(".tresta-carousel-slide"),a=this.container.querySelectorAll(".tresta-carousel-dot");if(!e||0===r.length)return;const i=100*-this.currentIndex;e.style.transform=`translateX(${i}%)`,e.style.transition=t?"transform 0.3s ease-in-out":"none",r.forEach((t,e)=>{const r=e===this.currentIndex;t.setAttribute("aria-hidden",r?"false":"true"),r?t.classList.add("active"):t.classList.remove("active")}),a.forEach((t,e)=>{const r=e===this.currentIndex;t.setAttribute("aria-selected",r?"true":"false"),t.setAttribute("tabindex",r?"0":"-1"),r?t.classList.add("active"):t.classList.remove("active")}),t&&(this.isTransitioning=!0,setTimeout(()=>{this.isTransitioning=!1},300))}startAutoRotate(){if(!1===this.layoutConfig.autoRotate)return;const t=this.layoutConfig.rotateInterval||5e3;this.autoRotateTimer=window.setInterval(()=>{this.isPaused||this.next()},t)}stopAutoRotate(){null!==this.autoRotateTimer&&(clearInterval(this.autoRotateTimer),this.autoRotateTimer=null)}pause(){this.isPaused||(this.isPaused=!0,this.container&&this.container.setAttribute("aria-live","off"))}resume(){this.isPaused&&(this.isPaused=!1,this.container&&this.container.setAttribute("aria-live","polite"))}destroy(){if(this.stopAutoRotate(),this.container){const t=this.container.cloneNode(!0);this.container.parentNode?.replaceChild(t,this.container),this.container=null}}}class q{constructor(t){r(this,"testimonials"),r(this,"layoutConfig"),r(this,"displayOptions"),r(this,"theme"),this.testimonials=t.testimonials,this.layoutConfig=t.layoutConfig,this.displayOptions=t.displayOptions,this.theme=t.theme}render(){const t=document.createElement("div");if(t.className="tresta-grid",t.setAttribute("role","list"),t.setAttribute("aria-label","Customer testimonials"),0===this.testimonials.length){const e=document.createElement("div");return e.className="tresta-empty-state",e.textContent="No testimonials to display yet.",t.appendChild(e),t}return this.layoutConfig.columns&&t.style.setProperty("--grid-columns",this.layoutConfig.columns.toString()),this.testimonials.forEach(e=>{const r=this.renderItem(e);t.appendChild(r)}),t}renderItem(t){const e=document.createElement("div");e.className="tresta-grid-item",e.setAttribute("role","listitem");const r=new B({testimonial:t,displayOptions:this.displayOptions,theme:this.theme});return e.appendChild(r.render()),e}destroy(){}}const j=class t{constructor(t){r(this,"testimonials"),r(this,"layoutConfig"),r(this,"displayOptions"),r(this,"theme"),r(this,"container",null),r(this,"resizeObserver",null),this.testimonials=t.testimonials,this.layoutConfig=t.layoutConfig,this.displayOptions=t.displayOptions,this.theme=t.theme}render(){const t=document.createElement("div");if(t.className="tresta-masonry",t.setAttribute("role","list"),t.setAttribute("aria-label","Customer testimonials"),0===this.testimonials.length){const e=document.createElement("div");return e.className="tresta-empty-state",e.textContent="No testimonials to display yet.",t.appendChild(e),t}return this.layoutConfig.columns&&t.style.setProperty("--masonry-columns",this.layoutConfig.columns.toString()),this.testimonials.forEach(e=>{const r=this.renderItem(e);t.appendChild(r),this.queueSpanCalculation(r)}),this.container=t,this.setupResizeObserver(),t}renderItem(t){const e=document.createElement("div");e.className="tresta-masonry-item",e.setAttribute("role","listitem");const r=new B({testimonial:t,displayOptions:this.displayOptions,theme:this.theme});return e.appendChild(r.render()),e}setupResizeObserver(){this.container&&"undefined"!=typeof ResizeObserver&&(this.resizeObserver=new ResizeObserver(t=>{t.forEach(t=>{const e=t.target;this.applyRowSpan(e,t.contentRect.height)})}),this.container.querySelectorAll(".tresta-masonry-item").forEach(t=>{this.resizeObserver.observe(t)}))}applyRowSpan(e,r){const a=r??e.getBoundingClientRect().height;if(!a||Number.isNaN(a))return;const i=Math.max(1,Math.ceil(a/t.GRID_ROW_UNIT));e.style.gridRowEnd=`span ${i}`}queueSpanCalculation(t){"undefined"==typeof requestAnimationFrame?setTimeout(()=>this.applyRowSpan(t),0):requestAnimationFrame(()=>this.applyRowSpan(t))}destroy(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.container=null}};r(j,"GRID_ROW_UNIT",10);let F=j;class V{constructor(t){r(this,"testimonials"),r(this,"layoutConfig"),r(this,"displayOptions"),r(this,"theme"),this.testimonials=t.testimonials,this.layoutConfig=t.layoutConfig,this.displayOptions=t.displayOptions,this.theme=t.theme}render(){const t=document.createElement("div");if(t.className="tresta-wall",t.setAttribute("role","list"),t.setAttribute("aria-label","Customer testimonials"),0===this.testimonials.length){const e=document.createElement("div");return e.className="tresta-empty-state",e.textContent="No testimonials to display yet.",t.appendChild(e),t}return this.layoutConfig.columns&&t.style.setProperty("--wall-columns",this.layoutConfig.columns.toString()),this.testimonials.forEach((e,r)=>{const a=this.renderItem(e,r);t.appendChild(a)}),t}renderItem(t,e){const r=document.createElement("div");r.className="tresta-wall-item",r.setAttribute("role","listitem"),this.shouldBeFeatured(t,e)&&r.classList.add("tresta-wall-item-featured");const a=new B({testimonial:t,displayOptions:this.displayOptions,theme:this.theme});return r.appendChild(a.render()),r}shouldBeFeatured(t,e){const r=e%5==0,a=5===t.rating,i=t.isOAuthVerified;return r||a&&i}destroy(){}}class H{constructor(t){r(this,"testimonials"),r(this,"displayOptions"),r(this,"theme"),this.testimonials=t.testimonials,this.displayOptions=t.displayOptions,this.theme=t.theme}render(){const t=document.createElement("div");if(t.className="tresta-list",t.setAttribute("role","list"),t.setAttribute("aria-label","Customer testimonials"),0===this.testimonials.length){const e=document.createElement("div");return e.className="tresta-empty-state",e.textContent="No testimonials to display yet.",t.appendChild(e),t}return this.testimonials.forEach(e=>{const r=this.renderItem(e);t.appendChild(r)}),t}renderItem(t){const e=document.createElement("div");e.className="tresta-list-item",e.setAttribute("role","listitem");const r=new B({testimonial:t,displayOptions:this.displayOptions,theme:this.theme});return e.appendChild(r.render()),e}destroy(){}}class G{static create(t){const{layoutConfig:e}=t;switch(e.type){case"carousel":return new z(t);case"grid":return new q(t);case"masonry":return new F(t);case"wall":return new V(t);case"list":return new H(t);default:return console.warn(`[TrestaWidget] Unknown layout type: ${e.type}. Falling back to list layout.`),new H(t)}}}function K(t){return[...t].sort((t,e)=>{const r=new Date(t.createdAt).getTime();return new Date(e.createdAt).getTime()-r})}const X=[...C];class J{constructor(t={}){r(this,"config"),r(this,"violations",[]),this.config={allowedDomains:X,reportViolations:!0,...t},this.config.reportViolations&&"undefined"!=typeof document&&this.setupViolationListener()}validateURL(t){if(!t)return!1;if(t.startsWith("/")||t.startsWith("./")||t.startsWith("../"))return!0;if(t.startsWith("data:"))return!0;try{const e=new URL(t).hostname;return this.config.allowedDomains.some(t=>e===t||e.endsWith(`.${t}`))}catch{return!1}}validateResources(t){const e=[];return t.querySelectorAll("img").forEach(t=>{const r=t.getAttribute("src");r&&!this.validateURL(r)&&e.push({type:"image",url:r,element:t,message:`Image source not from allowed domain: ${r}`})}),t.querySelectorAll("script").forEach(t=>{e.push({type:"script",url:t.getAttribute("src")||"inline",element:t,message:"Script tag found in widget content (CSP violation)"})}),t.querySelectorAll("iframe").forEach(t=>{e.push({type:"iframe",url:t.getAttribute("src")||"inline",element:t,message:"Iframe found in widget content (CSP violation)"})}),t.querySelectorAll("a").forEach(t=>{const r=t.getAttribute("href");r&&r.startsWith("javascript:")&&e.push({type:"link",url:r,element:t,message:"JavaScript URL in link (CSP violation)"})}),t.querySelectorAll("[onclick], [onload], [onerror], [onmouseover]").forEach(t=>{e.push({type:"inline-event",url:"inline",element:t,message:"Inline event handler found (CSP violation)"})}),{valid:0===e.length,violations:e}}async detectStrictCSP(){try{const t=document.querySelector('meta[http-equiv="Content-Security-Policy"]');if(t){const e=t.getAttribute("content")||"";return e.includes("'strict-dynamic'")||!e.includes("'unsafe-inline'")&&!e.includes("'unsafe-eval'")}}catch{}return!1}getNonce(){if(this.config.nonce)return this.config.nonce;if("undefined"!=typeof document){const t=document.querySelectorAll("script[data-widget-id]");for(const e of Array.from(t)){const t=e.getAttribute("nonce");if(t)return t}}return null}applyNonce(t){const e=this.getNonce();e&&("SCRIPT"!==t.tagName&&"STYLE"!==t.tagName||t.setAttribute("nonce",e))}getViolations(){return[...this.violations]}clearViolations(){this.violations=[]}setupViolationListener(){"undefined"!=typeof document&&document.addEventListener("securitypolicyviolation",t=>{t.blockedURI&&this.isWidgetRelated(t)&&(this.violations.push({type:"csp-violation",url:t.blockedURI,message:`CSP violation: ${t.violatedDirective} - ${t.blockedURI}`,directive:t.violatedDirective}),console.warn("[TrestaWidget] CSP violation detected:",{directive:t.violatedDirective,blockedURI:t.blockedURI,sourceFile:t.sourceFile}))})}isWidgetRelated(t){const e=t.blockedURI,r=t.sourceFile;return this.config.allowedDomains.some(t=>e.includes(t)||r?.includes(t))||r?.includes("tresta-widget")||e.includes("tresta-widget")}}new J;const Z=new WeakMap;class Y{constructor(t){r(this,"config"),r(this,"state"),r(this,"container",null),r(this,"root",null),r(this,"styleManager",null),r(this,"contentRoot",null),r(this,"liveRegion",null),r(this,"eventListeners",[]),r(this,"currentLayout",null),r(this,"apiClient"),r(this,"storageManager"),r(this,"telemetryTracker"),r(this,"logger"),r(this,"cspValidator"),this.config=t,this.state={mounted:!1,loading:!1,error:null,data:null},this.logger=new f(t.widgetId,t.version||"1.0.0",t.debug||!1);const e=t.apiUrl?{baseURL:t.apiUrl}:{};this.apiClient=new D(e,t.apiKey,this.logger),this.storageManager=new W,this.telemetryTracker=new U(t.widgetId,t.version||"1.0.0",{enabled:!1!==t.telemetry});const a={reportViolations:t.debug||!1};t.nonce&&(a.nonce=t.nonce),this.cspValidator=new J(a),this.logger.debug("Initialized with config:",{widgetId:t.widgetId,apiKey:t.apiKey?`${t.apiKey.substring(0,15)}...`:"NOT PROVIDED",apiUrl:t.apiUrl||`default (${T})`,debug:t.debug,telemetry:t.telemetry,version:t.version}),this.logger.debug("Telemetry enabled:",this.telemetryTracker.isEnabled())}async mount(t){try{if(this.telemetryTracker.startLoadTracking(),Z.has(t)){const e=Z.get(t);e&&e!==this&&(console.warn("[TrestaWidget] Container already has a widget instance. Unmounting existing widget."),e.unmount())}this.container=t,this.state.mounted=!0,this.state.loading=!0,this.root=document.createElement("div"),this.root.setAttribute("data-tresta-widget",this.config.widgetId),this.root.setAttribute("data-version",this.config.version||"1.0.0"),this.root.setAttribute("data-instance-id",this.generateInstanceId()),this.config.lang&&this.root.setAttribute("lang",this.config.lang),this.root.setAttribute("role","region"),this.root.setAttribute("aria-label","Testimonials widget"),this.styleManager=new l({debug:this.config.debug??!1,theme:this.config.theme,...void 0!==this.config.useShadowDOM&&{useShadowDOM:this.config.useShadowDOM},nonceApplier:t=>this.cspValidator.applyNonce(t)}),this.contentRoot=this.styleManager.initializeStyles(this.root),this.liveRegion=document.createElement("div"),this.liveRegion.setAttribute("role","status"),this.liveRegion.setAttribute("aria-live","polite"),this.liveRegion.setAttribute("aria-atomic","true"),this.liveRegion.className="tresta-sr-only",this.contentRoot.appendChild(this.liveRegion),t.appendChild(this.root),Z.set(t,this),await this.fetchAndRender(),this.logger.debug("Mounted successfully to container",t)}catch(e){this.state.loading=!1,this.state.error=e,e instanceof s?this.telemetryTracker.trackError(e.code):this.telemetryTracker.trackError("MOUNT_ERROR"),this.logError("Mount failed",e),this.renderErrorState(e)}}async fetchAndRender(){try{this.logger.debug("Starting fetchAndRender"),this.state.loading=!0,this.announceToScreenReader("Loading testimonials");const t=await this.fetchWithFallback();this.logger.debug("Data fetched successfully:",{widgetId:t.widgetId,testimonialCount:t.testimonials?.length||0}),this.state.data=t,this.state.error=null,this.state.loading=!1,this.renderContent(t),this.telemetryTracker.trackLoad(t.config?.layout?.type);const e=t.testimonials?.length||0;this.announceToScreenReader(`${e} testimonial${1!==e?"s":""} loaded`)}catch(t){this.state.loading=!1,this.state.error=t,t instanceof s?this.telemetryTracker.trackError(t.code):this.telemetryTracker.trackError("FETCH_ERROR"),this.logError("Failed to fetch widget data",t),this.renderErrorState(t),this.announceToScreenReader("Failed to load testimonials","assertive")}}async fetchWithFallback(){try{const t=await this.apiClient.fetchWidgetData(this.config.widgetId);return await this.storageManager.set(this.config.widgetId,t),this.logger.debug("Fetched widget data from API"),t}catch(t){const e=await this.storageManager.get(this.config.widgetId);if(e)return this.logger.warn("Using cached data due to API error"),e;throw t}}renderContent(t){if(this.logger.debug("renderContent called",{hasContentRoot:!!this.contentRoot,testimonialCount:t.testimonials?.length||0,widgetData:t}),!this.contentRoot)return void this.logger.error("No content root available for rendering");if(this.contentRoot.innerHTML="",!t.testimonials||0===t.testimonials.length)return this.logger.logEmpty(),void this.renderEmptyState();const e=t.config.layout.maxTestimonials??t.config.display.maxTestimonials,r=function(t,e){if(!t||0===t.length)return[];const r=e??100;return r<=0?[]:t.length<=r?K(t):K(t).slice(0,r)}(t.testimonials,e);this.logger.debug(`Rendering ${r.length} testimonials (limited from ${t.testimonials.length}) with layout: ${t.config.layout.type}`),this.currentLayout&&(this.currentLayout.destroy(),this.currentLayout=null);const a=G.create({testimonials:r,layoutConfig:t.config.layout,displayOptions:t.config.display,theme:t.config.theme}),i=a.render();if(this.contentRoot.appendChild(i),this.appendBrandingBadge(),this.currentLayout=a,this.logger.debug(`Widget rendered successfully with ${t.config.layout.type} layout`),this.config.debug&&this.contentRoot){const t=this.cspValidator.validateResources(this.contentRoot);t.valid?this.logger.debug("CSP validation passed"):this.logger.warn("CSP violations detected:",t.violations)}}renderErrorState(t){if(!this.contentRoot)return;this.contentRoot.innerHTML="";let e=this.config.errorMessage;e||(e=t instanceof s?t.message:"Unable to load testimonials. Please try again later.");const r=$({type:"error",message:e,widgetId:this.config.widgetId,version:this.config.version||"N/A"});this.contentRoot.appendChild(r),this.appendBrandingBadge()}renderEmptyState(){if(!this.contentRoot)return;this.contentRoot.innerHTML="";const t=$({type:"empty",...(e=this.config.emptyMessage)&&{message:e}});var e;this.contentRoot.appendChild(t),this.appendBrandingBadge()}appendBrandingBadge(){if(!this.contentRoot)return;const t=this.contentRoot.querySelector(".tresta-branding-badge");t&&t.remove();const e=function(){const t=document.createElement("div");t.className="tresta-branding-badge";const e=document.createElement("a");e.href=A,e.target="_blank",e.rel="noreferrer noopener",e.className="tresta-branding-link",e.setAttribute("aria-label","Powered by Tresta");const r=document.createElement("span");r.className="tresta-branding-logo",r.innerHTML='<svg width="512" height="512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">\r\n  <path d="M124.088 344.239l2.693-164.67 158.402-110.914 13.93 11.247-155.274 108.724-.831 50.779 189.4-132.619 55.056 44.453.448 18.812-1.257 76.866-61.453 43.03-1.63 99.663-76.74 53.734-2.32-1.873.351-21.487.225-.158-.22-.177 1.215-74.302-64.6 45.234-57.394-46.342zm183.708-42.104l-44.309 31.025-1.221 74.637 44.309-31.025 1.221-74.637zm23.876-173.833l-39.647 27.761 37.403 30.2 39.647-27.761-37.403-30.2zm-149.989 240.33l.896-54.806-36.832 25.79 35.936 29.015zm19.643-149.061l-2.19 133.91 47.356-33.159 1.257-76.866 67.013-46.923-37.403-30.2-76.034 53.239zm169.181-37.333l-105.762 74.055-.848 51.841 105.762-74.055.848-51.841zm-227.847 78.411l-.933 57.043 41.261-28.891.933-57.043-41.261 28.891z" fill="#00796b"/>\r\n</svg>\r\n';const a=document.createElement("span");return a.className="tresta-branding-text",a.textContent="Powered by Tresta",e.appendChild(r),e.appendChild(a),t.appendChild(e),t}();this.contentRoot.appendChild(e)}logError(t,e){e instanceof s?this.logger.error(`${t} for widget ${this.config.widgetId}:`,`[${e.code}]`,e.message):e instanceof Error?this.logger.error(`${t} for widget ${this.config.widgetId}:`,e.message):this.logger.error(`${t} for widget ${this.config.widgetId}:`,e)}unmount(){try{this.currentLayout&&(this.currentLayout.destroy(),this.currentLayout=null),this.cleanupEventListeners(),this.styleManager&&(this.styleManager.cleanup(),this.styleManager=null),this.root&&this.root.parentNode&&(this.root.parentNode.removeChild(this.root),this.root=null),this.container&&Z.delete(this.container),this.state.mounted=!1,this.container=null,this.contentRoot=null,this.logger.debug("Unmounted successfully")}catch(t){console.error("[TrestaWidget] Unmount failed:",t)}}async refresh(){try{if(this.logger.debug("Refresh requested"),!this.state.mounted)return void this.logger.warn("Cannot refresh: widget not mounted");await this.fetchAndRender()}catch(t){this.logError("Refresh failed",t)}}getState(){return{...this.state}}cleanupEventListeners(){this.eventListeners.forEach(({element:t,event:e,handler:r})=>{t.removeEventListener(e,r)}),this.eventListeners=[]}generateInstanceId(){return`${this.config.widgetId}-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}announceToScreenReader(t,e="polite"){this.liveRegion&&(this.liveRegion.setAttribute("aria-live",e),this.liveRegion.textContent=t,setTimeout(()=>{this.liveRegion&&(this.liveRegion.textContent="")},1e3))}static getInstance(t){return Z.get(t)}getStyleManager(){return this.styleManager}getContentRoot(){return this.contentRoot}getTelemetryTracker(){return this.telemetryTracker}}function Q(t){try{const e=function(t){const e=function(t){const e=function(t){return t.getAttribute("data-widget-id")||t.getAttribute("data-tresta-widget")}(t),r=t.getAttribute("data-api-key"),a=t.getAttribute("data-version"),i=t.getAttribute("data-api-url"),s=t.getAttribute("nonce"),n={debug:"true"===t.getAttribute("data-debug"),telemetry:"false"!==t.getAttribute("data-telemetry")};e&&(n.widgetId=e),r&&(n.apiKey=r),n.version=a||"1.0.0",i&&(n.apiUrl=i),s&&(n.nonce=s);const l=o.parseThemeFromElement(t);return Object.keys(l).length>0&&(n.theme=l),n}(t);return function(t){if(!t.widgetId)throw new Error("[TrestaWidget] widgetId is required");if(!t.apiKey)throw new Error("[TrestaWidget] apiKey is required")}(e),e}(t),r=function(t,e){const r=t.getAttribute("data-container");if(r){const t=document.querySelector(r);if(!t)throw new Error(`[TrestaWidget] Container not found: ${r}`);return t}const a=document.getElementById(`tresta-widget-${e}`);if(a)return a;const i=document.createElement("div");return i.id=`tresta-widget-${e}`,t.parentNode?.insertBefore(i,t.nextSibling),i}(t,e.widgetId);if(Y.getInstance(r))return void e.debug;new Y(e).mount(r)}catch(e){console.error("[TrestaWidget] Failed to initialize widget:",e)}}function tt(){try{const t=document.querySelectorAll("script[data-widget-id], script[data-tresta-widget]");if(0===t.length)return;t.forEach(t=>{Q(t)})}catch(t){console.error("[TrestaWidget] Auto-initialization failed:",t)}}const et={async mount(t,e){const r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`[TrestaWidget] Container not found: ${t}`);const a=new Y(e);return await a.mount(r),a},unmount(t){const e="string"==typeof t?document.querySelector(t):t;if(!e)return void console.warn(`[TrestaWidget] Container not found: ${t}`);const r=Y.getInstance(e);r?r.unmount():console.warn("[TrestaWidget] No widget instance found in container")},version:"1.0.0"};return"undefined"!=typeof window&&(window.TrestaWidget=et,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",tt):tt()),t.TrestaWidget=et,t.Widget=Y,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t}({});
//# sourceMappingURL=tresta-widget.js.map
