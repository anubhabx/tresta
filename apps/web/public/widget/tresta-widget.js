var __defProp=Object.defineProperty,__defNormalProp=(t,e,n)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,__publicField=(t,e,n)=>__defNormalProp(t,"symbol"!=typeof e?e+"":e,n);!function(t){"use strict";const e={primaryColor:"#3b82f6",backgroundColor:"#ffffff",textColor:"#1f2937",cardBackgroundColor:"#ffffff",borderRadius:8,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',starColor:"#000000"};function n(t,e,n,a){if(!t||0===t.length)return'<div class="tresta-empty">No testimonials yet.</div>';const r=n.maxTestimonials?t.slice(0,n.maxTestimonials):t;return"carousel"===e?function(t,e,n){return`<div class="tresta-carousel" data-widget-id="${n}"></div>`}(0,0,a):function(t,e){return`<div class="tresta-testimonials">${t.map(t=>function(t,e){const{showRating:n,showDate:a,showAvatar:r,showAuthorRole:o,showAuthorCompany:s}=e,l=n?`<div class="tresta-rating">\n         ${Array.from({length:5}).map((e,n)=>n<(t.rating||5)?'<svg class="tresta-star" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>':'<svg class="tresta-star tresta-star-empty" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>').join("")}\n       </div>`:"";let d="";if(r)if(t.authorAvatar)d=`<img src="${i(t.authorAvatar)}" alt="${i(t.authorName)}" class="tresta-author-image" />`;else{const e=function(t){const e=t.trim().split(/\s+/);return 1===e.length?e[0]?.charAt(0).toUpperCase()??"":((e[0]?.charAt(0)??"")+(e[e.length-1]?.charAt(0)??"")).toUpperCase()}(t.authorName);d=`<div class="tresta-author-image tresta-author-initials" style="background-color: ${function(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return`hsl(${e%360}, 65%, 50%)`}(t.authorName)}">${e}</div>`}let c="";o&&t.authorRole?c=`<p class="tresta-author-role">${i(t.authorRole)}${s&&t.authorCompany?` <span class="tresta-author-company">at ${i(t.authorCompany)}</span>`:""}</p>`:s&&t.authorCompany&&(c=`<p class="tresta-author-role"><span class="tresta-author-company">${i(t.authorCompany)}</span></p>`);const u=t.isOAuthVerified?`<span class="tresta-verified-badge" title="Verified via ${t.oauthProvider||"OAuth"}">\n      <svg width="64px" height="64px" viewBox="-2.4 -2.4 28.80 28.80" fill="none" xmlns="http://www.w3.org/2000/svg" transform="rotate(0)matrix(1, 0, 0, 1, 0, 0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M9.78133 3.89027C10.3452 3.40974 10.6271 3.16948 10.9219 3.02859C11.6037 2.70271 12.3963 2.70271 13.0781 3.02859C13.3729 3.16948 13.6548 3.40974 14.2187 3.89027C14.4431 4.08152 14.5553 4.17715 14.6752 4.25747C14.9499 4.4416 15.2584 4.56939 15.5828 4.63344C15.7244 4.66139 15.8713 4.67312 16.1653 4.69657C16.9038 4.7555 17.273 4.78497 17.5811 4.89378C18.2936 5.14546 18.8541 5.70591 19.1058 6.41844C19.2146 6.72651 19.244 7.09576 19.303 7.83426C19.3264 8.12819 19.3381 8.27515 19.3661 8.41669C19.4301 8.74114 19.5579 9.04965 19.7421 9.32437C19.8224 9.44421 19.918 9.55642 20.1093 9.78084C20.5898 10.3447 20.8301 10.6267 20.971 10.9214C21.2968 11.6032 21.2968 12.3958 20.971 13.0776C20.8301 13.3724 20.5898 13.6543 20.1093 14.2182C19.918 14.4426 19.8224 14.5548 19.7421 14.6747C19.5579 14.9494 19.4301 15.2579 19.3661 15.5824C19.3381 15.7239 19.3264 15.8709 19.303 16.1648C19.244 16.9033 19.2146 17.2725 19.1058 17.5806C18.8541 18.2931 18.2936 18.8536 17.5811 19.1053C17.273 19.2141 16.9038 19.2435 16.1653 19.3025C15.8713 19.3259 15.7244 19.3377 15.5828 19.3656C15.2584 19.4297 14.9499 19.5574 14.6752 19.7416C14.5553 19.8219 14.4431 19.9175 14.2187 20.1088C13.6548 20.5893 13.3729 20.8296 13.0781 20.9705C12.3963 21.2963 11.6037 21.2963 10.9219 20.9705C10.6271 20.8296 10.3452 20.5893 9.78133 20.1088C9.55691 19.9175 9.44469 19.8219 9.32485 19.7416C9.05014 19.5574 8.74163 19.4297 8.41718 19.3656C8.27564 19.3377 8.12868 19.3259 7.83475 19.3025C7.09625 19.2435 6.72699 19.2141 6.41893 19.1053C5.7064 18.8536 5.14594 18.2931 4.89427 17.5806C4.78546 17.2725 4.75599 16.9033 4.69706 16.1648C4.6736 15.8709 4.66188 15.7239 4.63393 15.5824C4.56988 15.2579 4.44209 14.9494 4.25796 14.6747C4.17764 14.5548 4.08201 14.4426 3.89076 14.2182C3.41023 13.6543 3.16997 13.3724 3.02907 13.0776C2.7032 12.3958 2.7032 11.6032 3.02907 10.9214C3.16997 10.6266 3.41023 10.3447 3.89076 9.78084C4.08201 9.55642 4.17764 9.44421 4.25796 9.32437C4.44209 9.04965 4.56988 8.74114 4.63393 8.41669C4.66188 8.27515 4.6736 8.12819 4.69706 7.83426C4.75599 7.09576 4.78546 6.72651 4.89427 6.41844C5.14594 5.70591 5.7064 5.14546 6.41893 4.89378C6.72699 4.78497 7.09625 4.7555 7.83475 4.69657C8.12868 4.67312 8.27564 4.66139 8.41718 4.63344C8.74163 4.56939 9.05014 4.4416 9.32485 4.25747C9.4447 4.17715 9.55691 4.08152 9.78133 3.89027Z" stroke="#1C274C" stroke-width="1.44"></path> <path d="M8.5 12.5L10.5 14.5L15.5 9.5" stroke="#1C274C" stroke-width="1.44" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>\n      </span>`:"",h=a?`<div class="tresta-date">${function(t){try{const e=new Date(t),n=(new Date).getTime()-e.getTime(),i=Math.floor(n/1e3),a=Math.floor(i/60),r=Math.floor(a/60),o=Math.floor(r/24),s=Math.floor(o/7),l=Math.floor(o/30),d=Math.floor(o/365);return i<60?"just now":a<60?`${a} ${1===a?"minute":"minutes"} ago`:r<24?`${r} ${1===r?"hour":"hours"} ago`:o<7?`${o} ${1===o?"day":"days"} ago`:s<4?`${s} ${1===s?"week":"weeks"} ago`:l<12?`${l} ${1===l?"month":"months"} ago`:`${d} ${1===d?"year":"years"} ago`}catch{return t}}(t.createdAt)}</div>`:"";return`\n    <div class="tresta-testimonial tresta-fade-in" data-testimonial-id="${t.id}">\n      ${l}\n      <div class="tresta-content">"${i(t.content)}"</div>\n      <div class="tresta-author">\n        ${d}\n        <div class="tresta-author-info">\n          <p class="tresta-author-name">\n            ${i(t.authorName)}\n            ${u}\n          </p>\n          ${c}\n        </div>\n      </div>\n      ${h}\n    </div>\n  `}(t,e)).join("")}</div>`}(r,n)}function i(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}class a{constructor(t){__publicField(this,"container"),__publicField(this,"testimonials"),__publicField(this,"currentIndex",0),__publicField(this,"autoplayInterval",null),__publicField(this,"autoplay"),__publicField(this,"autoplaySpeed"),__publicField(this,"showRating"),__publicField(this,"showCompany"),__publicField(this,"showAvatar"),__publicField(this,"showDate"),__publicField(this,"onSlideChange"),__publicField(this,"isAutoPlayActive"),__publicField(this,"touchStartX",0),__publicField(this,"touchEndX",0),__publicField(this,"isDragging",!1),__publicField(this,"carouselCard",null),__publicField(this,"contentContainer",null),__publicField(this,"prevButton",null),__publicField(this,"nextButton",null),__publicField(this,"indicatorsContainer",null),__publicField(this,"autoplayToggle",null),this.container=t.container,this.testimonials=t.testimonials,this.autoplay=t.autoplay??!0,this.autoplaySpeed=t.autoplaySpeed??5e3,this.showRating=t.showRating??!0,this.showCompany=t.showCompany??!0,this.showAvatar=t.showAvatar??!0,this.showDate=t.showDate??!0,this.onSlideChange=t.onSlideChange,this.isAutoPlayActive=this.autoplay,this.init()}init(){this.testimonials.length?(this.render(),this.setupControls(),this.setupTouchSupport(),this.setupKeyboardNavigation(),this.autoplay&&(this.startAutoplay(),this.setupAutoplayPause())):this.renderEmptyState()}renderEmptyState(){this.container.innerHTML='\n            <div class="tresta-carousel-empty">\n                No testimonials available\n            </div>\n        '}render(){this.container.innerHTML="",this.container.className="tresta-carousel-container";const t=document.createElement("div");t.className="tresta-carousel-wrapper",this.carouselCard=document.createElement("div"),this.carouselCard.className="tresta-carousel-card",this.contentContainer=document.createElement("div"),this.contentContainer.className="tresta-carousel-content",this.carouselCard.appendChild(this.contentContainer),t.appendChild(this.carouselCard),this.prevButton=this.createNavigationButton("prev","Previous testimonial"),this.nextButton=this.createNavigationButton("next","Next testimonial"),t.appendChild(this.prevButton),t.appendChild(this.nextButton),this.container.appendChild(t),this.indicatorsContainer=document.createElement("div"),this.indicatorsContainer.className="tresta-carousel-indicators",this.container.appendChild(this.indicatorsContainer);const e=document.createElement("div");e.className="tresta-carousel-autoplay-container",this.autoplayToggle=document.createElement("button"),this.autoplayToggle.className="tresta-carousel-autoplay-toggle",e.appendChild(this.autoplayToggle),this.container.appendChild(e),this.renderIndicators(),this.renderTestimonial()}createNavigationButton(t,e){const n=document.createElement("button");n.setAttribute("data-action",t),n.setAttribute("aria-label",e),n.className="tresta-carousel-nav-button tresta-carousel-nav-"+t;const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width","24"),i.setAttribute("height","24"),i.setAttribute("viewBox","0 0 24 24"),i.setAttribute("fill","none"),i.setAttribute("stroke","currentColor"),i.setAttribute("stroke-width","2.5"),i.setAttribute("stroke-linecap","round"),i.setAttribute("stroke-linejoin","round");const a=document.createElementNS("http://www.w3.org/2000/svg","path");return"prev"===t?a.setAttribute("d","M15 18l-6-6 6-6"):a.setAttribute("d","M9 18l6-6-6-6"),i.appendChild(a),n.appendChild(i),n}renderIndicators(){this.indicatorsContainer&&(this.indicatorsContainer.innerHTML="",this.testimonials.forEach((t,e)=>{const n=document.createElement("button");n.setAttribute("aria-label","Go to testimonial "+(e+1)),n.setAttribute("data-index",e+""),n.className=e===this.currentIndex?"tresta-carousel-indicator tresta-carousel-indicator-active":"tresta-carousel-indicator",e===this.currentIndex&&n.setAttribute("aria-current","true"),this.indicatorsContainer&&this.indicatorsContainer.appendChild(n)}))}renderTestimonial(){if(!this.contentContainer)return;const t=this.testimonials[this.currentIndex];if(!t)return;if(this.contentContainer.innerHTML="",this.showRating&&t.rating){const e=document.createElement("div");e.className="tresta-carousel-rating";for(let n=0;n<5;n++){const i=this.createStarIcon(n<t.rating);e.appendChild(i)}this.contentContainer.appendChild(e)}const e=document.createElement("div");e.className="tresta-carousel-quote-container";const n=document.createElement("blockquote");n.className="tresta-carousel-quote",n.textContent=`"${t.content}"`,e.appendChild(n),this.contentContainer.appendChild(e);const i=document.createElement("div");if(i.className="tresta-carousel-author",this.showAvatar){let e;if(t.avatar)e=document.createElement("img"),e.className="tresta-carousel-avatar",e.src=t.avatar,e.alt=t.name;else{e=document.createElement("div"),e.className="tresta-carousel-avatar tresta-carousel-avatar-initials";const n=this.getInitials(t.name),i=this.getColorFromName(t.name);e.style.backgroundColor=i,e.style.color="white",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.fontWeight="600",e.style.fontSize="18px",e.textContent=n}i.appendChild(e)}const a=document.createElement("div");a.className="tresta-carousel-author-info";const r=document.createElement("p");if(r.className="tresta-carousel-author-name",r.textContent=t.name,t.isOAuthVerified){const e=document.createElement("span");e.className="tresta-verified-badge",e.title="Verified via "+(t.oauthProvider||"OAuth"),e.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>\n              <polyline points="22 4 12 14.01 9 11.01"></polyline>\n            </svg>',r.appendChild(e)}a.appendChild(r);const o=document.createElement("p");o.className="tresta-carousel-author-role";let s=t.role;if(this.showCompany&&t.company&&(s+=" at "+t.company),o.textContent=s,a.appendChild(o),i.appendChild(a),this.contentContainer.appendChild(i),this.showDate){const e=document.createElement("div");e.className="tresta-carousel-date",e.textContent=this.formatRelativeDate(t.createdAt),this.contentContainer.appendChild(e)}this.updateAutoplayToggle()}createStarIcon(t){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","20"),e.setAttribute("height","20"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill",t?"currentColor":"none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","1.5"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.setAttribute("class",t?"tresta-carousel-star-filled":"tresta-carousel-star-empty");const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"),e.appendChild(n),e}updateAutoplayToggle(){if(!this.autoplayToggle)return;this.autoplayToggle.innerHTML="";const t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.setAttribute("width","14"),t.setAttribute("height","14"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","currentColor"),t.setAttribute("stroke","none"),t.style.marginRight="6px",this.isAutoPlayActive){const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x","6"),e.setAttribute("y","4"),e.setAttribute("width","4"),e.setAttribute("height","16"),e.setAttribute("rx","1");const n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("x","14"),n.setAttribute("y","4"),n.setAttribute("width","4"),n.setAttribute("height","16"),n.setAttribute("rx","1"),t.appendChild(e),t.appendChild(n)}else{const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M8 5v14l11-7z"),t.appendChild(e)}this.autoplayToggle.appendChild(t);const e=document.createTextNode(this.isAutoPlayActive?"Pause":"Play");this.autoplayToggle.appendChild(e)}setupControls(){this.prevButton?.addEventListener("click",()=>this.prev()),this.nextButton?.addEventListener("click",()=>this.next()),this.indicatorsContainer&&this.indicatorsContainer.addEventListener("click",t=>{const e=t.target.getAttribute("data-index");null!==e&&this.goToSlide(parseInt(e,10))}),this.autoplayToggle?.addEventListener("click",()=>{this.isAutoPlayActive=!this.isAutoPlayActive,this.isAutoPlayActive?this.startAutoplay():this.stopAutoplay(),this.updateAutoplayToggle()})}setupTouchSupport(){if(!this.carouselCard)return;this.carouselCard.addEventListener("touchstart",t=>{const e=t.touches[0];e&&(this.touchStartX=e.clientX,this.isDragging=!0)},{passive:!0}),this.carouselCard.addEventListener("touchmove",t=>{if(!this.isDragging)return;const e=t.touches[0];e&&(this.touchEndX=e.clientX)},{passive:!0}),this.carouselCard.addEventListener("touchend",()=>{if(!this.isDragging)return;this.isDragging=!1;const t=this.touchStartX-this.touchEndX;Math.abs(t)>50&&(t>0?this.next():this.prev())});let t=0,e=!1;this.carouselCard.addEventListener("mousedown",n=>{t=n.clientX,e=!0,this.carouselCard&&(this.carouselCard.style.cursor="grabbing")}),document.addEventListener("mousemove",t=>{e&&this.carouselCard}),document.addEventListener("mouseup",n=>{if(!e||!this.carouselCard)return;e=!1,this.carouselCard&&(this.carouselCard.style.cursor="grab");const i=t-n.clientX;Math.abs(i)>50&&(i>0?this.next():this.prev())})}setupKeyboardNavigation(){this.container.addEventListener("keydown",t=>{"ArrowLeft"===t.key?(t.preventDefault(),this.prev()):"ArrowRight"===t.key&&(t.preventDefault(),this.next())}),this.container.setAttribute("tabindex","0")}setupAutoplayPause(){this.carouselCard&&(this.carouselCard.addEventListener("mouseenter",()=>{this.isAutoPlayActive&&this.stopAutoplay()}),this.carouselCard.addEventListener("mouseleave",()=>{this.isAutoPlayActive&&this.startAutoplay()}),this.container.addEventListener("focus",()=>{this.isAutoPlayActive&&this.stopAutoplay()}),this.container.addEventListener("blur",()=>{this.isAutoPlayActive&&this.startAutoplay()}))}goToSlide(t){t<0?t=this.testimonials.length-1:t>=this.testimonials.length&&(t=0),this.currentIndex=t,this.contentContainer&&(this.contentContainer.style.opacity="0",this.contentContainer.style.transition="opacity 0.3s ease-in-out",setTimeout(()=>{this.renderTestimonial(),this.renderIndicators(),this.contentContainer&&(this.contentContainer.style.opacity="1")},150)),this.onSlideChange&&this.onSlideChange(t)}next(){this.goToSlide(this.currentIndex+1),this.isAutoPlayActive&&(this.stopAutoplay(),setTimeout(()=>{this.isAutoPlayActive&&this.startAutoplay()},1e4))}prev(){this.goToSlide(this.currentIndex-1),this.isAutoPlayActive&&(this.stopAutoplay(),setTimeout(()=>{this.isAutoPlayActive&&this.startAutoplay()},1e4))}startAutoplay(){this.stopAutoplay(),this.autoplayInterval=window.setInterval(()=>{this.next()},this.autoplaySpeed)}stopAutoplay(){this.autoplayInterval&&(clearInterval(this.autoplayInterval),this.autoplayInterval=null)}destroy(){this.stopAutoplay()}getCurrentIndex(){return this.currentIndex}getTotalTestimonials(){return this.testimonials.length}getTestimonials(){return this.testimonials}setTestimonials(t){this.testimonials=t,this.currentIndex=0,this.init()}getInitials(t){const e=t.trim().split(/\s+/);return 1===e.length?e[0]?.charAt(0).toUpperCase()??"":((e[0]?.charAt(0)??"")+(e[e.length-1]?.charAt(0)??"")).toUpperCase()}getColorFromName(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return`hsl(${e%360}, 65%, 50%)`}formatRelativeDate(t){try{const e=new Date(t),n=(new Date).getTime()-e.getTime(),i=Math.floor(n/1e3),a=Math.floor(i/60),r=Math.floor(a/60),o=Math.floor(r/24),s=Math.floor(o/7),l=Math.floor(o/30),d=Math.floor(o/365);return i<60?"just now":a<60?`${a} ${1===a?"minute":"minutes"} ago`:r<24?`${r} ${1===r?"hour":"hours"} ago`:o<7?`${o} ${1===o?"day":"days"} ago`:s<4?`${s} ${1===s?"week":"weeks"} ago`:l<12?`${l} ${1===l?"month":"months"} ago`:`${d} ${1===d?"year":"years"} ago`}catch{return t}}}class r{constructor(t){__publicField(this,"config"),__publicField(this,"container",null),__publicField(this,"widget",null),__publicField(this,"testimonials",[]),__publicField(this,"carouselInterval",null),__publicField(this,"currentSlide",0),__publicField(this,"effectiveLayout",null),this.config={apiUrl:"http://localhost:8000",...t},this.init()}async init(){try{if(this.container=this.findContainer(),!this.container)throw Error("Widget container not found");this.render('\n    <div class="tresta-loading">\n      <div class="tresta-spinner"></div>\n    </div>\n  '),await this.fetchWidgetData(),this.injectWidgetStyles(),this.renderWidget(),"carousel"===(this.config.settings?.layout||this.widget?.layout)&&this.initCarousel(),this.config.onLoad&&this.widget&&this.config.onLoad(this.widget)}catch(t){this.handleError(t)}}findContainer(){if(!this.config.container){const t=document.querySelectorAll("script[data-tresta-widget]"),e=Array.from(t).find(t=>t.getAttribute("data-tresta-widget")===this.config.widgetId);if(e){const t=e.getAttribute("data-container");if(t)return document.getElementById(t);const n=document.createElement("div");return n.id="tresta-widget-"+this.config.widgetId,n.className="tresta-widget-"+this.config.widgetId,e.parentNode?.insertBefore(n,e.nextSibling),n}const n=document.createElement("div");return n.id="tresta-widget-"+this.config.widgetId,n.className="tresta-widget-"+this.config.widgetId,document.body.appendChild(n),n}return"string"==typeof this.config.container?document.querySelector(this.config.container):this.config.container}async fetchWidgetData(){const t=`${this.config.apiUrl}/api/widgets/${this.config.widgetId}/public`,e=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error(`Failed to fetch widget data: ${e.status} ${e.statusText}`);const n=await e.json();if(!n.success||!n.data)throw Error(n.error?.message||"Failed to load widget data");this.widget=n.data.widget,this.testimonials=n.data.testimonials||[]}injectWidgetStyles(){if(!this.widget)return;const t={...e,...this.widget.theme,...this.config.theme},n={...this.widget.settings,...this.config.settings},i=(this.config.settings?.layout||this.widget.layout,function(t,n,i,a){const r={...e,...t},o=".tresta-widget-"+i,s=a?.gap||24,l=a?.columns||2;return`\n    /* Base Widget Container */\n    ${o} {\n      font-family: ${r.fontFamily};\n      color: ${r.textColor};\n      background-color: ${r.backgroundColor};\n      width: 100%;\n      max-width: 100%;\n      box-sizing: border-box;\n      overflow: hidden;\n    }\n\n    ${o} * {\n      box-sizing: border-box;\n    }\n\n    /* Widget Inner Container */\n    ${o} .tresta-widget-inner {\n      width: 100%;\n      padding: 0;\n      margin: 0;\n    }\n\n    /* Loading State */\n    ${o} .tresta-loading {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 40px;\n      color: ${r.primaryColor};\n      font-size: 16px;\n    }\n\n    ${o} .tresta-spinner {\n      width: 40px;\n      height: 40px;\n      border: 3px solid ${r.cardBackgroundColor};\n      border-top-color: ${r.primaryColor};\n      border-radius: 50%;\n      animation: tresta-spin 0.8s linear infinite;\n    }\n\n    @keyframes tresta-spin {\n      to { transform: rotate(360deg); }\n    }\n\n    /* Error State */\n    ${o} .tresta-error {\n      padding: 20px;\n      background-color: #fee2e2;\n      color: #991b1b;\n      border-radius: ${r.borderRadius}px;\n      text-align: center;\n    }\n\n    /* Empty State */\n    ${o} .tresta-empty {\n      padding: 40px;\n      text-align: center;\n      color: #6b7280;\n    }\n\n    /* Testimonial Card - Base */\n    ${o} .tresta-testimonial {\n      background-color: ${r.cardBackgroundColor};\n      border: 1px solid #e5e7eb;\n      border-radius: 8px;\n      padding: 24px;\n      margin-bottom: 16px;\n      transition: all 0.2s ease;\n      height: 100%;\n      display: flex;\n      flex-direction: column;\n    }\n\n    ${o} .tresta-testimonial:hover {\n      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n      border-color: ${r.primaryColor}80;\n    }\n\n    ${o}.tresta-layout-grid .tresta-testimonial {\n      margin-bottom: 0;\n    }\n\n    /* Rating Stars */\n    ${o} .tresta-rating {\n      display: flex;\n      gap: 4px;\n      margin-bottom: 16px;\n      line-height: 1;\n    }\n\n    ${o} .tresta-star {\n      display: inline-block;\n      width: 16px;\n      height: 16px;\n      min-width: 16px;\n      min-height: 16px;\n      max-width: 16px;\n      max-height: 16px;\n      color: ${r.starColor};\n      fill: ${r.starColor};\n      flex-shrink: 0;\n    }\n\n    ${o} .tresta-star-empty {\n      color: #d1d5db;\n      fill: #d1d5db;\n    }\n\n    /* Testimonial Content */\n    ${o} .tresta-content {\n      font-size: 14px;\n      line-height: 1.625;\n      color: ${r.textColor};\n      margin-bottom: 16px;\n      flex: 1;\n      display: -webkit-box;\n      -webkit-line-clamp: 4;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n\n    /* Author Section */\n    ${o} .tresta-author {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      margin-top: auto;\n      padding-top: 16px;\n      border-top: 1px solid #e5e7eb;\n    }\n\n    ${o} .tresta-author-image {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      object-fit: cover;\n      flex-shrink: 0;\n      background-color: ${r.primaryColor};\n      color: white;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: 600;\n      font-size: 16px;\n    }\n\n    ${o} .tresta-author-image.tresta-author-initials {\n      /* Initials fallback - background color is set inline for unique colors */\n      color: white;\n      text-transform: uppercase;\n    }\n\n    ${o} .tresta-author-info {\n      flex: 1;\n      min-width: 0;\n    }\n\n    ${o} .tresta-author-name {\n      font-weight: 600;\n      font-size: 14px;\n      color: ${r.textColor};\n      margin: 0 0 2px 0;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      display: flex;\n      align-items: center;\n      gap: 4px;\n    }\n\n    ${o} .tresta-verified-badge {\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n      color: #10b981;\n      border-radius: 50%;\n      width: 24px;\n      height: 24px;\n      padding: 2px;\n    }\n\n    ${o} .tresta-verified-badge svg {\n      width: 100%;\n      height: 100%;\n    }\n\n    ${o} .tresta-author-role {\n      font-size: 12px;\n      color: #6b7280;\n      margin: 0;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    ${o} .tresta-author-company {\n      font-size: 12px;\n      color: #9ca3af;\n    }\n\n    /* Date */\n    ${o} .tresta-date {\n      font-size: 12px;\n      color: #9ca3af;\n      margin-top: 12px;\n      text-align: left;\n    }\n\n    /* Layout: List */\n    ${o}.tresta-layout-list .tresta-testimonials {\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    }\n\n    /* Layout: Grid */\n    ${o}.tresta-layout-grid .tresta-testimonials {\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n      gap: ${s}px;\n      align-items: stretch;\n    }\n\n    ${o}.tresta-layout-grid .tresta-testimonial {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n    }\n\n    @media (min-width: 768px) {\n      ${o}.tresta-layout-grid .tresta-testimonials {\n        grid-template-columns: repeat(${Math.min(l,2)}, 1fr);\n      }\n    }\n\n    @media (min-width: 1024px) {\n      ${o}.tresta-layout-grid .tresta-testimonials {\n        grid-template-columns: repeat(${l}, 1fr);\n      }\n    }\n\n    @media (max-width: 767px) {\n      ${o}.tresta-layout-grid .tresta-testimonials {\n        grid-template-columns: 1fr;\n      }\n    }\n\n    /* Layout: Masonry */\n    ${o}.tresta-layout-masonry .tresta-testimonials {\n      column-count: 3;\n      column-gap: 20px;\n    }\n\n    ${o}.tresta-layout-masonry .tresta-testimonial {\n      break-inside: avoid;\n      margin-bottom: 20px;\n    }\n\n    @media (max-width: 1024px) {\n      ${o}.tresta-layout-masonry .tresta-testimonials {\n        column-count: 2;\n      }\n    }\n\n    @media (max-width: 640px) {\n      ${o}.tresta-layout-masonry .tresta-testimonials {\n        column-count: 1;\n      }\n    }\n\n    /* Layout: Carousel - New Enhanced Styles */\n    ${o}.tresta-layout-carousel .tresta-carousel {\n      position: relative;\n      width: 100%;\n      max-width: 900px;\n      margin: 0 auto;\n    }\n\n    ${o} .tresta-carousel-container {\n      width: 100%;\n    }\n\n    ${o} .tresta-carousel-wrapper {\n      position: relative;\n      padding: 0 70px;\n    }\n\n    @media (max-width: 768px) {\n      ${o} .tresta-carousel-wrapper {\n        padding: 0 50px;\n      }\n    }\n\n    ${o} .tresta-carousel-card {\n      background-color: #ffffff;\n      border: 1px solid #e5e7eb;\n      border-radius: 12px;\n      padding: 60px 80px;\n      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);\n      transition: opacity 0.3s ease-in-out;\n      min-height: 400px;\n      display: flex;\n      align-items: stretch;\n    }\n\n    @media (max-width: 768px) {\n      ${o} .tresta-carousel-card {\n        padding: 40px 32px;\n        min-height: 350px;\n      }\n    }\n\n    ${o} .tresta-carousel-content {\n      display: flex;\n      flex-direction: column;\n      gap: 32px;\n      width: 100%;\n      flex: 1;\n      min-height: 0;\n    }\n\n    ${o} .tresta-carousel-rating {\n      display: flex;\n      gap: 6px;\n      justify-content: flex-start;\n      flex-shrink: 0;\n    }\n\n    ${o} .tresta-carousel-star-filled {\n      color: #000000;\n    }\n\n    ${o} .tresta-carousel-star-empty {\n      color: #d1d5db;\n    }\n\n    ${o} .tresta-carousel-quote-container {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      min-height: 0;\n      overflow: hidden;\n    }\n\n    ${o} .tresta-carousel-quote {\n      font-size: 22px;\n      line-height: 1.7;\n      color: #1f2937;\n      font-style: normal;\n      margin: 0;\n      font-weight: 400;\n      overflow-y: auto;\n      flex: 1;\n    }\n\n    @media (max-width: 768px) {\n      ${o} .tresta-carousel-quote {\n        font-size: 18px;\n      }\n    }\n\n    ${o} .tresta-carousel-author {\n      display: flex;\n      align-items: center;\n      gap: 16px;\n      padding-top: 8px;\n      flex-shrink: 0;\n    }\n\n    ${o} .tresta-carousel-avatar {\n      width: 48px;\n      height: 48px;\n      border-radius: 50%;\n      object-fit: cover;\n      flex-shrink: 0;\n      background-color: #e5e7eb;\n    }\n\n    ${o} .tresta-carousel-avatar-initials {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-weight: 600;\n      font-size: 18px;\n      color: white;\n      text-transform: uppercase;\n    }\n\n    ${o} .tresta-carousel-author-info {\n      flex: 1;\n      min-width: 0;\n    }\n\n    ${o} .tresta-carousel-author-name {\n      font-weight: 600;\n      font-size: 16px;\n      color: #1f2937;\n      margin: 0 0 4px 0;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n    }\n\n    ${o} .tresta-carousel-author-role {\n      font-size: 14px;\n      color: #6b7280;\n      margin: 0;\n    }\n\n    ${o} .tresta-carousel-date {\n      font-size: 12px;\n      color: #9ca3af;\n      margin-top: 12px;\n      text-align: left;\n    }\n\n    /* Carousel Navigation Buttons */\n    ${o} .tresta-carousel-nav-button {\n      position: absolute;\n      top: 50%;\n      transform: translateY(-50%);\n      background-color: #1f2937;\n      color: white;\n      border: none;\n      border-radius: 50%;\n      width: 48px;\n      height: 48px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      z-index: 10;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n    }\n\n    ${o} .tresta-carousel-nav-button:hover {\n      background-color: #374151;\n      transform: translateY(-50%) scale(1.05);\n    }\n\n    ${o} .tresta-carousel-nav-button:focus {\n      outline: none;\n      box-shadow: 0 0 0 3px rgba(31, 41, 55, 0.2);\n    }\n\n    ${o} .tresta-carousel-nav-prev {\n      left: 16px;\n    }\n\n    ${o} .tresta-carousel-nav-next {\n      right: 16px;\n    }\n\n    @media (max-width: 768px) {\n      ${o} .tresta-carousel-nav-button {\n        width: 40px;\n        height: 40px;\n      }\n    }\n\n    /* Carousel Indicators */\n    ${o} .tresta-carousel-indicators {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: 8px;\n      margin-top: 32px;\n    }\n\n    ${o} .tresta-carousel-indicator {\n      width: 32px;\n      height: 4px;\n      border-radius: 2px;\n      background-color: #d1d5db;\n      border: none;\n      padding: 0;\n      cursor: pointer;\n      transition: all 0.3s ease;\n    }\n\n    ${o} .tresta-carousel-indicator:hover {\n      background-color: #9ca3af;\n    }\n\n    ${o} .tresta-carousel-indicator-active {\n      width: 48px;\n      background-color: #1f2937;\n    }\n\n    /* Carousel Autoplay Toggle */\n    ${o} .tresta-carousel-autoplay-container {\n      display: flex;\n      justify-content: center;\n      margin-top: 16px;\n    }\n\n    ${o} .tresta-carousel-autoplay-toggle {\n      background: none;\n      border: none;\n      color: #6b7280;\n      font-size: 14px;\n      cursor: pointer;\n      padding: 8px 16px;\n      transition: color 0.2s ease;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n    }\n\n    ${o} .tresta-carousel-autoplay-toggle:hover {\n      color: #1f2937;\n    }\n\n    /* Carousel Empty State */\n    ${o} .tresta-carousel-empty {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 32px;\n      color: #6b7280;\n      text-align: center;\n    }\n\n    /* Layout: Wall (Minimal) */\n    ${o}.tresta-layout-wall .tresta-testimonials {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n      gap: 12px;\n      width: 100%;\n    }\n\n    ${o}.tresta-layout-wall .tresta-testimonial {\n      padding: 16px;\n      margin-bottom: 0;\n    }\n\n    ${o}.tresta-layout-wall .tresta-content {\n      font-size: 14px;\n      margin-bottom: 12px;\n    }\n\n    ${o}.tresta-layout-wall .tresta-author {\n      gap: 8px;\n    }\n\n    ${o}.tresta-layout-wall .tresta-author-image {\n      width: 36px;\n      height: 36px;\n      font-size: 14px;\n    }\n\n    ${o}.tresta-layout-wall .tresta-author-name {\n      font-size: 14px;\n    }\n\n    ${o}.tresta-layout-wall .tresta-author-role {\n      font-size: 12px;\n    }\n\n    /* Fade-in Animation */\n    ${o} .tresta-fade-in {\n      animation: tresta-fadeIn 0.5s ease;\n    }\n\n    @keyframes tresta-fadeIn {\n      from {\n        opacity: 0;\n        transform: translateY(10px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n\n    /* Responsive */\n    @media (max-width: 640px) {\n      ${o} .tresta-testimonial {\n        padding: 20px;\n      }\n\n      ${o} .tresta-content {\n        font-size: 15px;\n      }\n\n      ${o} .tresta-author {\n        gap: 10px;\n      }\n\n      ${o} .tresta-author-image {\n        width: 40px;\n        height: 40px;\n        font-size: 16px;\n      }\n    }\n\n    /* Branding (Optional) */\n    ${o} .tresta-branding {\n      text-align: center;\n      margin-top: 24px;\n      padding-top: 16px;\n      border-top: 1px solid #e5e7eb;\n      font-size: 12px;\n      color: #9ca3af;\n    }\n\n    ${o} .tresta-branding a {\n      color: ${r.primaryColor};\n      text-decoration: none;\n      font-weight: 500;\n    }\n\n    ${o} .tresta-branding a:hover {\n      text-decoration: underline;\n    }\n  `}(t,0,this.config.widgetId,n));!function(t,e){const n="tresta-widget-styles-"+e,i=document.getElementById(n);i&&i.remove();const a=document.createElement("style");a.id=n,a.textContent=t,document.head.appendChild(a)}(i,this.config.widgetId)}renderWidget(){if(!this.widget||!this.container)return;const t={...this.widget.settings,...this.config.settings},e=this.config.settings?.layout||this.widget.layout;this.effectiveLayout=e;const i=`\n      <div class="tresta-widget-inner">\n        ${n(this.testimonials,e,t,this.config.widgetId)}\n        \n    <div class="tresta-branding">\n      Powered by <a href="https://tresta.io" target="_blank" rel="noopener">Tresta</a>\n    </div>\n  \n      </div>\n    `;this.render(i)}initCarousel(){if(!this.container||!this.widget)return;if("carousel"!==(this.config.settings?.layout||this.widget.layout))return;const t=this.widget.settings,e=this.container.querySelector(".tresta-carousel");if(!e)return;const n=this.testimonials.map(t=>({id:t.id,name:t.authorName||"Anonymous",role:t.authorRole||"",company:t.authorCompany,content:t.content,avatar:t.authorAvatar,rating:t.rating,createdAt:t.createdAt,isOAuthVerified:t.isOAuthVerified,oauthProvider:t.oauthProvider})),i=new a({container:e,testimonials:n,autoplay:t.autoRotate??!1,autoplaySpeed:t.rotateInterval??5e3,showRating:t.showRating??!0,showCompany:t.showAuthorCompany??!0,showAvatar:t.showAvatar??!0,showDate:t.showDate??!0,onSlideChange:t=>{this.currentSlide=t}});this.carouselInstance=i}render(t){if(this.container&&(this.container.innerHTML=t,this.widget)){const t=this.effectiveLayout||this.widget.layout;this.container.className=`tresta-widget-${this.config.widgetId} tresta-layout-${t}`}}handleError(t){this.container&&this.render(`\n    <div class="tresta-error">\n      <p><strong>Unable to load testimonials</strong></p>\n      <p>${i(t.message)}</p>\n    </div>\n  `),this.config.onError&&this.config.onError(t)}destroy(){this.carouselInstance&&(this.carouselInstance.destroy(),this.carouselInstance=null),function(t){const e="tresta-widget-styles-"+t,n=document.getElementById(e);n&&n.remove()}(this.config.widgetId),this.container&&(this.container.innerHTML=""),this.widget=null,this.testimonials=[],this.container=null}async refresh(){try{await this.fetchWidgetData(),this.renderWidget(),"carousel"===this.widget?.layout&&this.initCarousel()}catch(t){this.handleError(t)}}getWidget(){return this.widget}getTestimonials(){return this.testimonials}}function o(){document.querySelectorAll("script[data-tresta-widget]").forEach(t=>{const e=t.getAttribute("data-tresta-widget");if(!e)return;if(window.trestaWidgets.has(e))return;const n={widgetId:e,apiUrl:t.getAttribute("data-api-url")||void 0,container:t.getAttribute("data-container")||void 0},i=t.getAttribute("data-primary-color"),a=t.getAttribute("data-background-color"),o=t.getAttribute("data-text-color"),s=t.getAttribute("data-card-background-color"),l=t.getAttribute("data-border-radius"),d=t.getAttribute("data-font-family");(i||a||o||s||l||d)&&(n.theme={...i&&{primaryColor:i},...a&&{backgroundColor:a},...o&&{textColor:o},...s&&{cardBackgroundColor:s},...l&&{borderRadius:parseInt(l,10)},...d&&{fontFamily:d}});const c=t.getAttribute("data-show-rating"),u=t.getAttribute("data-show-date"),h=t.getAttribute("data-show-author-image"),p=t.getAttribute("data-show-author-role"),g=t.getAttribute("data-show-author-company"),m=t.getAttribute("data-autoplay"),f=t.getAttribute("data-autoplay-speed"),w=t.getAttribute("data-max-items");(c||u||h||p||g||m||f||w)&&(n.settings={...c&&{showRating:"true"===c},...u&&{showDate:"true"===u},...h&&{showAuthorImage:"true"===h},...p&&{showAuthorRole:"true"===p},...g&&{showAuthorCompany:"true"===g},...m&&{autoplay:"true"===m},...f&&{autoplaySpeed:parseInt(f,10)},...w&&{maxItems:parseInt(w,10)}});try{const t=new r(n);window.trestaWidgets.set(e,t)}catch(y){}})}__publicField(r,"init",()=>{throw Error("TrestaWidget.init not initialized. Make sure the widget script is loaded.")}),__publicField(r,"destroy",()=>{throw Error("TrestaWidget.destroy not initialized. Make sure the widget script is loaded.")}),__publicField(r,"refresh",async()=>{throw Error("TrestaWidget.refresh not initialized. Make sure the widget script is loaded.")}),__publicField(r,"refreshAll",async()=>{throw Error("TrestaWidget.refreshAll not initialized. Make sure the widget script is loaded.")}),__publicField(r,"get",()=>{throw Error("TrestaWidget.get not initialized. Make sure the widget script is loaded.")}),__publicField(r,"getAll",()=>{throw Error("TrestaWidget.getAll not initialized. Make sure the widget script is loaded.")}),window.TrestaWidget=r,window.trestaWidgets=window.trestaWidgets||new Map,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o(),r.init=(t,e)=>{const n={widgetId:t,...e},i=new r(n);return window.trestaWidgets.set(t,i),i},r.destroy=t=>{const e=window.trestaWidgets.get(t);e&&(e.destroy(),window.trestaWidgets.delete(t))},r.refresh=async t=>{const e=window.trestaWidgets.get(t);e&&await e.refresh()},r.refreshAll=async()=>{const t=Array.from(window.trestaWidgets.values()).map(t=>t.refresh());await Promise.all(t)},r.get=t=>window.trestaWidgets.get(t)||null,r.getAll=()=>Array.from(window.trestaWidgets.values()),"undefined"!=typeof window&&(window.TrestaWidget=r),t.TrestaWidget=r,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}(this.TrestaWidget=this.TrestaWidget||{});
